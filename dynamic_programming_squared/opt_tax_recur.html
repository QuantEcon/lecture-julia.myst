
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>62. Optimal Taxation with State-Contingent Debt &#8212; Quantitative Economics with Julia</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/quantecon-book-theme.9deb0a26de8466f54124a1959c24cd33.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">


    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="../_static/quantecon-book-theme.43eb86aa48ec3aed660cb313c38068cd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://julia.quantecon.org/dynamic_programming_squared/opt_tax_recur.html" />
    <link rel="shortcut icon" href="../_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="63. Optimal Taxation without State-Contingent Debt" href="amss.html" />
    <link rel="prev" title="61. Optimal Taxation in an LQ Economy" href="lqramsey.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Jesse Perla &amp; Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Julia, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Jesse Perla, Thomas J. Sargent and John Stachurski. The language instruction is Julia. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Optimal Taxation with State-Contingent Debt"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Jesse Perla, Thomas J. Sargent and John Stachurski. The language instruction is Julia.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Optimal Taxation with State-Contingent Debt" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://julia.quantecon.org/dynamic_programming_squared/opt_tax_recur.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Jesse Perla, Thomas J. Sargent and John Stachurski. The language instruction is Julia." />
<meta property="og:site_name" content="Quantitative Economics with Julia" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="wrapper">

        <div class="main">

            <div class="page" id=dynamic_programming_squared/opt_tax_recur>

                <div class="page__toc">

                    <div class="inner">

                        
                        <div class="page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   62.1. Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-competitive-equilibrium-with-distorting-taxes">
   62.2. A Competitive Equilibrium with Distorting Taxes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arrow-debreu-version-of-price-system">
     62.2.1. Arrow-Debreu Version of Price System
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#primal-approach">
     62.2.2. Primal Approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-implementability-constraint">
     62.2.3. The Implementability Constraint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-details">
     62.2.4. Solution Details
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-ramsey-allocation-for-a-given-phi">
     62.2.5. The Ramsey Allocation for a Given
     <span class="math notranslate nohighlight">
      \(\Phi\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#further-specialization">
     62.2.6. Further Specialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#determining-phi">
     62.2.7. Determining
     <span class="math notranslate nohighlight">
      \(\Phi\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-inconsistency">
     62.2.8. Time Inconsistency
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specification-with-crra-utility">
     62.2.9. Specification with CRRA Utility
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequence-implementation">
     62.2.10. Sequence Implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recursive-formulation-of-the-ramsey-problem">
   62.3. Recursive Formulation of the Ramsey problem
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intertemporal-delegation">
     62.3.1. Intertemporal Delegation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-bellman-equations">
     62.3.2. Two Bellman Equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-continuation-ramsey-problem">
     62.3.3. The Continuation Ramsey Problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-ramsey-problem">
     62.3.4. The Ramsey Problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#first-order-conditions">
     62.3.5. First-Order Conditions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#state-variable-degeneracy">
     62.3.6. State Variable Degeneracy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manifestations-of-time-inconsistency">
     62.3.7. Manifestations of Time Inconsistency
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recursive-implementation">
     62.3.8. Recursive Implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   62.4. Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anticipated-one-period-war">
     62.4.1. Anticipated One Period War
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#government-saving">
     62.4.2. Government Saving
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-0-manipulation-of-interest-rate">
     62.4.3. Time 0 Manipulation of Interest Rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-0-and-time-inconsistency">
     62.4.4. Time 0  and Time-Inconsistency
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tax-smoothing-and-non-crra-preferences">
     62.4.5. Tax Smoothing and non-CRRA Preferences
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#further-comments">
   62.5. Further Comments
  </a>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="../_static/qe-logo-large.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="page__header">

                    <div class="page__header-copy">

                        <p class="page__header-heading"><a href="intro.html">Quantitative Economics with Julia</a></p>

                        <p class="page__header-subheading">Optimal Taxation with State-Contingent Debt</p>

                    </div>

                    <p class="page__header-authors">Jesse Perla & Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><div class="section" id="optimal-taxation-with-state-contingent-debt">
<h1><a class="toc-backref" href="#id5"><span class="section-number">62. </span>Optimal Taxation with State-Contingent Debt</a><a class="headerlink" href="#optimal-taxation-with-state-contingent-debt" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#optimal-taxation-with-state-contingent-debt" id="id5">Optimal Taxation with State-Contingent Debt</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id6">Overview</a></p></li>
<li><p><a class="reference internal" href="#a-competitive-equilibrium-with-distorting-taxes" id="id7">A Competitive Equilibrium with Distorting Taxes</a></p></li>
<li><p><a class="reference internal" href="#recursive-formulation-of-the-ramsey-problem" id="id8">Recursive Formulation of the Ramsey problem</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id9">Examples</a></p></li>
<li><p><a class="reference internal" href="#further-comments" id="id10">Further Comments</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id6"><span class="section-number">62.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This lecture describes a celebrated model of optimal fiscal policy by Robert E.
Lucas, Jr., and Nancy Stokey  <span id="id1">[<a class="reference internal" href="../zreferences.html#id102">LS83</a>]</span>.</p>
<p>The model revisits classic issues about how to pay for a war.</p>
<p>Here a <em>war</em> means a more  or less temporary surge in an exogenous government expenditure process.</p>
<p>The model features</p>
<ul class="simple">
<li><p>a government that must finance an exogenous stream of government expenditures with  either</p>
<ul>
<li><p>a flat rate tax on labor, or</p></li>
<li><p>purchases and sales from a full array of Arrow state-contingent securities</p></li>
</ul>
</li>
<li><p>a representative household that values consumption and leisure</p></li>
<li><p>a linear production function mapping labor into a single good</p></li>
<li><p>a Ramsey planner who at time <span class="math notranslate nohighlight">\(t=0\)</span> chooses a plan for taxes and
trades of <a class="reference external" href="https://en.wikipedia.org/wiki/Arrow_security">Arrow securities</a> for all <span class="math notranslate nohighlight">\(t \geq 0\)</span></p></li>
</ul>
<p>After first presenting the model in a space of sequences, we shall represent it
recursively in terms of two Bellman equations formulated along lines that we
encountered in <a class="reference internal" href="dyn_stack.html"><span class="doc">Dynamic Stackelberg models</span></a>.</p>
<p>As in <a class="reference internal" href="dyn_stack.html"><span class="doc">Dynamic Stackelberg models</span></a>, to apply dynamic programming
we shall define the state vector artfully.</p>
<p>In particular, we shall include forward-looking variables that summarize  optimal
responses of private agents to a Ramsey plan.</p>
<p>See <a class="reference internal" href="lqramsey.html"><span class="doc">Optimal taxation</span></a> for an analysis within a linear-quadratic setting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">LinearAlgebra</span><span class="p">,</span> <span class="n">Statistics</span>
<span class="k">using</span> <span class="n">QuantEcon</span><span class="p">,</span> <span class="n">NLsolve</span><span class="p">,</span> <span class="n">NLopt</span><span class="p">,</span> <span class="n">Interpolations</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-competitive-equilibrium-with-distorting-taxes">
<h2><a class="toc-backref" href="#id7"><span class="section-number">62.2. </span>A Competitive Equilibrium with Distorting Taxes</a><a class="headerlink" href="#a-competitive-equilibrium-with-distorting-taxes" title="Permalink to this headline">¶</a></h2>
<p>For <span class="math notranslate nohighlight">\(t \geq 0\)</span>, a history <span class="math notranslate nohighlight">\(s^t = [s_t, s_{t-1}, \ldots, s_0]\)</span> of an
exogenous state <span class="math notranslate nohighlight">\(s_t\)</span> has joint probability density <span class="math notranslate nohighlight">\(\pi_t(s^t)\)</span>.</p>
<p>We begin by assuming that government purchases <span class="math notranslate nohighlight">\(g_t(s^t)\)</span> at time <span class="math notranslate nohighlight">\(t \geq 0\)</span> depend on <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(c_t(s^t)\)</span>,  <span class="math notranslate nohighlight">\(\ell_t(s^t)\)</span>, and <span class="math notranslate nohighlight">\(n_t(s^t)\)</span> denote consumption,
leisure, and labor supply, respectively, at history <span class="math notranslate nohighlight">\(s^t\)</span> and date <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>A representative  household is endowed with one unit of time that can be divided
between leisure <span class="math notranslate nohighlight">\(\ell_t\)</span> and labor <span class="math notranslate nohighlight">\(n_t\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-feas1-opt-tax">
<span class="eqno">(62.1)<a class="headerlink" href="#equation-feas1-opt-tax" title="Permalink to this equation">¶</a></span>\[n_t(s^t) + \ell_t(s^t) = 1\]</div>
<p>Output equals <span class="math notranslate nohighlight">\(n_t(s^t)\)</span> and can be divided between <span class="math notranslate nohighlight">\(c_t(s^t)\)</span> and <span class="math notranslate nohighlight">\(g_t(s^t)\)</span></p>
<div class="math notranslate nohighlight" id="equation-tss-techr-opt-tax">
<span class="eqno">(62.2)<a class="headerlink" href="#equation-tss-techr-opt-tax" title="Permalink to this equation">¶</a></span>\[c_t(s^t) + g_t(s^t) = n_t(s^t)\]</div>
<p>A representative household’s preferences over <span class="math notranslate nohighlight">\(\{c_t(s^t), \ell_t(s^t)\}_{t=0}^\infty\)</span> are ordered by</p>
<div class="math notranslate nohighlight" id="equation-ts-prefr-opt-tax">
<span class="eqno">(62.3)<a class="headerlink" href="#equation-ts-prefr-opt-tax" title="Permalink to this equation">¶</a></span>\[\sum_{t=0}^\infty \sum_{s^t} \beta^t \pi_t(s^t) u[c_t(s^t), \ell_t(s^t)]\]</div>
<p>where the utility function <span class="math notranslate nohighlight">\(u\)</span> is  increasing, strictly concave, and three
times continuously differentiable in both arguments.</p>
<p>The technology pins down a pre-tax wage rate to unity for all <span class="math notranslate nohighlight">\(t, s^t\)</span>.</p>
<p>The government imposes a flat-rate tax <span class="math notranslate nohighlight">\(\tau_t(s^t)\)</span> on labor income at
time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>There are complete markets in one-period Arrow securities.</p>
<p>One unit of an Arrow security  issued at time <span class="math notranslate nohighlight">\(t\)</span> at history <span class="math notranslate nohighlight">\(s^t\)</span>
and promising to pay one unit of time <span class="math notranslate nohighlight">\(t+1\)</span> consumption in state <span class="math notranslate nohighlight">\(s_{t+1}\)</span>
costs <span class="math notranslate nohighlight">\(p_{t+1}(s_{t+1}|s^t)\)</span>.</p>
<p>The government issues one-period Arrow securities each period.</p>
<p>The government has a sequence of budget constraints whose time <span class="math notranslate nohighlight">\(t \geq 0\)</span> component is</p>
<div class="math notranslate nohighlight" id="equation-ts-govr">
<span class="eqno">(62.4)<a class="headerlink" href="#equation-ts-govr" title="Permalink to this equation">¶</a></span>\[g_t(s^t) =   \tau_t(s^t)  n_t(s^t) + \sum_{s_{t+1}} p_{t+1}(s_{t+1} | s^t) b_{t+1}(s_{t+1} | s^t) -
b_t(s_t | s^{t-1})\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_{t+1}(s_{t+1}|s^t)\)</span> is a competitive equilibrium price of one unit of
consumption at date <span class="math notranslate nohighlight">\(t+1\)</span> in state <span class="math notranslate nohighlight">\(s_{t+1}\)</span> at date <span class="math notranslate nohighlight">\(t\)</span> and history <span class="math notranslate nohighlight">\(s^t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(b_t(s_t|s^{t-1})\)</span> is government debt falling due at time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span>.</p></li>
</ul>
<p>Government debt <span class="math notranslate nohighlight">\(b_0(s_0)\)</span> is an exogenous initial condition.</p>
<p>The representative household has a sequence of budget constraints whose time <span class="math notranslate nohighlight">\(t\geq 0\)</span> component is</p>
<div class="math notranslate nohighlight" id="equation-ts-bcr">
<span class="eqno">(62.5)<a class="headerlink" href="#equation-ts-bcr" title="Permalink to this equation">¶</a></span>\[c_t(s^t) + \sum_{s_{t+1}} p_t(s_{t+1} | s^t) b_{t+1}(s_{t+1} | s^t)
=  \left[1-\tau_t(s^t)\right]  n_t(s^t) + b_t(s_t | s^{t-1}) \quad \forall t \geq 0.\]</div>
<p>A  <strong>government policy</strong> is an exogenous sequence <span class="math notranslate nohighlight">\(\{g(s_t)\}_{t=0}^\infty\)</span>,
a tax rate sequence <span class="math notranslate nohighlight">\(\{\tau_t(s^t)\}_{t=0}^\infty\)</span>, and a government debt sequence <span class="math notranslate nohighlight">\(\{b_{t+1}(s^{t+1})\}_{t=0}^\infty\)</span>.</p>
<p>A <strong>feasible allocation</strong> is a consumption-labor supply plan <span class="math notranslate nohighlight">\(\{c_t(s^t), n_t(s^t)\}_{t=0}^\infty\)</span>
that satisfies <a class="reference internal" href="#equation-tss-techr-opt-tax">(62.2)</a> at all <span class="math notranslate nohighlight">\(t, s^t\)</span>.</p>
<p>A <strong>price system</strong> is a sequence of Arrow security prices <span class="math notranslate nohighlight">\(\{p_{t+1}(s_{t+1} | s^t) \}_{t=0}^\infty\)</span>.</p>
<p>The household faces the price system as a price-taker and takes the government policy as given.</p>
<p>The household chooses <span class="math notranslate nohighlight">\(\{c_t(s^t), \ell_t(s^t)\}_{t=0}^\infty\)</span> to maximize <a class="reference internal" href="#equation-ts-prefr-opt-tax">(62.3)</a> subject to <a class="reference internal" href="#equation-ts-bcr">(62.5)</a> and <a class="reference internal" href="#equation-feas1-opt-tax">(62.1)</a> for all <span class="math notranslate nohighlight">\(t, s^t\)</span>.</p>
<p>A <strong>competitive equilibrium with distorting taxes</strong> is a feasible allocation,
a price system, and a government policy such that</p>
<ul class="simple">
<li><p>Given the price system and the government policy, the allocation solves the
household’s optimization problem.</p></li>
<li><p>Given the allocation, government policy, and  price system, the government’s
budget constraint is satisfied for all <span class="math notranslate nohighlight">\(t, s^t\)</span>.</p></li>
</ul>
<p>Note: There are many competitive equilibria with distorting taxes.</p>
<p>They are indexed by different government policies.</p>
<p>The <strong>Ramsey problem</strong> or <strong>optimal taxation problem</strong> is to choose a competitive
equilibrium with distorting taxes that maximizes <a class="reference internal" href="#equation-ts-prefr-opt-tax">(62.3)</a>.</p>
<div class="section" id="arrow-debreu-version-of-price-system">
<h3><span class="section-number">62.2.1. </span>Arrow-Debreu Version of Price System<a class="headerlink" href="#arrow-debreu-version-of-price-system" title="Permalink to this headline">¶</a></h3>
<p>We find it convenient sometimes to work with the Arrow-Debreu price system that is
implied by a sequence of Arrow securities prices.</p>
<p>Let <span class="math notranslate nohighlight">\(q_t^0(s^t)\)</span> be the price at time <span class="math notranslate nohighlight">\(0\)</span>, measured in time <span class="math notranslate nohighlight">\(0\)</span>
consumption goods, of one unit of consumption at time <span class="math notranslate nohighlight">\(t\)</span>,
history <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>The following recursion relates Arrow-Debreu prices <span class="math notranslate nohighlight">\(\{q_t^0(s^t)\}_{t=0}^\infty\)</span>
to Arrow securities prices <span class="math notranslate nohighlight">\(\{p_{t+1}(s_{t+1}|s^t)\}_{t=0}^\infty\)</span></p>
<div class="math notranslate nohighlight" id="equation-ts-foc">
<span class="eqno">(62.6)<a class="headerlink" href="#equation-ts-foc" title="Permalink to this equation">¶</a></span>\[q^0_{t+1}(s^{t+1}) = p_{t+1}(s_{t+1}|s^t) q^0_t(s^t) \quad s.t. \quad q_0^0(s^0) = 1\]</div>
<p>Arrow-Debreu prices are useful when we want to compress a sequence of budget
constraints into a single intertemporal budget constraint, as we shall find it
convenient to do below.</p>
</div>
<div class="section" id="primal-approach">
<h3><span class="section-number">62.2.2. </span>Primal Approach<a class="headerlink" href="#primal-approach" title="Permalink to this headline">¶</a></h3>
<p>We apply a popular approach to solving a Ramsey problem, called the <em>primal approach</em>.</p>
<p>The idea is to use first-order conditions for household optimization to
eliminate taxes and prices in favor of quantities, then pose an optimization problem
cast entirely in terms of quantities.</p>
<p>After Ramsey quantities have been found, taxes and prices can then be unwound
from the allocation.</p>
<p>The primal approach uses four steps:</p>
<ul class="simple">
<li><p>This intertemporal constraint involves only the allocation and is regarded
as an <em>implementability constraint</em>.</p></li>
</ul>
<ol class="simple">
<li><p>Find the allocation that maximizes the utility of the representative household
<a class="reference internal" href="#equation-ts-prefr-opt-tax">(62.3)</a> subject to  the feasibility constraints <a class="reference internal" href="#equation-feas1-opt-tax">(62.1)</a>
and <a class="reference internal" href="#equation-tss-techr-opt-tax">(62.2)</a>  and the implementability condition derived in step 2.</p></li>
</ol>
<ul class="simple">
<li><p>This optimal allocation is called the <strong>Ramsey allocation</strong>.</p></li>
</ul>
<ol class="simple">
<li><p>Use the Ramsey  allocation together with the formulas from step 1 to find
taxes and prices.</p></li>
</ol>
</div>
<div class="section" id="the-implementability-constraint">
<h3><span class="section-number">62.2.3. </span>The Implementability Constraint<a class="headerlink" href="#the-implementability-constraint" title="Permalink to this headline">¶</a></h3>
<p>By sequential substitution of one one-period budget constraint <a class="reference internal" href="#equation-ts-bcr">(62.5)</a> into
another, we can obtain the household’s present-value budget constraint:</p>
<div class="math notranslate nohighlight" id="equation-ts-bcpv2">
<span class="eqno">(62.7)<a class="headerlink" href="#equation-ts-bcpv2" title="Permalink to this equation">¶</a></span>\[\sum_{t=0}^\infty \sum_{s^t} q^0_t(s^t) c_t(s^t) =
\sum_{t=0}^\infty \sum_{s^t} q^0_t(s^t) [1-\tau_t(s^t)] n_t(s^t) +
b_0\]</div>
<p><span class="math notranslate nohighlight">\(\{q^0_t(s^t)\}_{t=1}^\infty\)</span> can be interpreted as a time <span class="math notranslate nohighlight">\(0\)</span>
Arrow-Debreu price system.</p>
<p>To approach the Ramsey problem, we study the household’s optimization problem.</p>
<p>First-order conditions for the household’s problem for <span class="math notranslate nohighlight">\(\ell_t(s^t)\)</span>
and <span class="math notranslate nohighlight">\(b_t(s_{t+1}| s^t)\)</span>, respectively, imply</p>
<div class="math notranslate nohighlight" id="equation-lsa-taxr">
<span class="eqno">(62.8)<a class="headerlink" href="#equation-lsa-taxr" title="Permalink to this equation">¶</a></span>\[(1 - \tau_t(s^t)) = {\frac{u_l(s^t)}{u_c(s^t)}}\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-ls101">
<span class="eqno">(62.9)<a class="headerlink" href="#equation-ls101" title="Permalink to this equation">¶</a></span>\[p_{t+1}(s_{t+1}| s^t) = \beta \pi(s_{t+1} | s^t) \left({\frac{u_c(s^{t+1})}{u_c({s^t})}} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(\pi(s_{t+1} | s^t)\)</span> is the probability distribution of <span class="math notranslate nohighlight">\(s_{t+1}\)</span>
conditional on history <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>Equation <a class="reference internal" href="#equation-ls101">(62.9)</a> implies that the Arrow-Debreu price system satisfies</p>
<div class="math notranslate nohighlight" id="equation-ls102">
<span class="eqno">(62.10)<a class="headerlink" href="#equation-ls102" title="Permalink to this equation">¶</a></span>\[q_t^0(s^t) = \beta^{t} \pi_{t}(s^{t})
                            {u_c(s^{t})  \over u_c(s^0)}\]</div>
<p>Using the first-order conditions <a class="reference internal" href="#equation-lsa-taxr">(62.8)</a> and <a class="reference internal" href="#equation-ls101">(62.9)</a> to eliminate
taxes and prices from <a class="reference internal" href="#equation-ts-bcpv2">(62.7)</a>, we derive the <em>implementability condition</em></p>
<div class="math notranslate nohighlight" id="equation-tss-cham1">
<span class="eqno">(62.11)<a class="headerlink" href="#equation-tss-cham1" title="Permalink to this equation">¶</a></span>\[\sum_{t=0}^\infty  \sum_{s^t} \beta^t \pi_t(s^t)
         [u_c(s^t) c_t(s^t) - u_\ell(s^t) n_t(s^t)] -
         u_c(s^0) b_0 = 0.\]</div>
<p>The <strong>Ramsey problem</strong> is to choose a feasible  allocation  that maximizes</p>
<div class="math notranslate nohighlight" id="equation-ts-prefr2">
<span class="eqno">(62.12)<a class="headerlink" href="#equation-ts-prefr2" title="Permalink to this equation">¶</a></span>\[\sum_{t=0}^\infty \sum_{s^t} \beta^t \pi_t(s^t) u[c_t(s^t), 1 - n_t(s^t)]\]</div>
<p>subject to  <a class="reference internal" href="#equation-tss-cham1">(62.11)</a>.</p>
</div>
<div class="section" id="solution-details">
<h3><span class="section-number">62.2.4. </span>Solution Details<a class="headerlink" href="#solution-details" title="Permalink to this headline">¶</a></h3>
<p>First define a “pseudo utility function”</p>
<div class="math notranslate nohighlight" id="equation-ts-cham17">
<span class="eqno">(62.13)<a class="headerlink" href="#equation-ts-cham17" title="Permalink to this equation">¶</a></span>\[V\left[c_t(s^t), n_t(s^t), \Phi\right] =
u[c_t(s^t),1-n_t(s^t)] +
\Phi \left[ u_c(s^t) c_t(s^t) -
u_\ell(s^t) n_t(s^t) \right]\]</div>
<p>where <span class="math notranslate nohighlight">\(\Phi\)</span> is a Lagrange multiplier on the implementability condition <a class="reference internal" href="#equation-ts-bcpv2">(62.7)</a>.</p>
<p>Next form the Lagrangian</p>
<div class="math notranslate nohighlight" id="equation-ts-chamlag">
<span class="eqno">(62.14)<a class="headerlink" href="#equation-ts-chamlag" title="Permalink to this equation">¶</a></span>\[J  = \sum_{t=0}^\infty
\sum_{s^t} \beta^t \pi_t(s^t)
\Bigl\{
    V[c_t(s^t), n_t(s^t), \Phi]   + \theta_t(s^t)
   \Bigl[ n_t(s^t) - c_t(s^t) - g_t(s_t) \Bigr]
\Bigr\} - \Phi u_c(0) b_0\]</div>
<p>where  <span class="math notranslate nohighlight">\(\{\theta_t(s^t); \forall s^t\}_{t\geq0}\)</span> is a sequence of Lagrange
multipliers on the feasible conditions <a class="reference internal" href="#equation-tss-techr-opt-tax">(62.2)</a>.</p>
<p>Given an initial government debt <span class="math notranslate nohighlight">\(b_0\)</span>,  we want to maximize <span class="math notranslate nohighlight">\(J\)</span>
with respect to <span class="math notranslate nohighlight">\(\{c_t(s^t), n_t(s^t); \forall s^t \}_{t\geq0}\)</span>   and to minimize with respect
to <span class="math notranslate nohighlight">\(\{\theta(s^t); \forall s^t \}_{t\geq0}\)</span>.</p>
<p>The first-order conditions for the Ramsey problem for periods <span class="math notranslate nohighlight">\(t \geq 1\)</span> and <span class="math notranslate nohighlight">\(t=0\)</span>, respectively, are</p>
<div class="math notranslate nohighlight" id="equation-eqfoncramsey1">
<span class="eqno">(62.15)<a class="headerlink" href="#equation-eqfoncramsey1" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
    c_t(s^t)\rm{:} &amp;
    \; (1+\Phi) u_c(s^t) + \Phi \left[u_{cc}(s^t) c_t(s^t) -
    u_{\ell c}(s^t) n_t(s^t) \right]  - \theta_t(s^t) = 0, \quad t \geq 1
    \\
    n_t(s^t)\rm{:} &amp;
    \; -(1+\Phi) u_{\ell}(s^t) - \Phi \left[u_{c\ell}(s^t) c_t(s^t) -
    u_{\ell \ell}(s^t) n_t(s^t) \right] + \theta_t(s^t) = 0, \quad t \geq 1
\end{aligned}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-eqfoncramsey0">
<span class="eqno">(62.16)<a class="headerlink" href="#equation-eqfoncramsey0" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
    c_0(s^0, b_0)\rm{:} &amp;
    \; (1+\Phi) u_c(s^0, b_0) + \Phi \left[u_{cc}(s^0, b_0) c_0(s^0, b_0) -
    u_{\ell c}(s^0, b_0) n_0(s^0, b_0) \right]  - \theta_0(s^0, b_0)   \\
       &amp; \quad \quad \quad \quad \quad \quad  - \Phi u_{cc}(s^0, b_0) b_0 = 0
    \\
    n_0(s^0, b_0)\rm{:} &amp;
    \; -(1+\Phi) u_{\ell}(s^0, b_0) - \Phi \left[u_{c\ell}(s^0, b_0) c_0(s^0, b_0) -
    u_{\ell \ell}(s^0, b_0) n_0(s^0, b_0) \right] + \theta_0(s^0, b_0) \\
      &amp; \quad \quad \quad \quad \quad \quad + \Phi u_{c \ell}(s^0, b_0) b_0 = 0
\end{aligned}\end{split}\]</div>
<p>Please note how these first-order conditions differ between <span class="math notranslate nohighlight">\(t=0\)</span> and <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>It is instructive to use first-order conditions <a class="reference internal" href="#equation-eqfoncramsey1">(62.15)</a> for
<span class="math notranslate nohighlight">\(t \geq 1\)</span> to eliminate the multipliers <span class="math notranslate nohighlight">\(\theta_t(s^t)\)</span>.</p>
<p>For convenience, we suppress the time subscript and the index <span class="math notranslate nohighlight">\(s^t\)</span> and obtain</p>
<div class="math notranslate nohighlight" id="equation-ts-barg">
<span class="eqno">(62.17)<a class="headerlink" href="#equation-ts-barg" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
  (1+\Phi) &amp;u_c(c,1-c-g) + \Phi \bigl[c u_{cc}(c,1-c-g) -
  (c+g) u_{\ell c}(c,1-c-g) \bigr]
    \\
    &amp;= (1+\Phi) u_{\ell}(c,1-c-g) + \Phi \bigl[c u_{c\ell}(c,1-c-g) -
    (c+g) u_{\ell \ell}(c,1-c-g)  \bigr]
\end{aligned}\end{split}\]</div>
<p>where we have imposed conditions <a class="reference internal" href="#equation-feas1-opt-tax">(62.1)</a> and <a class="reference internal" href="#equation-tss-techr-opt-tax">(62.2)</a>.</p>
<p>Equation <a class="reference internal" href="#equation-ts-barg">(62.17)</a> is one equation that can be solved to express the
unknown <span class="math notranslate nohighlight">\(c\)</span> as a function of the  exogenous variable <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>We also know that  time <span class="math notranslate nohighlight">\(t=0\)</span> quantities <span class="math notranslate nohighlight">\(c_0\)</span> and <span class="math notranslate nohighlight">\(n_0\)</span> satisfy</p>
<div class="math notranslate nohighlight" id="equation-ts-barg-aust">
<span class="eqno">(62.18)<a class="headerlink" href="#equation-ts-barg-aust" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
      (1+\Phi) &amp;u_c(c,1-c-g) + \Phi \bigl[c u_{cc}(c,1-c-g) -
      (c+g) u_{\ell c}(c,1-c-g) \bigr]
        \\
        &amp;= (1+\Phi) u_{\ell}(c,1-c-g) + \Phi \bigl[c u_{c\ell}(c,1-c-g) -
        (c+g) u_{\ell \ell}(c,1-c-g)  \bigr] + \Phi (u_{cc} - u_{c,\ell}) b_0
\end{aligned}\end{split}\]</div>
<p>Notice that a counterpart to <span class="math notranslate nohighlight">\(b_0\)</span> does <em>not</em> appear
in <a class="reference internal" href="#equation-ts-barg">(62.17)</a>, so <span class="math notranslate nohighlight">\(c\)</span> does not depend on it for <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>But things are different for time <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>An analogous argument for the <span class="math notranslate nohighlight">\(t=0\)</span> equations <a class="reference internal" href="#equation-eqfoncramsey0">(62.16)</a> leads
to one equation that can be solved for <span class="math notranslate nohighlight">\(c_0\)</span> as a function of the
pair <span class="math notranslate nohighlight">\((g(s_0), b_0)\)</span>.</p>
<p>These outcomes mean that the following statement would be  true even when
government purchases are history-dependent functions <span class="math notranslate nohighlight">\(g_t(s^t)\)</span> of the
history of <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p><strong>Proposition:</strong>
If government purchases are equal after two histories
<span class="math notranslate nohighlight">\(s^t\)</span> and <span class="math notranslate nohighlight">\(\tilde s^\tau\)</span> for <span class="math notranslate nohighlight">\(t,\tau\geq0\)</span>, i.e., if</p>
<div class="math notranslate nohighlight">
\[
g_t(s^t) = g^\tau(\tilde s^\tau) = g
\]</div>
<p>then it follows from <a class="reference internal" href="#equation-ts-barg">(62.17)</a> that the Ramsey  choices of consumption and leisure,
<span class="math notranslate nohighlight">\((c_t(s^t),\ell_t(s^t))\)</span> and <span class="math notranslate nohighlight">\((c_j(\tilde s^\tau),\ell_j(\tilde
s^\tau))\)</span>, are identical.</p>
<p>The proposition asserts that the optimal allocation is a function of the
currently realized quantity of government purchases <span class="math notranslate nohighlight">\(g\)</span> only and does
<em>not</em> depend on the specific history that preceded that realization of <span class="math notranslate nohighlight">\(g\)</span>.</p>
</div>
<div class="section" id="the-ramsey-allocation-for-a-given-phi">
<h3><span class="section-number">62.2.5. </span>The Ramsey Allocation for a Given <span class="math notranslate nohighlight">\(\Phi\)</span><a class="headerlink" href="#the-ramsey-allocation-for-a-given-phi" title="Permalink to this headline">¶</a></h3>
<p>Temporarily take  <span class="math notranslate nohighlight">\(\Phi\)</span> as given.</p>
<p>We shall compute <span class="math notranslate nohighlight">\(c_0(s^0, b_0)\)</span> and <span class="math notranslate nohighlight">\(n_0(s^0, b_0)\)</span> from the first-order
conditions <a class="reference internal" href="#equation-eqfoncramsey0">(62.16)</a>.</p>
<p>Evidently, for <span class="math notranslate nohighlight">\(t \geq 1\)</span>, <span class="math notranslate nohighlight">\(c\)</span> and
<span class="math notranslate nohighlight">\(n\)</span> depend on the time <span class="math notranslate nohighlight">\(t\)</span> realization of <span class="math notranslate nohighlight">\(g\)</span> only.</p>
<p>But for <span class="math notranslate nohighlight">\(t=0\)</span>, <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(n\)</span>  depend on both <span class="math notranslate nohighlight">\(g_0\)</span> and the
government’s initial debt <span class="math notranslate nohighlight">\(b_0\)</span>.</p>
<p>Thus, while <span class="math notranslate nohighlight">\(b_0\)</span>
influences <span class="math notranslate nohighlight">\(c_0\)</span> and <span class="math notranslate nohighlight">\(n_0\)</span>, there appears no analogous
variable <span class="math notranslate nohighlight">\(b_t\)</span> that influences <span class="math notranslate nohighlight">\(c_t\)</span> and <span class="math notranslate nohighlight">\(n_t\)</span> for
<span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>The absence of <span class="math notranslate nohighlight">\(b_t\)</span> as a determinant of the  Ramsey allocation for
<span class="math notranslate nohighlight">\(t \geq 1\)</span> and its presence for <span class="math notranslate nohighlight">\(t=0\)</span> is a symptom of the
<em>time-inconsistency</em> of a Ramsey plan.</p>
<p><span class="math notranslate nohighlight">\(\Phi\)</span> has to take a value that assures that
the household and the government’s budget constraints are both
satisfied at a candidate Ramsey allocation and price system associated
with that <span class="math notranslate nohighlight">\(\Phi\)</span>.</p>
</div>
<div class="section" id="further-specialization">
<h3><span class="section-number">62.2.6. </span>Further Specialization<a class="headerlink" href="#further-specialization" title="Permalink to this headline">¶</a></h3>
<p>At this point, it is useful to specialize the model in the following ways.</p>
<p>We assume that <span class="math notranslate nohighlight">\(s\)</span> is governed by a finite state Markov chain with states
<span class="math notranslate nohighlight">\(s\in [1, \ldots, S]\)</span> and transition matrix <span class="math notranslate nohighlight">\(\Pi\)</span>, where</p>
<div class="math notranslate nohighlight">
\[
\Pi(s'|s) = {\rm Prob}(s_{t+1} = s'| s_t =s)
\]</div>
<p>Also, assume that government purchases <span class="math notranslate nohighlight">\(g\)</span> are an exact time-invariant function
<span class="math notranslate nohighlight">\(g(s)\)</span> of <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>We maintain these assumptions throughout the remainder of this lecture.</p>
</div>
<div class="section" id="determining-phi">
<h3><span class="section-number">62.2.7. </span>Determining <span class="math notranslate nohighlight">\(\Phi\)</span><a class="headerlink" href="#determining-phi" title="Permalink to this headline">¶</a></h3>
<p>We complete the Ramsey plan by computing the Lagrange multiplier <span class="math notranslate nohighlight">\(\Phi\)</span>
on the implementability constraint <a class="reference internal" href="#equation-tss-cham1">(62.11)</a>.</p>
<p>Government budget balance restricts <span class="math notranslate nohighlight">\(\Phi\)</span> via the following line of reasoning.</p>
<p>The household’s first-order conditions imply</p>
<div class="math notranslate nohighlight" id="equation-lsa-ta">
<span class="eqno">(62.19)<a class="headerlink" href="#equation-lsa-ta" title="Permalink to this equation">¶</a></span>\[(1 - \tau_t(s^t)) = {\frac{u_l(s^t)}{u_c(s^t)} }\]</div>
<p>and the  implied one-period Arrow securities prices</p>
<div class="math notranslate nohighlight" id="equation-lsa-arro">
<span class="eqno">(62.20)<a class="headerlink" href="#equation-lsa-arro" title="Permalink to this equation">¶</a></span>\[p_{t+1}(s_{t+1}| s^t) = \beta \Pi(s_{t+1} | s_t) {\frac{u_c(s^{t+1})}{u_c({s^t})}}\]</div>
<p>Substituting from  <a class="reference internal" href="#equation-lsa-ta">(62.19)</a>, <a class="reference internal" href="#equation-lsa-arro">(62.20)</a>, and the feasibility
condition <a class="reference internal" href="#equation-tss-techr-opt-tax">(62.2)</a>  into the recursive version <a class="reference internal" href="#equation-ts-bcr">(62.5)</a> of
the household budget constraint gives</p>
<div class="math notranslate nohighlight" id="equation-lsa-budget">
<span class="eqno">(62.21)<a class="headerlink" href="#equation-lsa-budget" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
    u_c(s^t) [ n_t(s^t) - g_t(s^t)] +
    \beta \sum_{s_{t+1}} \Pi (s_{t+1}| s_t) u_c(s^{t+1}) b_{t+1}(s_{t+1} | s^t) = \\
    u_l (s^t) n_t(s^t) + u_c(s^t) b_t(s_t | s^{t-1})
\end{aligned}\end{split}\]</div>
<p>Define <span class="math notranslate nohighlight">\(x_t(s^t) = u_c(s^t) b_t(s_t | s^{t-1})\)</span>.</p>
<p>Notice that <span class="math notranslate nohighlight">\(x_t(s^t)\)</span> appears on the right side of <a class="reference internal" href="#equation-lsa-budget">(62.21)</a> while
<span class="math notranslate nohighlight">\(\beta\)</span> times the conditional expectation of
<span class="math notranslate nohighlight">\(x_{t+1}(s^{t+1})\)</span> appears on the left side.</p>
<p>Hence the equation shares much of the structure of a simple asset pricing equation with
<span class="math notranslate nohighlight">\(x_t\)</span> being analogous to the price of the asset at time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>We learned earlier that for a Ramsey allocation
<span class="math notranslate nohighlight">\(c_t(s^t), n_t(s^t)\)</span> and <span class="math notranslate nohighlight">\(b_t(s_t|s^{t-1})\)</span>, and therefore
also <span class="math notranslate nohighlight">\(x_t(s^t)\)</span>, are each functions of <span class="math notranslate nohighlight">\(s_t\)</span> only,  being
independent of the history <span class="math notranslate nohighlight">\(s^{t-1}\)</span> for <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>That means that we can express equation <a class="reference internal" href="#equation-lsa-budget">(62.21)</a> as</p>
<div class="math notranslate nohighlight" id="equation-lsa-budget2">
<span class="eqno">(62.22)<a class="headerlink" href="#equation-lsa-budget2" title="Permalink to this equation">¶</a></span>\[u_c(s)
[ n(s) - g(s)]  + \beta
\sum_{s'} \Pi(s' | s) x'(s')  = u_l(s) n(s) + x(s)\]</div>
<p>where <span class="math notranslate nohighlight">\(s'\)</span> denotes a next period value of <span class="math notranslate nohighlight">\(s\)</span> and
<span class="math notranslate nohighlight">\(x'(s')\)</span> denotes a next period value of <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Equation <a class="reference internal" href="#equation-lsa-budget2">(62.22)</a> is easy to solve for <span class="math notranslate nohighlight">\(x(s)\)</span> for
<span class="math notranslate nohighlight">\(s = 1, \ldots , S\)</span>.</p>
<p>If we let <span class="math notranslate nohighlight">\(\vec n, \vec g, \vec x\)</span>
denote <span class="math notranslate nohighlight">\(S \times 1\)</span> vectors whose <span class="math notranslate nohighlight">\(i\)</span>th elements are the
respective <span class="math notranslate nohighlight">\(n, g\)</span>, and <span class="math notranslate nohighlight">\(x\)</span> values when <span class="math notranslate nohighlight">\(s=i\)</span>, and let
<span class="math notranslate nohighlight">\(\Pi\)</span> be the transition matrix for the Markov state <span class="math notranslate nohighlight">\(s\)</span>,
then we can express <a class="reference internal" href="#equation-lsa-budget2">(62.22)</a> as the matrix equation</p>
<div class="math notranslate nohighlight" id="equation-lsa-budget20">
<span class="eqno">(62.23)<a class="headerlink" href="#equation-lsa-budget20" title="Permalink to this equation">¶</a></span>\[\vec u_c(\vec n - \vec g) + \beta \Pi \vec x = \vec u_l \vec n + \vec x\]</div>
<p>This is a system of <span class="math notranslate nohighlight">\(S\)</span> linear equations in the <span class="math notranslate nohighlight">\(S \times 1\)</span>
vector <span class="math notranslate nohighlight">\(x\)</span>, whose solution is</p>
<div class="math notranslate nohighlight" id="equation-lsa-xsol">
<span class="eqno">(62.24)<a class="headerlink" href="#equation-lsa-xsol" title="Permalink to this equation">¶</a></span>\[\vec x= (I - \beta \Pi )^{-1} [ \vec u_c (\vec n-\vec g) - \vec u_l \vec n]\]</div>
<p>In these equations, by <span class="math notranslate nohighlight">\(\vec u_c \vec n\)</span>, for example, we mean
element-by-element multiplication of the two vectors.</p>
<p>After solving for <span class="math notranslate nohighlight">\(\vec x\)</span>, we can find <span class="math notranslate nohighlight">\(b(s_t|s^{t-1})\)</span> in Markov
state <span class="math notranslate nohighlight">\(s_t=s\)</span> from <span class="math notranslate nohighlight">\(b(s) = {\frac{x(s)}{u_c(s)}}\)</span> or the matrix equation</p>
<div class="math notranslate nohighlight" id="equation-lsa-bsol">
<span class="eqno">(62.25)<a class="headerlink" href="#equation-lsa-bsol" title="Permalink to this equation">¶</a></span>\[\vec b = {\frac{ \vec x }{\vec u_c}}\]</div>
<p>where division here means element-by-element division of the respective
components of the <span class="math notranslate nohighlight">\(S \times 1\)</span> vectors <span class="math notranslate nohighlight">\(\vec x\)</span> and
<span class="math notranslate nohighlight">\(\vec u_c\)</span>.</p>
<p>Here is a computational algorithm:</p>
<ol>
<li><p>Start with a guess for the value for <span class="math notranslate nohighlight">\(\Phi\)</span>, then use the
first-order conditions and the feasibility conditions to compute
<span class="math notranslate nohighlight">\(c(s_t), n(s_t)\)</span> for <span class="math notranslate nohighlight">\(s \in [1,\ldots, S]\)</span> and
<span class="math notranslate nohighlight">\(c_0(s_0,b_0)\)</span> and <span class="math notranslate nohighlight">\(n_0(s_0, b_0)\)</span>, given <span class="math notranslate nohighlight">\(\Phi\)</span></p>
<ul class="simple">
<li><p>these are <span class="math notranslate nohighlight">\(2  (S+1)\)</span> equations in <span class="math notranslate nohighlight">\(2  (S+1)\)</span> unknowns</p></li>
</ul>
</li>
<li><p>Solve the <span class="math notranslate nohighlight">\(S\)</span> equations <a class="reference internal" href="#equation-lsa-xsol">(62.24)</a> for the <span class="math notranslate nohighlight">\(S\)</span> elements
of <span class="math notranslate nohighlight">\(\vec x\)</span></p>
<ul class="simple">
<li><p>these depend on <span class="math notranslate nohighlight">\(\Phi\)</span></p></li>
</ul>
</li>
<li><p>Find a <span class="math notranslate nohighlight">\(\Phi\)</span> that satisfies</p>
<div class="math notranslate nohighlight" id="equation-bellman2cons">
<span class="eqno">(62.26)<a class="headerlink" href="#equation-bellman2cons" title="Permalink to this equation">¶</a></span>\[u_{c,0} b_0 = u_{c,0} (n_0 - g_0) - u_{l,0} n_0  + \beta \sum_{s=1}^S \Pi(s | s_0) x(s)\]</div>
<p>by gradually raising <span class="math notranslate nohighlight">\(\Phi\)</span> if the left side of <a class="reference internal" href="#equation-bellman2cons">(62.26)</a>
exceeds the right side and lowering <span class="math notranslate nohighlight">\(\Phi\)</span> if the left side is less than the right side.</p>
</li>
<li><p>After computing a Ramsey allocation,  recover the flat tax rate on
labor from <a class="reference internal" href="#equation-lsa-taxr">(62.8)</a> and the implied one-period Arrow securities
prices from <a class="reference internal" href="#equation-ls101">(62.9)</a>.</p></li>
</ol>
<p>In summary, when <span class="math notranslate nohighlight">\(g_t\)</span> is a time invariant function of a Markov state
<span class="math notranslate nohighlight">\(s_t\)</span>, a Ramsey plan can be constructed by solving <span class="math notranslate nohighlight">\(3S +3\)</span>
equations in <span class="math notranslate nohighlight">\(S\)</span> components each of <span class="math notranslate nohighlight">\(\vec c\)</span>, <span class="math notranslate nohighlight">\(\vec n\)</span>, and
<span class="math notranslate nohighlight">\(\vec x\)</span> together with <span class="math notranslate nohighlight">\(n_0, c_0\)</span>, and <span class="math notranslate nohighlight">\(\Phi\)</span>.</p>
</div>
<div class="section" id="time-inconsistency">
<h3><span class="section-number">62.2.8. </span>Time Inconsistency<a class="headerlink" href="#time-inconsistency" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(\{\tau_t(s^t)\}_{t=0}^\infty, \{b_{t+1}(s_{t+1}| s^t)\}_{t=0}^\infty\)</span>
be a time <span class="math notranslate nohighlight">\(0\)</span>, state <span class="math notranslate nohighlight">\(s_0\)</span> Ramsey plan.</p>
<p>Then <span class="math notranslate nohighlight">\(\{\tau_j(s^j)\}_{j=t}^\infty, \{b_{j+1}(s_{j+1}| s^j)\}_{j=t}^\infty\)</span>
is a time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span> continuation of a time
<span class="math notranslate nohighlight">\(0\)</span>, state <span class="math notranslate nohighlight">\(s_0\)</span> Ramsey plan.</p>
<p>A time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span> Ramsey plan is a Ramsey plan that
starts from initial conditions <span class="math notranslate nohighlight">\(s^t, b_t(s_t|s^{t-1})\)</span>.</p>
<p>A time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span>
continuation of a time <span class="math notranslate nohighlight">\(0\)</span>, state <span class="math notranslate nohighlight">\(0\)</span> Ramsey plan is
<em>not</em> a time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span> Ramsey plan.</p>
<p>The means that a Ramsey plan is <em>not time consistent</em>.</p>
<p>Another way to say the same thing is that a Ramsey plan is <em>time inconsistent</em>.</p>
<p>The reason is that a continuation Ramsey plan takes <span class="math notranslate nohighlight">\(u_{ct} b_t(s_t|s^{t-1})\)</span> as given, not
<span class="math notranslate nohighlight">\(b_t(s_t|s^{t-1})\)</span>.</p>
<p>We shall discuss this more below.</p>
</div>
<div class="section" id="specification-with-crra-utility">
<h3><span class="section-number">62.2.9. </span>Specification with CRRA Utility<a class="headerlink" href="#specification-with-crra-utility" title="Permalink to this headline">¶</a></h3>
<p>In our calculations below and in a <a class="reference internal" href="amss.html"><span class="doc">subsequent lecture</span></a> based on an extension of the Lucas-Stokey model
by  Aiyagari, Marcet, Sargent, and Seppälä (2002) <span id="id2">[<a class="reference internal" href="../zreferences.html#id57">AMSS02</a>]</span>, we shall modify the one-period utility function assumed above.</p>
<p>(We adopted the preceding utility specification because it was the one used in  the original <span id="id3">[<a class="reference internal" href="../zreferences.html#id102">LS83</a>]</span> paper)</p>
<p>We will  modify their specification by instead assuming that the  representative agent has  utility function</p>
<div class="math notranslate nohighlight">
\[
u(c,n) = {\frac{c^{1-\sigma}}{1-\sigma}} - {\frac{n^{1+\gamma}}{1+\gamma}}
\]</div>
<p>where  <span class="math notranslate nohighlight">\(\sigma &gt; 0\)</span>, <span class="math notranslate nohighlight">\(\gamma &gt;0\)</span>.</p>
<p>We continue to assume that</p>
<div class="math notranslate nohighlight">
\[
c_t + g_t = n_t
\]</div>
<p>We eliminate leisure from the model.</p>
<p>We also eliminate Lucas and Stokey’s restriction that <span class="math notranslate nohighlight">\(\ell_t + n_t \leq 1\)</span>.</p>
<p>We replace these two things with the assumption that
labor <span class="math notranslate nohighlight">\(n_t \in [0, +\infty]\)</span>.</p>
<p>With these adjustments, the analysis of Lucas and Stokey prevails once we make the following replacements</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
u_\ell(c, \ell) &amp;\sim - u_n(c, n) \\
u_c(c,\ell) &amp;\sim u_c(c,n) \\
u_{\ell,\ell}(c,\ell) &amp;\sim u_{nn}(c,n) \\
u_{c,c}(c,\ell)&amp; \sim u_{c,c}(c,n) \\
u_{c,\ell} (c,\ell) &amp;\sim 0 \\
\end{aligned}
\end{split}\]</div>
<p>With these understandings, equations <a class="reference internal" href="#equation-ts-barg">(62.17)</a> and <a class="reference internal" href="#equation-ts-barg-aust">(62.18)</a> simplify in the case of the CRRA utility function.</p>
<p>They become</p>
<div class="math notranslate nohighlight" id="equation-ts-barg10">
<span class="eqno">(62.27)<a class="headerlink" href="#equation-ts-barg10" title="Permalink to this equation">¶</a></span>\[(1+\Phi) [u_c(c) + u_n(c+g)] + \Phi[c u_{cc}(c) + (c+g) u_{nn}(c+g)] = 0\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-ts-barg11">
<span class="eqno">(62.28)<a class="headerlink" href="#equation-ts-barg11" title="Permalink to this equation">¶</a></span>\[(1+\Phi) [u_c(c_0) + u_n(c_0+g_0)] + \Phi[c_0 u_{cc}(c_0) + (c_0+g_0) u_{nn}(c_0+g_0)] - \Phi u_{cc}(c_0) b_0 = 0\]</div>
<p>In equation <a class="reference internal" href="#equation-ts-barg10">(62.27)</a>, it is understood that <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(g\)</span> are each functions of the Markov state <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>In addition, the time <span class="math notranslate nohighlight">\(t=0\)</span> budget constraint is satisfied at <span class="math notranslate nohighlight">\(c_0\)</span> and initial government debt
<span class="math notranslate nohighlight">\(b_0\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-opt-tax-eqn-10">
<span class="eqno">(62.29)<a class="headerlink" href="#equation-opt-tax-eqn-10" title="Permalink to this equation">¶</a></span>\[b_0 + g_0 = \tau_0 (c_0 + g_0) + \frac{\bar b}{R_0}\]</div>
<p>where <span class="math notranslate nohighlight">\(R_0\)</span> is the gross interest rate for the Markov state <span class="math notranslate nohighlight">\(s_0\)</span> that is assumed to prevail at time <span class="math notranslate nohighlight">\(t =0\)</span>
and <span class="math notranslate nohighlight">\(\tau_0\)</span> is the time <span class="math notranslate nohighlight">\(t=0\)</span> tax rate.</p>
<p>In equation <a class="reference internal" href="#equation-opt-tax-eqn-10">(62.29)</a>, it is understood that</p>
<div class="math notranslate nohighlight">
\begin{aligned}
\tau_0 = 1 - \frac{u_{l,0}}{u_{c,0}} \\
R_0 =  \beta  \sum_{s=1}^S \Pi(s | s_0) \frac{u_c(s)}{u_{c,0}}
\end{aligned}</div></div>
<div class="section" id="sequence-implementation">
<h3><span class="section-number">62.2.10. </span>Sequence Implementation<a class="headerlink" href="#sequence-implementation" title="Permalink to this headline">¶</a></h3>
<p>The above steps are implemented in a type called SequentialAllocation</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">QuantEcon</span><span class="p">,</span> <span class="n">NLsolve</span><span class="p">,</span> <span class="n">NLopt</span><span class="p">,</span> <span class="n">LinearAlgebra</span><span class="p">,</span> <span class="n">Interpolations</span>

<span class="k">import</span> <span class="n">QuantEcon</span><span class="o">:</span> <span class="n">simulate</span>

  <span class="k">mutable struct</span> <span class="kt">Model</span><span class="p">{</span><span class="kt">TF</span> <span class="o">&lt;:</span> <span class="kt">AbstractFloat</span><span class="p">,</span>
                      <span class="kt">TM</span> <span class="o">&lt;:</span> <span class="kt">AbstractMatrix</span><span class="p">{</span><span class="kt">TF</span><span class="p">},</span>
                      <span class="kt">TV</span> <span class="o">&lt;:</span> <span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">TF</span><span class="p">}}</span>
      <span class="n">β</span><span class="o">::</span><span class="kt">TF</span>
      <span class="n">Π</span><span class="o">::</span><span class="kt">TM</span>
      <span class="n">G</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">Θ</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">transfers</span><span class="o">::</span><span class="kt">Bool</span>
      <span class="n">U</span><span class="o">::</span><span class="kt">Function</span>
      <span class="n">Uc</span><span class="o">::</span><span class="kt">Function</span>
      <span class="n">Ucc</span><span class="o">::</span><span class="kt">Function</span>
      <span class="n">Un</span><span class="o">::</span><span class="kt">Function</span>
      <span class="n">Unn</span><span class="o">::</span><span class="kt">Function</span>
      <span class="n">n_less_than_one</span><span class="o">::</span><span class="kt">Bool</span>
  <span class="k">end</span>

  <span class="k">struct</span> <span class="kt">SequentialAllocation</span><span class="p">{</span><span class="kt">TP</span> <span class="o">&lt;:</span> <span class="kt">Model</span><span class="p">,</span>
                              <span class="kt">TI</span> <span class="o">&lt;:</span> <span class="kt">Integer</span><span class="p">,</span>
                              <span class="kt">TV</span> <span class="o">&lt;:</span> <span class="kt">AbstractVector</span><span class="p">}</span>
      <span class="n">model</span><span class="o">::</span><span class="kt">TP</span>
      <span class="n">mc</span><span class="o">::</span><span class="kt">MarkovChain</span>
      <span class="n">S</span><span class="o">::</span><span class="kt">TI</span>
      <span class="n">cFB</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">nFB</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">ΞFB</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">zFB</span><span class="o">::</span><span class="kt">TV</span>
  <span class="k">end</span>

<span class="k">function</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">β</span><span class="p">,</span> <span class="n">Π</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Θ</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span><span class="n">Π</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">Π</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   <span class="c"># Number of states</span>
    <span class="c"># now find the first best allocation</span>
    <span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">ΞFB</span><span class="p">,</span> <span class="n">zFB</span> <span class="o">=</span> <span class="n">find_first_best</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">ΞFB</span><span class="p">,</span> <span class="n">zFB</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">find_first_best</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">version</span> <span class="o">!=</span> <span class="mi">2</span>
        <span class="n">throw</span><span class="p">(</span><span class="kt">ArgumentError</span><span class="p">(</span><span class="s">&quot;version must be 1 or 2&quot;</span><span class="p">))</span>
    <span class="k">end</span>
    <span class="n">β</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Π</span> <span class="o">=</span>
        <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span>
    <span class="k">function</span> <span class="n">res!</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span> <span class="o">=</span> <span class="n">Θ</span> <span class="o">.*</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">Θ</span> <span class="o">.*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span>
    <span class="k">end</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">nlsolve</span><span class="p">(</span><span class="n">res!</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">converged</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;Could not find first best&quot;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">cFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">zero</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="n">nFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">zero</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">ΞFB</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">)</span>         <span class="c"># Multiplier on the resource constraint</span>
        <span class="n">zFB</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">ΞFB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">ΞFB</span><span class="p">,</span> <span class="n">zFB</span>
    <span class="k">elseif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">cFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">zero</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="n">nFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">zero</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">IFB</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">)</span> <span class="o">.*</span> <span class="n">cFB</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">)</span> <span class="o">.*</span> <span class="n">nFB</span>
        <span class="n">xFB</span> <span class="o">=</span> <span class="o">\</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">Π</span><span class="p">,</span> <span class="n">IFB</span><span class="p">)</span>
        <span class="n">zFB</span> <span class="o">=</span> <span class="p">[</span><span class="n">vcat</span><span class="p">(</span><span class="n">cFB</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">xFB</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">xFB</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">IFB</span><span class="p">,</span> <span class="n">xFB</span><span class="p">,</span> <span class="n">zFB</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">time1_allocation</span><span class="p">(</span><span class="n">pas</span><span class="o">::</span><span class="kt">SequentialAllocation</span><span class="p">,</span> <span class="n">μ</span><span class="p">)</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">pas</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">pas</span><span class="o">.</span><span class="n">S</span>
    <span class="n">Θ</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">Π</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span> <span class="o">=</span>
        <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
        <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Ucc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Unn</span>
    <span class="k">function</span> <span class="n">FOC!</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="n">S</span><span class="p">]</span>
        <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="n">c</span> <span class="o">.+</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">.-</span> <span class="n">Ξ</span> <span class="c"># FOC c</span>
        <span class="n">out</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="n">S</span><span class="p">]</span> <span class="o">=</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="n">n</span> <span class="o">.+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="n">Θ</span> <span class="o">.*</span> <span class="n">Ξ</span> <span class="c"># FOC n</span>
        <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">Θ</span> <span class="o">.*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span> <span class="c"># Resource constraint</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">end</span>
    <span class="c"># Find the root of the FOC</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">nlsolve</span><span class="p">(</span><span class="n">FOC!</span><span class="p">,</span> <span class="n">pas</span><span class="o">.</span><span class="n">zFB</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">f_converged</span> <span class="o">==</span> <span class="nb">false</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;Could not find LS allocation.&quot;</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">zero</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
    <span class="c"># Now compute x</span>
    <span class="n">Inv</span>  <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="n">c</span> <span class="o">+</span>  <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="n">n</span>
    <span class="n">x</span> <span class="o">=</span> <span class="o">\</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">Inv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">time0_allocation</span><span class="p">(</span><span class="n">pas</span><span class="o">::</span><span class="kt">SequentialAllocation</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pas</span><span class="o">.</span><span class="n">model</span>
    <span class="n">Π</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span>
    <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span> <span class="o">=</span>
        <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Ucc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Unn</span>

    <span class="c"># First order conditions of planner&#39;s problem</span>
    <span class="k">function</span> <span class="n">FOC!</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">μ</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">xprime</span> <span class="o">=</span> <span class="n">time1_allocation</span><span class="p">(</span><span class="n">pas</span><span class="p">,</span> <span class="n">μ</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">.=</span> <span class="n">vcat</span><span class="p">(</span>
            <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">.+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">s_0</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">xprime</span><span class="p">),</span>
            <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="n">Ξ</span><span class="p">,</span>
            <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">.*</span> <span class="n">n</span> <span class="o">.+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="n">Θ</span><span class="p">[</span><span class="n">s_0</span><span class="p">]</span> <span class="o">.*</span> <span class="n">Ξ</span><span class="p">,</span>
            <span class="p">(</span><span class="n">Θ</span> <span class="o">.*</span> <span class="n">n</span> <span class="o">.-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">)[</span><span class="n">s_0</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">end</span>

    <span class="c"># Find root</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">nlsolve</span><span class="p">(</span><span class="n">FOC!</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pas</span><span class="o">.</span><span class="n">cFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">],</span> <span class="n">pas</span><span class="o">.</span><span class="n">nFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">],</span> <span class="n">pas</span><span class="o">.</span><span class="n">ΞFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">f_converged</span> <span class="o">==</span> <span class="nb">false</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;Could not find time 0 LS allocation.&quot;</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">zero</span><span class="o">...</span><span class="p">,)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">time1_value</span><span class="p">(</span><span class="n">pas</span><span class="o">::</span><span class="kt">SequentialAllocation</span><span class="p">,</span> <span class="n">μ</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pas</span><span class="o">.</span><span class="n">model</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">time1_allocation</span><span class="p">(</span><span class="n">pas</span><span class="p">,</span> <span class="n">μ</span><span class="p">)</span>
    <span class="n">U_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="o">\</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">U_val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">Τ</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="o">.</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="o">.</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">.+</span> <span class="n">Un</span> <span class="o">./</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Θ</span> <span class="o">.*</span> <span class="n">Uc</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">simulate</span><span class="p">(</span><span class="n">pas</span><span class="o">::</span><span class="kt">SequentialAllocation</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span> <span class="o">=</span> <span class="nb">nothing</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">pas</span><span class="o">.</span><span class="n">model</span>
    <span class="n">Π</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">Uc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span>

    <span class="k">if</span> <span class="n">isnothing</span><span class="p">(</span><span class="n">sHist</span><span class="p">)</span>
        <span class="n">sHist</span> <span class="o">=</span> <span class="n">QuantEcon</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">pas</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">s_0</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">cHist</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">nHist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">Bhist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">ΤHist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">μHist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">RHist</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># time 0</span>
    <span class="n">μ</span><span class="p">,</span> <span class="n">cHist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_</span>  <span class="o">=</span> <span class="n">time0_allocation</span><span class="p">(</span><span class="n">pas</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>
    <span class="n">ΤHist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Τ</span><span class="p">(</span><span class="n">pas</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">cHist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="n">s_0</span><span class="p">]</span>
    <span class="n">Bhist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">B_</span>
    <span class="n">μHist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">μ</span>
    <span class="c"># time 1 onward</span>
    <span class="k">for</span> <span class="n">t</span> <span class="k">in</span> <span class="mi">2</span><span class="o">:</span><span class="n">T</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">time1_allocation</span><span class="p">(</span><span class="n">pas</span><span class="p">,</span><span class="n">μ</span><span class="p">)</span>
        <span class="n">u_c</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">ΤHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Τ</span><span class="p">(</span><span class="n">pas</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">Eu_c</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="o">:</span><span class="p">],</span> <span class="n">u_c</span><span class="p">)</span>
        <span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Bhist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">u_c</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">RHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">Eu_c</span><span class="p">)</span>
        <span class="n">μHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">μ</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">sHist</span><span class="p">,</span> <span class="n">μHist</span><span class="p">,</span> <span class="n">RHist</span>
<span class="k">end</span>

  <span class="k">mutable struct</span> <span class="kt">BellmanEquation</span><span class="p">{</span><span class="kt">TP</span> <span class="o">&lt;:</span> <span class="kt">Model</span><span class="p">,</span>
                              <span class="kt">TI</span> <span class="o">&lt;:</span> <span class="kt">Integer</span><span class="p">,</span>
                              <span class="kt">TV</span> <span class="o">&lt;:</span> <span class="kt">AbstractVector</span><span class="p">,</span>
                              <span class="kt">TM</span> <span class="o">&lt;:</span> <span class="kt">AbstractMatrix</span><span class="p">{</span><span class="kt">TV</span><span class="p">},</span>
                              <span class="kt">TVV</span> <span class="o">&lt;:</span> <span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">TV</span><span class="p">}}</span>
      <span class="n">model</span><span class="o">::</span><span class="kt">TP</span>
      <span class="n">S</span><span class="o">::</span><span class="kt">TI</span>
      <span class="n">xbar</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">time_0</span><span class="o">::</span><span class="kt">Bool</span>
      <span class="n">z0</span><span class="o">::</span><span class="kt">TM</span>
      <span class="n">cFB</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">nFB</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">xFB</span><span class="o">::</span><span class="kt">TV</span>
      <span class="n">zFB</span><span class="o">::</span><span class="kt">TVV</span>
  <span class="k">end</span>

<span class="k">function</span> <span class="n">BellmanEquation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">policies0</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Number of states</span>
    <span class="n">xbar</span> <span class="o">=</span> <span class="n">collect</span><span class="p">(</span><span class="n">extrema</span><span class="p">(</span><span class="n">xgrid</span><span class="p">))</span>
    <span class="n">time_0</span> <span class="o">=</span> <span class="nb">false</span>
    <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span> <span class="o">=</span> <span class="n">policies0</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="p">[</span><span class="n">vcat</span><span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="n">s</span><span class="p">](</span><span class="n">x</span><span class="p">),</span> <span class="n">nf</span><span class="p">[</span><span class="n">s</span><span class="p">](</span><span class="n">x</span><span class="p">),</span> <span class="p">[</span><span class="n">xprimef</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">sprime</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">sprime</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">])</span>
             <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
    <span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">IFB</span><span class="p">,</span> <span class="n">xFB</span><span class="p">,</span> <span class="n">zFB</span> <span class="o">=</span> <span class="n">find_first_best</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">BellmanEquation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">xbar</span><span class="p">,</span> <span class="n">time_0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">cFB</span><span class="p">,</span> <span class="n">nFB</span><span class="p">,</span> <span class="n">xFB</span><span class="p">,</span> <span class="n">zFB</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">get_policies_time1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">i_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Vf</span><span class="p">)</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">S</span>
    <span class="n">β</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Π</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span>

    <span class="k">function</span> <span class="n">objf</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">G</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">Vprime</span> <span class="o">=</span> <span class="p">[</span><span class="n">Vf</span><span class="p">[</span><span class="n">sprime</span><span class="p">](</span><span class="n">xprime</span><span class="p">[</span><span class="n">sprime</span><span class="p">])</span> <span class="k">for</span> <span class="n">sprime</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">Vprime</span><span class="p">))</span>
    <span class="k">end</span>
    <span class="k">function</span> <span class="n">cons</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">c</span><span class="o">+</span><span class="n">G</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">xprime</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">xbar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">G</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">xbar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">Opt</span><span class="p">(</span><span class="ss">:LN_COBYLA</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">s</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">min_objective!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">objf</span><span class="p">)</span>
    <span class="n">equality_constraint!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">cons</span><span class="p">)</span>
    <span class="n">lower_bounds!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
    <span class="n">upper_bounds!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
    <span class="n">maxeval!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
    <span class="n">maxtime!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">init</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elseif</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="p">(</span><span class="n">minf</span><span class="p">,</span> <span class="n">minx</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span> <span class="o">=</span> <span class="n">optimize</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">minx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">minx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">G</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">minx</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vcat</span><span class="p">(</span><span class="o">-</span><span class="n">minf</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">s</span><span class="p">])</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">get_policies_time0</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">Vf</span><span class="p">)</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">S</span>
    <span class="n">β</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Π</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span>
    <span class="k">function</span> <span class="n">objf</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">G</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span>
        <span class="n">Vprime</span> <span class="o">=</span> <span class="p">[</span><span class="n">Vf</span><span class="p">[</span><span class="n">sprime</span><span class="p">](</span><span class="n">xprime</span><span class="p">[</span><span class="n">sprime</span><span class="p">])</span> <span class="k">for</span> <span class="n">sprime</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">Vprime</span><span class="p">))</span>
    <span class="k">end</span>
    <span class="k">function</span> <span class="n">cons</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">G</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">-</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">xprime</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">xbar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">G</span><span class="p">[</span><span class="n">s0</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">xbar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">Opt</span><span class="p">(</span><span class="ss">:LN_COBYLA</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">zFB</span><span class="p">[</span><span class="n">s0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">min_objective!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">objf</span><span class="p">)</span>
    <span class="n">equality_constraint!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">cons</span><span class="p">)</span>
    <span class="n">lower_bounds!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
    <span class="n">upper_bounds!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
    <span class="n">maxeval!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
    <span class="n">maxtime!</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">init</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">zFB</span><span class="p">[</span><span class="n">s0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">zFB</span><span class="p">[</span><span class="n">s0</span><span class="p">][</span><span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elseif</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">init</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="p">(</span><span class="n">minf</span><span class="p">,</span> <span class="n">minx</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span> <span class="o">=</span> <span class="n">optimize</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vcat</span><span class="p">(</span><span class="o">-</span><span class="n">minf</span><span class="p">,</span> <span class="n">vcat</span><span class="p">(</span><span class="n">minx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">minx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">G</span><span class="p">[</span><span class="n">s0</span><span class="p">],</span> <span class="n">minx</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get_policies_time0 (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="recursive-formulation-of-the-ramsey-problem">
<h2><a class="toc-backref" href="#id8"><span class="section-number">62.3. </span>Recursive Formulation of the Ramsey problem</a><a class="headerlink" href="#recursive-formulation-of-the-ramsey-problem" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\(x_t(s^t) = u_c(s^t) b_t(s_t | s^{t-1})\)</span> in equation <a class="reference internal" href="#equation-lsa-budget">(62.21)</a>
appears to be a purely “forward-looking” variable.</p>
<p>But <span class="math notranslate nohighlight">\(x_t(s^t)\)</span> is a also a  natural candidate for a state variable in
a recursive formulation of the Ramsey problem.</p>
<div class="section" id="intertemporal-delegation">
<h3><span class="section-number">62.3.1. </span>Intertemporal Delegation<a class="headerlink" href="#intertemporal-delegation" title="Permalink to this headline">¶</a></h3>
<p>To express a Ramsey plan recursively, we imagine that a time <span class="math notranslate nohighlight">\(0\)</span>
Ramsey planner is followed by a sequence of continuation Ramsey planners
at times <span class="math notranslate nohighlight">\(t = 1, 2, \ldots\)</span>.</p>
<p>A “continuation Ramsey planner” has a
different objective function and faces different constraints than a
Ramsey planner.</p>
<p>A key step in representing a Ramsey plan recursively is
to regard the marginal utility scaled government debts
<span class="math notranslate nohighlight">\(x_t(s^t) = u_c(s^t) b_t(s_t|s^{t-1})\)</span> as predetermined quantities
that continuation Ramsey planners at times <span class="math notranslate nohighlight">\(t \geq 1\)</span> are
obligated to attain.</p>
<p>Continuation Ramsey planners do this by choosing continuation policies that induce the representative
household to make choices that imply that <span class="math notranslate nohighlight">\(u_c(s^t) b_t(s_t|s^{t-1})= x_t(s^t)\)</span>.</p>
<p>A time <span class="math notranslate nohighlight">\(t\geq 1\)</span> continuation Ramsey planner
delivers <span class="math notranslate nohighlight">\(x_t\)</span> by choosing a suitable <span class="math notranslate nohighlight">\(n_t, c_t\)</span> pair and a list of
<span class="math notranslate nohighlight">\(s_{t+1}\)</span>-contingent continuation quantities <span class="math notranslate nohighlight">\(x_{t+1}\)</span> to
bequeath to a time <span class="math notranslate nohighlight">\(t+1\)</span> continuation Ramsey planner.</p>
<p>A time <span class="math notranslate nohighlight">\(t \geq 1\)</span> continuation Ramsey planner faces <span class="math notranslate nohighlight">\(x_t, s_t\)</span> as
state variables.</p>
<p>But the time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner faces <span class="math notranslate nohighlight">\(b_0\)</span>, not <span class="math notranslate nohighlight">\(x_0\)</span>,
as a state variable.</p>
<p>Furthermore, the Ramsey planner cares about <span class="math notranslate nohighlight">\((c_0(s_0), \ell_0(s_0))\)</span>, while
continuation Ramsey planners do not.</p>
<p>The time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner
hands <span class="math notranslate nohighlight">\(x_1\)</span> as a function of <span class="math notranslate nohighlight">\(s_1\)</span> to a time <span class="math notranslate nohighlight">\(1\)</span>
continuation Ramsey planner.</p>
<p>These lines of delegated authorities and
responsibilities across time express the continuation Ramsey planners’
obligations to implement their parts of the original Ramsey plan,
designed once-and-for-all at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
</div>
<div class="section" id="two-bellman-equations">
<h3><span class="section-number">62.3.2. </span>Two Bellman Equations<a class="headerlink" href="#two-bellman-equations" title="Permalink to this headline">¶</a></h3>
<p>After <span class="math notranslate nohighlight">\(s_t\)</span> has been realized at time <span class="math notranslate nohighlight">\(t \geq 1\)</span>, the state
variables confronting the time <span class="math notranslate nohighlight">\(t\)</span> <strong>continuation Ramsey planner</strong> are
<span class="math notranslate nohighlight">\((x_t, s_t)\)</span>.</p>
<ul class="simple">
<li><p>Let <span class="math notranslate nohighlight">\(V(x, s)\)</span> be the value of a <strong>continuation Ramsey plan</strong> at <span class="math notranslate nohighlight">\(x_t = x, s_t =s\)</span> for <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(W(b, s)\)</span> be the value of a <strong>Ramsey plan</strong> at time <span class="math notranslate nohighlight">\(0\)</span> at <span class="math notranslate nohighlight">\(b_0=b\)</span> and <span class="math notranslate nohighlight">\(s_0 = s\)</span>.</p></li>
</ul>
<p>We work backwards by presenting a Bellman equation for
<span class="math notranslate nohighlight">\(V(x,s)\)</span> first, then a Bellman equation for <span class="math notranslate nohighlight">\(W(b,s)\)</span>.</p>
</div>
<div class="section" id="the-continuation-ramsey-problem">
<h3><span class="section-number">62.3.3. </span>The Continuation Ramsey Problem<a class="headerlink" href="#the-continuation-ramsey-problem" title="Permalink to this headline">¶</a></h3>
<p>The Bellman equation for a time <span class="math notranslate nohighlight">\(t \geq 1\)</span> continuation Ramsey
planner is</p>
<div class="math notranslate nohighlight" id="equation-lsa-bellman1">
<span class="eqno">(62.30)<a class="headerlink" href="#equation-lsa-bellman1" title="Permalink to this equation">¶</a></span>\[V(x, s) = \max_{n, \{x'(s')\}} u(n-g(s), 1-n) + \beta \sum_{s'\in S} \Pi(s'| s) V(x', s')\]</div>
<p>where maximization over <span class="math notranslate nohighlight">\(n\)</span> and the <span class="math notranslate nohighlight">\(S\)</span> elements of
<span class="math notranslate nohighlight">\(x'(s')\)</span> is subject to the single implementability constraint for
<span class="math notranslate nohighlight">\(t \geq 1\)</span></p>
<div class="math notranslate nohighlight" id="equation-lsa-bellman1cons">
<span class="eqno">(62.31)<a class="headerlink" href="#equation-lsa-bellman1cons" title="Permalink to this equation">¶</a></span>\[x = u_c(n-g(s)) -  u_l n + \beta \sum_{s' \in {\cal S}} \Pi(s' | s) x'(s')\]</div>
<p>Here <span class="math notranslate nohighlight">\(u_c\)</span> and <span class="math notranslate nohighlight">\(u_l\)</span> are today’s values of the marginal utilities.</p>
<p>For each given value of <span class="math notranslate nohighlight">\(x, s\)</span>, the continuation Ramsey planner chooses <span class="math notranslate nohighlight">\(n\)</span> and an <span class="math notranslate nohighlight">\(x'(s')\)</span>
for each <span class="math notranslate nohighlight">\(s' \in {\cal S}\)</span>.</p>
<p>Associated with a value function <span class="math notranslate nohighlight">\(V(x,s)\)</span> that solves Bellman equation <a class="reference internal" href="#equation-lsa-bellman1">(62.30)</a>
are <span class="math notranslate nohighlight">\(S+1\)</span> time-invariant policy functions</p>
<div class="math notranslate nohighlight" id="equation-rrpolicyt">
<span class="eqno">(62.32)<a class="headerlink" href="#equation-rrpolicyt" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
    n_t &amp; = f(x_t, s_t), \quad t \geq 1
    \\
    x_{t+1}(s_{t+1}) &amp; = h(s_{t+1}; x_t, s_t), \, s_{t+1} \in  {\cal S}, \, t \geq 1
\end{aligned}\end{split}\]</div>
</div>
<div class="section" id="the-ramsey-problem">
<h3><span class="section-number">62.3.4. </span>The Ramsey Problem<a class="headerlink" href="#the-ramsey-problem" title="Permalink to this headline">¶</a></h3>
<p>The Bellman equation for the time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner is</p>
<div class="math notranslate nohighlight" id="equation-lsa-bellman2">
<span class="eqno">(62.33)<a class="headerlink" href="#equation-lsa-bellman2" title="Permalink to this equation">¶</a></span>\[W(b_0, s_0) = \max_{n_0, \{x'(s_1)\}} u(n_0 - g_0, 1 - n_0) + \beta \sum_{s_1 \in {\cal S}} \Pi(s_1| s_0) V( x'(s_1), s_1)\]</div>
<p>where maximization over <span class="math notranslate nohighlight">\(n_0\)</span> and the <span class="math notranslate nohighlight">\(S\)</span> elements of
<span class="math notranslate nohighlight">\(x'(s_1)\)</span> is subject to the time <span class="math notranslate nohighlight">\(0\)</span> implementability
constraint</p>
<div class="math notranslate nohighlight" id="equation-bellman2cons2">
<span class="eqno">(62.34)<a class="headerlink" href="#equation-bellman2cons2" title="Permalink to this equation">¶</a></span>\[u_{c,0} b_0 = u_{c,0} (n_0 - g_0) - u_{l,0} n_0  + \beta \sum_{s_1\in {\cal S}} \Pi(s_1 | s_0) x'(s_1)\]</div>
<p>coming from restriction <a class="reference internal" href="#equation-bellman2cons">(62.26)</a>.</p>
<p>Associated with a value function <span class="math notranslate nohighlight">\(W(b_0, n_0)\)</span> that solves  Bellman equation <a class="reference internal" href="#equation-lsa-bellman2">(62.33)</a> are
<span class="math notranslate nohighlight">\(S +1\)</span> time <span class="math notranslate nohighlight">\(0\)</span> policy functions</p>
<div class="math notranslate nohighlight" id="equation-rrpolicy0">
<span class="eqno">(62.35)<a class="headerlink" href="#equation-rrpolicy0" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
    n_0
        &amp; = f_0(b_0, s_0) \cr
    x_1(s_1)
        &amp; = h_0(s_1; b_0, s_0)
\end{aligned}\]</div>
<p>Notice the appearance of state variables <span class="math notranslate nohighlight">\((b_0, s_0)\)</span> in the time
<span class="math notranslate nohighlight">\(0\)</span> policy functions for the Ramsey planner as compared to
<span class="math notranslate nohighlight">\((x_t, s_t)\)</span> in the policy functions <a class="reference internal" href="#equation-rrpolicyt">(62.32)</a> for the time <span class="math notranslate nohighlight">\(t \geq 1\)</span>
continuation Ramsey planners.</p>
<p>The value function <span class="math notranslate nohighlight">\(V(x_t, s_t)\)</span> of the time <span class="math notranslate nohighlight">\(t\)</span>
continuation Ramsey planner equals
<span class="math notranslate nohighlight">\(E_t \sum_{\tau = t}^\infty \beta^{\tau - t} u(c_t, l_t)\)</span>, where
the consumption and leisure processes are evaluated along the original
time <span class="math notranslate nohighlight">\(0\)</span> Ramsey plan.</p>
</div>
<div class="section" id="first-order-conditions">
<h3><span class="section-number">62.3.5. </span>First-Order Conditions<a class="headerlink" href="#first-order-conditions" title="Permalink to this headline">¶</a></h3>
<p>Attach a Lagrange multiplier <span class="math notranslate nohighlight">\(\Phi_1(x,s)\)</span> to constraint <a class="reference internal" href="#equation-lsa-bellman1cons">(62.31)</a> and a
Lagrange multiplier <span class="math notranslate nohighlight">\(\Phi_0\)</span> to constraint <a class="reference internal" href="#equation-bellman2cons">(62.26)</a>.</p>
<p>Time <span class="math notranslate nohighlight">\(t \geq 1\)</span>: the first-order conditions for the time <span class="math notranslate nohighlight">\(t \geq 1\)</span> constrained
maximization problem on the right side of the continuation Ramsey
planner’s Bellman equation <a class="reference internal" href="#equation-lsa-bellman1">(62.30)</a> are</p>
<div class="math notranslate nohighlight" id="equation-lsarxt">
<span class="eqno">(62.36)<a class="headerlink" href="#equation-lsarxt" title="Permalink to this equation">¶</a></span>\[\beta \Pi(s' | s) V_x (x', s') - \beta \Pi(s' | s) \Phi_1 = 0\]</div>
<p>for <span class="math notranslate nohighlight">\(x'(s')\)</span> and</p>
<div class="math notranslate nohighlight" id="equation-lsarnt">
<span class="eqno">(62.37)<a class="headerlink" href="#equation-lsarnt" title="Permalink to this equation">¶</a></span>\[(1 + \Phi_1) (u_c - u_l ) + \Phi_1 \left[ n (u_{ll} - u_{lc}) + (n-g(s)) (u_{cc} - u_{lc})  \right] = 0\]</div>
<p>for <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>Given <span class="math notranslate nohighlight">\(\Phi_1\)</span>, equation <a class="reference internal" href="#equation-lsarnt">(62.37)</a> is one equation to be
solved for <span class="math notranslate nohighlight">\(n\)</span> as a function of <span class="math notranslate nohighlight">\(s\)</span> (or of <span class="math notranslate nohighlight">\(g(s)\)</span>).</p>
<p>Equation <a class="reference internal" href="#equation-lsarxt">(62.36)</a> implies <span class="math notranslate nohighlight">\(V_x(x', s')= \Phi_1\)</span>, while an envelope
condition is <span class="math notranslate nohighlight">\(V_x(x,s) = \Phi_1\)</span>, so it follows that</p>
<div class="math notranslate nohighlight" id="equation-lsaenv">
<span class="eqno">(62.38)<a class="headerlink" href="#equation-lsaenv" title="Permalink to this equation">¶</a></span>\[V_x(x', s') = V_x(x,s) = \Phi_1(x,s)\]</div>
<p>Time <span class="math notranslate nohighlight">\(t=0\)</span>: For the time <span class="math notranslate nohighlight">\(0\)</span> problem on the right side of the Ramsey planner’s
Bellman equation <a class="reference internal" href="#equation-lsa-bellman2">(62.33)</a>,  first-order conditions are</p>
<div class="math notranslate nohighlight" id="equation-lsax0">
<span class="eqno">(62.39)<a class="headerlink" href="#equation-lsax0" title="Permalink to this equation">¶</a></span>\[V_x(x(s_1), s_1) = \Phi_0\]</div>
<p>for <span class="math notranslate nohighlight">\(x(s_1), s_1 \in  {\cal S}\)</span>, and</p>
<div class="math notranslate nohighlight" id="equation-lsan0">
<span class="eqno">(62.40)<a class="headerlink" href="#equation-lsan0" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
    (1 + \Phi_0) (u_{c,0} - u_{n,0})
    &amp; + \Phi_0 \bigl[ n_0 (u_{ll,0} - u_{lc,0} ) +  (n_0 - g(s_0)) (u_{cc,0} - u_{cl,0}) \Bigr]
    \\
    &amp; \quad \quad \quad -  \Phi_0 (u_{cc,0} - u_{cl,0}) b_0  =  0
\end{aligned}\end{split}\]</div>
<p>Notice  similarities and differences between the first-order
conditions for <span class="math notranslate nohighlight">\(t \geq 1\)</span> and for <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>An additional term is present in <a class="reference internal" href="#equation-lsan0">(62.40)</a> except in  three special cases</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(b_0 = 0\)</span>, or</p></li>
<li><p><span class="math notranslate nohighlight">\(u_c\)</span> is constant (i.e., preferences are quasi-linear in consumption), or</p></li>
<li><p>initial government assets are sufficiently large to finance all government
purchases with interest earnings from those assets, so that <span class="math notranslate nohighlight">\(\Phi_0= 0\)</span></p></li>
</ul>
<p>Except in these special cases, the allocation and the labor tax rate as
functions of <span class="math notranslate nohighlight">\(s_t\)</span> differ between dates <span class="math notranslate nohighlight">\(t=0\)</span> and subsequent
dates <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>Naturally, the first-order conditions in this recursive formulation of the
Ramsey problem agree with the first-order conditions derived when we first
formulated the Ramsey plan in the space of sequences.</p>
</div>
<div class="section" id="state-variable-degeneracy">
<h3><span class="section-number">62.3.6. </span>State Variable Degeneracy<a class="headerlink" href="#state-variable-degeneracy" title="Permalink to this headline">¶</a></h3>
<p>Equations <a class="reference internal" href="#equation-lsax0">(62.39)</a> and <a class="reference internal" href="#equation-lsan0">(62.40)</a> imply that <span class="math notranslate nohighlight">\(\Phi_0 = \Phi_1\)</span>
and that</p>
<div class="math notranslate nohighlight" id="equation-foncx">
<span class="eqno">(62.41)<a class="headerlink" href="#equation-foncx" title="Permalink to this equation">¶</a></span>\[V_x(x_t, s_t) = \Phi_0\]</div>
<p>for all <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
<p>When <span class="math notranslate nohighlight">\(V\)</span> is concave in <span class="math notranslate nohighlight">\(x\)</span>, this implies <em>state-variable degeneracy</em>
along a Ramsey plan in the sense that for <span class="math notranslate nohighlight">\(t \geq 1\)</span>, <span class="math notranslate nohighlight">\(x_t\)</span> will be
a time-invariant function of <span class="math notranslate nohighlight">\(s_t\)</span>.</p>
<p>Given <span class="math notranslate nohighlight">\(\Phi_0\)</span>, this function mapping <span class="math notranslate nohighlight">\(s_t\)</span> into <span class="math notranslate nohighlight">\(x_t\)</span>
can be expressed as a vector <span class="math notranslate nohighlight">\(\vec x\)</span> that solves equation <a class="reference internal" href="#equation-bellman2cons2">(62.34)</a>
for <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(c\)</span> as functions of <span class="math notranslate nohighlight">\(g\)</span> that are associated
with <span class="math notranslate nohighlight">\(\Phi = \Phi_0\)</span>.</p>
</div>
<div class="section" id="manifestations-of-time-inconsistency">
<h3><span class="section-number">62.3.7. </span>Manifestations of Time Inconsistency<a class="headerlink" href="#manifestations-of-time-inconsistency" title="Permalink to this headline">¶</a></h3>
<p>While the marginal utility adjusted level of government debt <span class="math notranslate nohighlight">\(x_t\)</span>
is a key state variable for the continuation Ramsey planners at
<span class="math notranslate nohighlight">\(t \geq 1\)</span>, it is not a state variable at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>The time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner faces <span class="math notranslate nohighlight">\(b_0\)</span>, not <span class="math notranslate nohighlight">\(x_0 = u_{c,0} b_0\)</span>, as a state variable.</p>
<p>The discrepancy in state variables faced by the time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner and the time
<span class="math notranslate nohighlight">\(t \geq 1\)</span> continuation Ramsey planners captures the differing
obligations and incentives faced by the time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner
and the time <span class="math notranslate nohighlight">\(t \geq 1\)</span> continuation Ramsey planners.</p>
<ul class="simple">
<li><p>The time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner is obligated to honor government
debt <span class="math notranslate nohighlight">\(b_0\)</span> measured in time <span class="math notranslate nohighlight">\(0\)</span> consumption goods.</p></li>
<li><p>The time <span class="math notranslate nohighlight">\(0\)</span> Ramsey planner can manipulate the <em>value</em> of government
debt as measured by <span class="math notranslate nohighlight">\(u_{c,0} b_0\)</span>.</p></li>
<li><p>In contrast, time <span class="math notranslate nohighlight">\(t \geq 1\)</span> continuation Ramsey planners are
obligated <em>not</em> to alter values of debt, as measured by
<span class="math notranslate nohighlight">\(u_{c,t} b_t\)</span>, that they inherit from a preceding Ramsey planner or
continuation Ramsey planner.</p></li>
</ul>
<p>When government expenditures <span class="math notranslate nohighlight">\(g_t\)</span> are a time invariant function
of a Markov state <span class="math notranslate nohighlight">\(s_t\)</span>, a Ramsey plan and associated Ramsey
allocation feature marginal utilities of consumption <span class="math notranslate nohighlight">\(u_c(s_t)\)</span>
that, given <span class="math notranslate nohighlight">\(\Phi\)</span>, for <span class="math notranslate nohighlight">\(t \geq 1\)</span> depend only on
<span class="math notranslate nohighlight">\(s_t\)</span>, but that for <span class="math notranslate nohighlight">\(t=0\)</span> depend on <span class="math notranslate nohighlight">\(b_0\)</span> as well.</p>
<p>This means that <span class="math notranslate nohighlight">\(u_c(s_t)\)</span> will be a time invariant function of
<span class="math notranslate nohighlight">\(s_t\)</span> for <span class="math notranslate nohighlight">\(t \geq 1\)</span>, but except when <span class="math notranslate nohighlight">\(b_0 = 0\)</span>, a
different function for <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>This in turn means that prices of
one period Arrow securities <span class="math notranslate nohighlight">\(p_{t+1}(s_{t+1} | s_t) = p(s_{t+1}|s_t)\)</span>
will be the <em>same</em> time invariant functions of <span class="math notranslate nohighlight">\((s_{t+1}, s_t)\)</span>
for <span class="math notranslate nohighlight">\(t \geq 1\)</span>, but a different function <span class="math notranslate nohighlight">\(p_0(s_1|s_0)\)</span> for
<span class="math notranslate nohighlight">\(t=0\)</span>, except when <span class="math notranslate nohighlight">\(b_0=0\)</span>.</p>
<p>The differences between these
time <span class="math notranslate nohighlight">\(0\)</span> and time <span class="math notranslate nohighlight">\(t \geq 1\)</span> objects reflect
the Ramsey planner’s incentive to manipulate Arrow security prices and,
through them, the value of initial government debt <span class="math notranslate nohighlight">\(b_0\)</span>.</p>
</div>
<div class="section" id="recursive-implementation">
<h3><span class="section-number">62.3.8. </span>Recursive Implementation<a class="headerlink" href="#recursive-implementation" title="Permalink to this headline">¶</a></h3>
<p>The above steps are implemented in a type called RecursiveAllocation</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>  <span class="k">struct</span> <span class="kt">RecursiveAllocation</span><span class="p">{</span><span class="kt">TP</span> <span class="o">&lt;:</span> <span class="kt">Model</span><span class="p">,</span> <span class="kt">TI</span> <span class="o">&lt;:</span> <span class="kt">Integer</span><span class="p">,</span>
                          <span class="kt">TVg</span> <span class="o">&lt;:</span> <span class="kt">AbstractVector</span><span class="p">,</span> <span class="kt">TVv</span> <span class="o">&lt;:</span> <span class="kt">AbstractVector</span><span class="p">,</span>
                          <span class="kt">TVp</span> <span class="o">&lt;:</span> <span class="kt">AbstractArray</span><span class="p">}</span>
      <span class="n">model</span><span class="o">::</span><span class="kt">TP</span>
      <span class="n">mc</span><span class="o">::</span><span class="kt">MarkovChain</span>
      <span class="n">S</span><span class="o">::</span><span class="kt">TI</span>
      <span class="n">T</span><span class="o">::</span><span class="kt">BellmanEquation</span>
      <span class="n">μgrid</span><span class="o">::</span><span class="kt">TVg</span>
      <span class="n">xgrid</span><span class="o">::</span><span class="kt">TVg</span>
      <span class="n">Vf</span><span class="o">::</span><span class="kt">TVv</span>
      <span class="n">policies</span><span class="o">::</span><span class="kt">TVp</span>
  <span class="k">end</span>


<span class="k">function</span> <span class="n">RecursiveAllocation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">μgrid</span><span class="p">)</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Number of states</span>
    <span class="c"># Now find the first best allocation</span>
    <span class="n">Vf</span><span class="p">,</span> <span class="n">policies</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">xgrid</span> <span class="o">=</span> <span class="n">solve_time1_bellman</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">μgrid</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">time_0</span> <span class="o">=</span> <span class="nb">true</span>      <span class="c"># Bellman equation now solves time 0 problem</span>
    <span class="k">return</span> <span class="n">RecursiveAllocation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">μgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">Vf</span><span class="p">,</span> <span class="n">policies</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">solve_time1_bellman</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">μgrid</span><span class="p">)</span>
    <span class="n">μgrid0</span> <span class="o">=</span> <span class="n">μgrid</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># First get initial fit</span>
    <span class="n">PP</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">μgrid</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">μ</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">μgrid0</span><span class="p">)</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">time1_value</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">μ</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">Vf</span> <span class="o">=</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">AbstractInterpolation</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>
    <span class="n">xprimef</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">Vf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span>
        <span class="n">cf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">sprime</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span>
            <span class="n">xprimef</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">sprime</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">s</span><span class="p">][</span><span class="k">end</span><span class="o">:-</span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">policies</span> <span class="o">=</span> <span class="p">[</span><span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span><span class="p">]</span>
    <span class="c"># Create xgrid</span>
    <span class="n">xbar</span> <span class="o">=</span> <span class="p">[</span><span class="n">maximum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">minimum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))]</span>
    <span class="n">xgrid</span> <span class="o">=</span> <span class="n">range</span><span class="p">(</span><span class="n">xbar</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="n">xbar</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">μgrid0</span><span class="p">))</span>
    <span class="c"># Now iterate on bellman equation</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">BellmanEquation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">policies</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">while</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
        <span class="k">if</span> <span class="n">T</span><span class="o">.</span><span class="n">time_0</span> <span class="o">==</span> <span class="nb">false</span>
            <span class="n">Vfnew</span><span class="p">,</span> <span class="n">policies</span> <span class="o">=</span>
                <span class="n">fit_policy_function</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span>
                <span class="p">(</span><span class="n">i_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">get_policies_time1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">i_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Vf</span><span class="p">),</span> <span class="n">xgrid</span><span class="p">)</span>
        <span class="k">elseif</span> <span class="n">T</span><span class="o">.</span><span class="n">time_0</span> <span class="o">==</span> <span class="nb">true</span>
            <span class="n">Vfnew</span><span class="p">,</span> <span class="n">policies</span> <span class="o">=</span>
                <span class="n">fit_policy_function</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span>
                <span class="p">(</span><span class="n">i_x</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">get_policies_time0</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">i_x</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">Vf</span><span class="p">),</span> <span class="n">xgrid</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;T.time_0 is </span><span class="si">$</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">time_0</span><span class="p">)</span><span class="s">, which is invalid&quot;</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">maximum</span><span class="p">(</span><span class="n">abs</span><span class="p">,</span> <span class="p">(</span><span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span><span class="o">-</span><span class="n">Vfnew</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="n">xgrid</span><span class="p">))</span><span class="o">./</span><span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
        <span class="k">end</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;diff = </span><span class="si">$diff</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">Vf</span> <span class="o">=</span> <span class="n">Vfnew</span>
    <span class="k">end</span>
    <span class="c"># Store value function policies and Bellman Equations</span>
    <span class="k">return</span> <span class="n">Vf</span><span class="p">,</span> <span class="n">policies</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">xgrid</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">fit_policy_function</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">PF</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">PP</span><span class="o">.</span><span class="n">S</span>
    <span class="n">Vf</span> <span class="o">=</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">AbstractInterpolation</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>
    <span class="n">xprimef</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">Vf</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span>
        <span class="n">PFvec</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="mi">3</span><span class="o">+</span><span class="n">S</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i_x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span>
            <span class="n">PFvec</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">i_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">cf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">nf</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">sprime</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span>
            <span class="n">xprimef</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">sprime</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearInterpolation</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="n">sprime</span><span class="p">])</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">Vf</span><span class="p">,</span> <span class="p">[</span><span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">time0_allocation</span><span class="p">(</span><span class="n">pab</span><span class="o">::</span><span class="kt">RecursiveAllocation</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">)</span>
    <span class="n">xgrid</span> <span class="o">=</span> <span class="n">pab</span><span class="o">.</span><span class="n">xgrid</span>
    <span class="k">if</span> <span class="n">pab</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">time_0</span> <span class="o">==</span> <span class="nb">false</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">get_policies_time1</span><span class="p">(</span><span class="n">pab</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">i_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">pab</span><span class="o">.</span><span class="n">Vf</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">pab</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">time_0</span> <span class="o">==</span> <span class="nb">true</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">get_policies_time0</span><span class="p">(</span><span class="n">pab</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">pab</span><span class="o">.</span><span class="n">Vf</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;T.time_0 is </span><span class="si">$</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">time_0</span><span class="p">)</span><span class="s">, which is invalid&quot;</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">c0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">xprime0</span> <span class="o">=</span> <span class="n">z0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">z0</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">z0</span><span class="p">[</span><span class="mi">4</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">c0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">xprime0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">simulate</span><span class="p">(</span><span class="n">pab</span><span class="o">::</span><span class="kt">RecursiveAllocation</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span>
                  <span class="n">sHist</span> <span class="o">=</span> <span class="n">QuantEcon</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">policies</span> <span class="o">=</span> <span class="n">pab</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">pab</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">pab</span><span class="o">.</span><span class="n">policies</span>
    <span class="n">β</span><span class="p">,</span> <span class="n">Π</span><span class="p">,</span> <span class="n">Uc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span>
    <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span> <span class="o">=</span> <span class="n">policies</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">policies</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">policies</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">cHist</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">nHist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">Bhist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">ΤHist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">μHist</span> <span class="o">=</span> <span class="n">similar</span><span class="p">(</span><span class="n">cHist</span><span class="p">)</span>
    <span class="n">RHist</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># time 0</span>
    <span class="n">cHist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">time0_allocation</span><span class="p">(</span><span class="n">pab</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>
    <span class="n">ΤHist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Τ</span><span class="p">(</span><span class="n">pab</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">cHist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="n">s_0</span><span class="p">]</span>
    <span class="n">Bhist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">B_</span>
    <span class="n">μHist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c"># time 1 onward</span>
    <span class="k">for</span> <span class="n">t</span> <span class="k">in</span> <span class="mi">2</span><span class="o">:</span><span class="n">T</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">xprime</span><span class="p">[</span><span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">nf</span><span class="p">[</span><span class="n">s</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">cf</span><span class="p">[</span><span class="n">shat</span><span class="p">](</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">shat</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="n">xprime</span> <span class="o">=</span> <span class="p">[</span><span class="n">xprimef</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">sprime</span><span class="p">](</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">sprime</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">S</span><span class="p">]</span>
        <span class="n">ΤHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Τ</span><span class="p">(</span><span class="n">pab</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">u_c</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">Eu_c</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">Π</span><span class="p">[</span><span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">:</span><span class="p">],</span> <span class="n">u_c</span><span class="p">)</span>
        <span class="n">μHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">pab</span><span class="o">.</span><span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="n">RHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">Eu_c</span><span class="p">)</span>
        <span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Bhist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">/</span> <span class="n">u_c</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">sHist</span><span class="p">,</span> <span class="n">μHist</span><span class="p">,</span> <span class="n">RHist</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>simulate (generic function with 7 methods)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id9"><span class="section-number">62.4. </span>Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="anticipated-one-period-war">
<h3><span class="section-number">62.4.1. </span>Anticipated One Period War<a class="headerlink" href="#anticipated-one-period-war" title="Permalink to this headline">¶</a></h3>
<p>This example illustrates in a simple setting how a Ramsey planner manages risk.</p>
<p>Government expenditures are known for sure in all periods except one.</p>
<ul class="simple">
<li><p>For <span class="math notranslate nohighlight">\(t&lt;3\)</span> and <span class="math notranslate nohighlight">\(t &gt; 3\)</span> we assume that <span class="math notranslate nohighlight">\(g_t = g_l = 0.1\)</span>.</p></li>
<li><p>At <span class="math notranslate nohighlight">\(t = 3\)</span> a war occcurs with probability 0.5.</p>
<ul>
<li><p>If there is war, <span class="math notranslate nohighlight">\(g_3 = g_h = 0.2\)</span>.</p></li>
<li><p>If there is no war <span class="math notranslate nohighlight">\(g_3 = g_l = 0.1\)</span>.</p></li>
</ul>
</li>
</ul>
<p>We define the components of the state vector as the following six  <span class="math notranslate nohighlight">\((t,g)\)</span>
pairs: <span class="math notranslate nohighlight">\((0,g_l),(1,g_l),(2,g_l),(3,g_l),(3,g_h), (t\geq 4,g_l)\)</span>.</p>
<p>We think of these  6 states as corresponding to <span class="math notranslate nohighlight">\(s=1,2,3,4,5,6\)</span>.</p>
<p>The transition matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Pi = \left(\begin{matrix}0 &amp; 1 &amp; 0 &amp; 0   &amp; 0   &amp; 0\\
                          0 &amp; 0 &amp; 1 &amp; 0   &amp; 0   &amp; 0\\
                          0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0.5 &amp; 0\\
                          0 &amp; 0 &amp; 0 &amp; 0   &amp; 0   &amp; 1\\
                          0 &amp; 0 &amp; 0 &amp; 0   &amp; 0   &amp; 1\\
                          0 &amp; 0 &amp; 0 &amp; 0   &amp; 0   &amp; 1\end{matrix}\right)
\end{split}\]</div>
<p>Government expenditures at  each state are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
g = \left(\begin{matrix} 0.1\\0.1\\0.1\\0.1\\0.2\\0.1 \end{matrix}\right).
\end{split}\]</div>
<p>We assume that the  representative agent has  utility function</p>
<div class="math notranslate nohighlight">
\[
u(c,n) = {\frac{c^{1-\sigma}}{1-\sigma}} - {\frac{n^{1+\gamma}}{1+\gamma}}
\]</div>
<p>and set  <span class="math notranslate nohighlight">\(\sigma = 2\)</span>, <span class="math notranslate nohighlight">\(\gamma = 2\)</span>, and the  discount factor <span class="math notranslate nohighlight">\(\beta = 0.9\)</span>.</p>
<p>Note: For convenience in terms of matching our code, we have expressed
utility as a function of <span class="math notranslate nohighlight">\(n\)</span> rather than leisure <span class="math notranslate nohighlight">\(l\)</span>.</p>
<p>This utility function is implemented in the type CRRAutility</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">crra_utility</span><span class="p">(;</span>
    <span class="n">β</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="n">σ</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">γ</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">Π</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="n">Θ</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">transfers</span> <span class="o">=</span> <span class="nb">false</span>
    <span class="p">)</span>
    <span class="k">function</span> <span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">σ</span> <span class="o">==</span> <span class="mf">1.0</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="n">U</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.^</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">.-</span> <span class="n">σ</span><span class="p">)</span> <span class="o">.-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">σ</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="k">return</span> <span class="n">U</span> <span class="o">.-</span> <span class="n">n</span><span class="o">.^</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">γ</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">γ</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="c"># Derivatives of utility function</span>
    <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span>  <span class="n">c</span><span class="o">.^</span><span class="p">(</span><span class="o">-</span><span class="n">σ</span><span class="p">)</span>
    <span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">σ</span> <span class="o">*</span> <span class="n">c</span><span class="o">.^</span><span class="p">(</span><span class="o">-</span><span class="n">σ</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span><span class="o">.^</span><span class="n">γ</span>
    <span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">γ</span> <span class="o">*</span> <span class="n">n</span><span class="o">.^</span><span class="p">(</span><span class="n">γ</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">n_less_than_one</span> <span class="o">=</span> <span class="nb">false</span>
    <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">β</span><span class="p">,</span> <span class="n">Π</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">transfers</span><span class="p">,</span>
                <span class="n">U</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span><span class="p">,</span> <span class="n">n_less_than_one</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>crra_utility (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>We set initial government debt <span class="math notranslate nohighlight">\(b_0 = 1\)</span>.</p>
<p>We can now plot the Ramsey tax  under both realizations of time <span class="math notranslate nohighlight">\(t = 3\)</span> government expenditures</p>
<ul class="simple">
<li><p>black when <span class="math notranslate nohighlight">\(g_3 = .1\)</span>, and</p></li>
<li><p>red when <span class="math notranslate nohighlight">\(g_3 = .2\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Random</span>
<span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c"># For reproducible results.</span>

<span class="n">M_time_example</span> <span class="o">=</span> <span class="n">crra_utility</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
                              <span class="n">Θ</span><span class="o">=</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>            <span class="c"># Θ can in principle be random</span>

<span class="n">M_time_example</span><span class="o">.</span><span class="n">Π</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="mf">1.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">;</span>
                    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">1.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">;</span>
                    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.5</span> <span class="mf">0.5</span> <span class="mf">0.0</span><span class="p">;</span>
                    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">;</span>
                    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">;</span>
                    <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">]</span>

<span class="n">PP_seq_time</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">M_time_example</span><span class="p">)</span>  <span class="c"># Solve sequential problem</span>

<span class="n">sHist_h</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">sHist_l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

<span class="n">sim_seq_h</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq_time</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sHist_h</span><span class="p">)</span>
<span class="n">sim_seq_l</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq_time</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sHist_l</span><span class="p">)</span>

<span class="k">using</span> <span class="n">Plots</span>
<span class="n">gr</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="ss">:png</span><span class="p">);</span>
<span class="n">titles</span> <span class="o">=</span> <span class="n">hcat</span><span class="p">(</span><span class="s">&quot;Consumption&quot;</span><span class="p">,</span>
              <span class="s">&quot;Labor Supply&quot;</span><span class="p">,</span>
              <span class="s">&quot;Government Debt&quot;</span><span class="p">,</span>
              <span class="s">&quot;Tax Rate&quot;</span><span class="p">,</span>
              <span class="s">&quot;Government Spending&quot;</span><span class="p">,</span>
              <span class="s">&quot;Output&quot;</span><span class="p">)</span>

<span class="n">sim_seq_l_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_seq_l</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span><span class="o">...</span><span class="p">,</span> <span class="n">M_time_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_l</span><span class="p">],</span>
                  <span class="n">M_time_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_l</span><span class="p">]</span><span class="o">.*</span><span class="n">sim_seq_l</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">sim_seq_h_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_seq_h</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span><span class="o">...</span><span class="p">,</span> <span class="n">M_time_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_h</span><span class="p">],</span>
                  <span class="n">M_time_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_h</span><span class="p">]</span><span class="o">.*</span><span class="n">sim_seq_h</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>


<span class="c">#plots = plot(layout=(3,2), size=(800,600))</span>
<span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot</span><span class="p">(),</span> <span class="n">plot</span><span class="p">(),</span> <span class="n">plot</span><span class="p">(),</span> <span class="n">plot</span><span class="p">(),</span> <span class="n">plot</span><span class="p">(),</span> <span class="n">plot</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">6</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sim_seq_l_plot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
          <span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sim_seq_h_plot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
          <span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">plot</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span><span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/opt_tax_recur_10_0.png" src="../_images/opt_tax_recur_10_0.png" />
</div>
</div>
<p><strong>Tax smoothing</strong></p>
<ul class="simple">
<li><p>the tax rate is constant for all  <span class="math notranslate nohighlight">\(t\geq 1\)</span></p>
<ul>
<li><p>For <span class="math notranslate nohighlight">\(t \geq 1, t \neq 3\)</span>, this is a consequence of <span class="math notranslate nohighlight">\(g_t\)</span>
being the same at all those dates</p></li>
<li><p>For <span class="math notranslate nohighlight">\(t = 3\)</span>, it is a consequence of the special one-period utility
function that we have assumed</p></li>
<li><p>Under  other one-period utility functions, the time <span class="math notranslate nohighlight">\(t=3\)</span> tax rate
could be either higher or lower than for dates <span class="math notranslate nohighlight">\(t \geq 1, t \neq 3\)</span></p></li>
</ul>
</li>
<li><p>the tax rate is the same at <span class="math notranslate nohighlight">\(t=3\)</span> for both the high <span class="math notranslate nohighlight">\(g_t\)</span> outcome and the low <span class="math notranslate nohighlight">\(g_t\)</span> outcome</p></li>
</ul>
<p>We have assumed that at <span class="math notranslate nohighlight">\(t=0\)</span>, the government owes positive debt <span class="math notranslate nohighlight">\(b_0\)</span>.</p>
<p>It sets the time <span class="math notranslate nohighlight">\(t=0\)</span> tax rate partly with an eye to reducing the value <span class="math notranslate nohighlight">\(u_{c,0} b_0\)</span> of <span class="math notranslate nohighlight">\(b_0\)</span>.</p>
<p>It does this by increasing consumption at time <span class="math notranslate nohighlight">\(t=0\)</span> relative to
consumption in later periods.</p>
<p>This has the consequence of <em>raising</em> the time <span class="math notranslate nohighlight">\(t=0\)</span> value of the  gross
interest  rate for risk-free loans between periods <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(t+1\)</span>, which  equals</p>
<div class="math notranslate nohighlight">
\[
R_t = \frac{u_{c,t}}{\beta\mathbb E_{t}[u_{c,t+1}]}
\]</div>
<p>A tax policy that makes  time <span class="math notranslate nohighlight">\(t=0\)</span> consumption be  higher than time <span class="math notranslate nohighlight">\(t=1\)</span> consumption evidently increases the
risk-free rate one-period interest rate, <span class="math notranslate nohighlight">\(R_t\)</span>, at <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>Raising the time <span class="math notranslate nohighlight">\(t=0\)</span> risk-free interest rate makes time <span class="math notranslate nohighlight">\(t=0\)</span>
consumption goods cheaper relative to consumption goods at later dates, thereby
lowering the value <span class="math notranslate nohighlight">\(u_{c,0} b_0\)</span> of initial government debt <span class="math notranslate nohighlight">\(b_0\)</span>.</p>
<p>We see this in a figure below that plots the time path for the risk free interest
rate under both realizations of the time <span class="math notranslate nohighlight">\(t=3\)</span> government expenditure shock.</p>
<p>The following plot illustrates how the government lowers the interest rate at
time 0 by raising consumption</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">sim_seq_l</span><span class="p">[</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">sim_seq_h</span><span class="p">[</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:red</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Gross Interest Rate&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/opt_tax_recur_13_0.png" src="../_images/opt_tax_recur_13_0.png" />
</div>
</div>
</div>
<div class="section" id="government-saving">
<h3><span class="section-number">62.4.2. </span>Government Saving<a class="headerlink" href="#government-saving" title="Permalink to this headline">¶</a></h3>
<p>At time  <span class="math notranslate nohighlight">\(t=0\)</span> the government evidently <em>dissaves</em> since <span class="math notranslate nohighlight">\(b_1&gt; b_0\)</span>.</p>
<ul class="simple">
<li><p>This is a consequence of it setting a <em>lower</em> tax rate at <span class="math notranslate nohighlight">\(t=0\)</span>,
implying more consumption at <span class="math notranslate nohighlight">\(t=0\)</span>.</p></li>
</ul>
<p>At time <span class="math notranslate nohighlight">\(t=1\)</span>, the government evidently <em>saves</em> since it has set the tax
rate sufficiently high to allow it to set <span class="math notranslate nohighlight">\(b_2 &lt; b_1\)</span>.</p>
<ul class="simple">
<li><p>Its motive for doing this is that it anticipates a likely war at <span class="math notranslate nohighlight">\(t=3\)</span>.</p></li>
</ul>
<p>At time <span class="math notranslate nohighlight">\(t=2\)</span> the government trades state-contingent Arrow securities
to hedge against  war at <span class="math notranslate nohighlight">\(t=3\)</span>.</p>
<ul class="simple">
<li><p>It purchases a security that pays off when <span class="math notranslate nohighlight">\(g_3 = g_h\)</span>.</p></li>
<li><p>It sells a security that  pays off when <span class="math notranslate nohighlight">\(g_3 = g_l\)</span>.</p></li>
<li><p>These purchases are designed in such a way that regardless of whether or
not there is a war at <span class="math notranslate nohighlight">\(t=3\)</span>, the government will begin  period
<span class="math notranslate nohighlight">\(t=4\)</span> with the <em>same</em> government debt.</p></li>
<li><p>The time <span class="math notranslate nohighlight">\(t=4\)</span> debt level can be serviced with revenues from the
constant tax rate set at times <span class="math notranslate nohighlight">\(t\geq 1\)</span>.</p></li>
</ul>
<p>At times <span class="math notranslate nohighlight">\(t \geq 4\)</span> the government rolls over its debt, knowing that the
tax rate is set at level required to service the interest payments
on the debt and government expenditures.</p>
</div>
<div class="section" id="time-0-manipulation-of-interest-rate">
<h3><span class="section-number">62.4.3. </span>Time 0 Manipulation of Interest Rate<a class="headerlink" href="#time-0-manipulation-of-interest-rate" title="Permalink to this headline">¶</a></h3>
<p>We have seen that when <span class="math notranslate nohighlight">\(b_0&gt;0\)</span>, the Ramsey plan sets the time <span class="math notranslate nohighlight">\(t=0\)</span>
tax rate partly with an eye toward raising a risk-free interest
rate for one-period loans between times <span class="math notranslate nohighlight">\(t=0\)</span> and <span class="math notranslate nohighlight">\(t=1\)</span>.</p>
<p>By raising this interest rate, the plan makes time <span class="math notranslate nohighlight">\(t=0\)</span> goods cheap
relative to consumption goods at later times.</p>
<p>By doing this, it lowers the value of time <span class="math notranslate nohighlight">\(t=0\)</span> debt that it has inherited
and must finance.</p>
</div>
<div class="section" id="time-0-and-time-inconsistency">
<h3><span class="section-number">62.4.4. </span>Time 0  and Time-Inconsistency<a class="headerlink" href="#time-0-and-time-inconsistency" title="Permalink to this headline">¶</a></h3>
<p>In the  preceding  example,  the Ramsey tax rate at time 0 differs from its value  at time 1.</p>
<p>To explore what is going on here, let’s simplify things by removing  the possibility of war at time <span class="math notranslate nohighlight">\(t=3\)</span>.</p>
<p>The Ramsey problem then includes no randomness because  <span class="math notranslate nohighlight">\(g_t = g_l\)</span> for all <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>The figure below plots the Ramsey tax rates and gross interest rates at time
<span class="math notranslate nohighlight">\(t=0\)</span> and time <span class="math notranslate nohighlight">\(t\geq1\)</span> as functions of the initial government debt
(using the sequential allocation solution and a CRRA utility function defined
above)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M2</span> <span class="o">=</span> <span class="n">crra_utility</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="p">[</span><span class="mf">0.15</span><span class="p">],</span> <span class="n">Π</span><span class="o">=</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Θ</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>

<span class="n">PP_seq_time0</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">M2</span><span class="p">)</span> <span class="c"># solve sequential problem</span>

<span class="n">B_vec</span> <span class="o">=</span> <span class="n">range</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">taxpolicy</span> <span class="o">=</span> <span class="kt">Matrix</span><span class="p">(</span><span class="n">hcat</span><span class="p">([</span><span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq_time0</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">B_</span> <span class="k">in</span> <span class="n">B_vec</span><span class="p">]</span><span class="o">...</span><span class="p">)</span><span class="o">&#39;</span><span class="p">)</span>
<span class="n">interest_rate</span> <span class="o">=</span> <span class="kt">Matrix</span><span class="p">(</span><span class="n">hcat</span><span class="p">([</span><span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq_time0</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="k">end</span><span class="p">]</span> <span class="k">for</span> <span class="n">B_</span> <span class="k">in</span> <span class="n">B_vec</span><span class="p">]</span><span class="o">...</span><span class="p">)</span><span class="o">&#39;</span><span class="p">)</span>

<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Tax Rate&quot;</span> <span class="s">&quot;Gross Interest Rate&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;Time , t = 0&quot;</span><span class="p">,</span> <span class="s">&quot;Time , t &gt;= 0&quot;</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">]</span>
<span class="n">plots</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">series</span><span class="p">)</span> <span class="k">in</span> <span class="n">enumerate</span><span class="p">((</span><span class="n">taxpolicy</span><span class="p">,</span> <span class="n">interest_rate</span><span class="p">))</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">B_vec</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="ss">:topleft</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">plot</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/opt_tax_recur_16_0.png" src="../_images/opt_tax_recur_16_0.png" />
</div>
</div>
<p>The figure indicates  that if the government enters with  positive debt, it sets
a tax rate at <span class="math notranslate nohighlight">\(t=0\)</span> that is less than all later tax rates.</p>
<p>By setting  a lower tax rate at <span class="math notranslate nohighlight">\(t = 0\)</span>, the government raises consumption,
which reduces the <em>value</em> <span class="math notranslate nohighlight">\(u_{c,0} b_0\)</span> of its  initial debt.</p>
<p>It does this by increasing <span class="math notranslate nohighlight">\(c_0\)</span> and thereby lowering <span class="math notranslate nohighlight">\(u_{c,0}\)</span>.</p>
<p>Conversely, if  <span class="math notranslate nohighlight">\(b_{0} &lt; 0\)</span>, the Ramsey planner sets the tax rate at <span class="math notranslate nohighlight">\(t=0\)</span>
higher than in  subsequent periods.</p>
<p>A side effect of lowering time <span class="math notranslate nohighlight">\(t=0\)</span> consumption  is that it raises  the
one-period  interest rate at time 0 above that of subsequent periods.</p>
<p>There are only two values of initial government debt at which  the tax rate is
constant for all <span class="math notranslate nohighlight">\(t \geq 0\)</span>.</p>
<p>The first is <span class="math notranslate nohighlight">\(b_{0} = 0\)</span></p>
<ul class="simple">
<li><p>Here the government can’t use the <span class="math notranslate nohighlight">\(t=0\)</span> tax rate  to alter  the
value of the initial debt.</p></li>
</ul>
<p>The second occurs when the government enters with sufficiently large  assets
that the Ramsey planner can achieve first best and sets <span class="math notranslate nohighlight">\(\tau_t = 0\)</span>
for all <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>It is only for these two values of initial government debt that the Ramsey
plan is time-consistent.</p>
<p>Another way of saying this is that, except for these two values of initial
government debt, a continuation of a Ramsey plan is not a Ramsey plan.</p>
<p>To illustrate this, consider a Ramsey planner who starts with an initial
government debt  <span class="math notranslate nohighlight">\(b_1\)</span> associated with one of the Ramsey plans computed above.</p>
<p>Call <span class="math notranslate nohighlight">\(\tau_1^R\)</span> the time <span class="math notranslate nohighlight">\(t=0\)</span> tax rate chosen by the Ramsey planner
confronting this value for initial government debt government.</p>
<p>The figure below shows both  the tax rate  at time 1 chosen by our original
Ramsey planner and what a new Ramsey planner would choose for its
time <span class="math notranslate nohighlight">\(t=0\)</span> tax rate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Compute the debt entered with at time 1</span>
<span class="n">B1_vec</span> <span class="o">=</span> <span class="n">hcat</span><span class="p">([</span><span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq_time0</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">B_</span> <span class="k">in</span> <span class="n">B_vec</span><span class="p">]</span><span class="o">...</span><span class="p">)</span><span class="o">&#39;</span>

<span class="c"># Compute the optimal policy if the government could reset</span>
<span class="n">tau1_reset</span> <span class="o">=</span> <span class="kt">Matrix</span><span class="p">(</span><span class="n">hcat</span><span class="p">([</span><span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq_time0</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">B1</span> <span class="k">in</span> <span class="n">B1_vec</span><span class="p">]</span><span class="o">...</span><span class="p">)</span><span class="o">&#39;</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">B_vec</span><span class="p">,</span> <span class="n">taxpolicy</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;tau_1&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">B_vec</span><span class="p">,</span> <span class="n">tau1_reset</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;tau_1^R&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Tax Rate&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;Initial Government Debt&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="ss">:topleft</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/opt_tax_recur_19_0.png" src="../_images/opt_tax_recur_19_0.png" />
</div>
</div>
<p>The tax rates in the figure are equal  for only two values of initial government debt.</p>
</div>
<div class="section" id="tax-smoothing-and-non-crra-preferences">
<h3><span class="section-number">62.4.5. </span>Tax Smoothing and non-CRRA Preferences<a class="headerlink" href="#tax-smoothing-and-non-crra-preferences" title="Permalink to this headline">¶</a></h3>
<p>The complete tax smoothing for <span class="math notranslate nohighlight">\(t \geq 1\)</span> in the preceding example is a
consequence of our having assumed CRRA preferences.</p>
<p>To see what is driving this outcome, we begin by noting that the Ramsey tax rate for <span class="math notranslate nohighlight">\(t\geq 1\)</span> is
a time invariant function <span class="math notranslate nohighlight">\(\tau(\Phi,g)\)</span> of the Lagrange multiplier on
the implementability constraint and government expenditures.</p>
<p>For CRRA preferences, we can exploit the relations <span class="math notranslate nohighlight">\(U_{cc}c = -\sigma U_c\)</span>
and <span class="math notranslate nohighlight">\(U_{nn} n = \gamma U_n\)</span> to derive</p>
<div class="math notranslate nohighlight">
\[
\frac{(1+(1-\sigma)\Phi)U_c}{(1+(1-\gamma)\Phi)U_n} = 1
\]</div>
<p>from the first-order conditions.</p>
<p>This equation immediately implies that the tax rate is constant.</p>
<p>For other  preferences, the tax rate may not be constant.</p>
<p>For example, let the period utility function be</p>
<div class="math notranslate nohighlight">
\[
u(c,n) = \log(c) + 0.69 \log(1-n)
\]</div>
<p>We will write a new constructor LogUtility to represent this utility function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">log_utility</span><span class="p">(;</span><span class="n">β</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
                      <span class="n">ψ</span> <span class="o">=</span> <span class="mf">0.69</span><span class="p">,</span>
                      <span class="n">Π</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                      <span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
                      <span class="n">Θ</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                      <span class="n">transfers</span> <span class="o">=</span> <span class="nb">false</span><span class="p">)</span>
    <span class="c"># Derivatives of utility function</span>
    <span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">ψ</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">./</span> <span class="n">c</span>
    <span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">.^</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">ψ</span> <span class="o">./</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">.-</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">ψ</span> <span class="o">./</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">.-</span> <span class="n">n</span><span class="p">)</span><span class="o">.^</span><span class="mf">2.0</span>
    <span class="n">n_less_than_one</span> <span class="o">=</span> <span class="nb">true</span>
    <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">β</span><span class="p">,</span> <span class="n">Π</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">transfers</span><span class="p">,</span>
                <span class="n">U</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span><span class="p">,</span> <span class="n">n_less_than_one</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>log_utility (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Also suppose that <span class="math notranslate nohighlight">\(g_t\)</span> follows a two state i.i.d. process with equal
probabilities attached to <span class="math notranslate nohighlight">\(g_l\)</span> and <span class="math notranslate nohighlight">\(g_h\)</span>.</p>
<p>To compute the tax rate, we will use both the sequential and recursive approaches described above.</p>
<p>The figure below plots a sample path of the Ramsey tax rate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span> <span class="o">=</span> <span class="n">log_utility</span><span class="p">()</span>
<span class="n">μ_grid</span> <span class="o">=</span> <span class="n">range</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">PP_seq</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span>         <span class="c"># Solve sequential problem</span>
<span class="n">PP_bel</span> <span class="o">=</span> <span class="n">RecursiveAllocation</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span> <span class="n">μ_grid</span><span class="p">)</span>  <span class="c"># Solve recursive problem</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sHist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c"># Simulate</span>
<span class="n">sim_seq</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">PP_seq</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="p">)</span>
<span class="n">sim_bel</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">PP_bel</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="p">)</span>

<span class="c"># Plot policies</span>
<span class="n">sim_seq_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_seq</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span><span class="o">...</span><span class="p">,</span> <span class="n">M1</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist</span><span class="p">],</span> <span class="n">M1</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist</span><span class="p">]</span><span class="o">.*</span><span class="n">sim_seq</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">sim_bel_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_bel</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span><span class="o">...</span><span class="p">,</span> <span class="n">M1</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist</span><span class="p">],</span> <span class="n">M1</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist</span><span class="p">]</span><span class="o">.*</span><span class="n">sim_bel</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

<span class="n">titles</span> <span class="o">=</span> <span class="n">hcat</span><span class="p">(</span><span class="s">&quot;Consumption&quot;</span><span class="p">,</span>
              <span class="s">&quot;Labor Supply&quot;</span><span class="p">,</span>
              <span class="s">&quot;Government Debt&quot;</span><span class="p">,</span>
              <span class="s">&quot;Tax Rate&quot;</span><span class="p">,</span>
              <span class="s">&quot;Government Spending&quot;</span><span class="p">,</span>
              <span class="s">&quot;Output&quot;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;Sequential&quot;</span><span class="p">,</span> <span class="s">&quot;Recursive&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">]]</span>
<span class="n">plots</span><span class="o">=</span><span class="n">plot</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">850</span><span class="p">,</span><span class="mi">780</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">6</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sim_seq_plot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span>
          <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sim_bel_plot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:blue</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="ss">:xcross</span><span class="p">,</span>
          <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">plot!</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="ss">:topright</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">plot</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.0003504611535379196 
diff = 0.00015786467839251848 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 7.134538369033326e-5 
diff = 3.240325889980222e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.4850584169732637e-5 
diff = 6.9199966210918075e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.007633841206684349 
diff = 0.0042315413689325 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.011003257095209365 
diff = 0.009025899622264383 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.011029820972004084 
diff = 0.009138572547135657 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.0027688570854821205 
diff = 0.0012886432189945247 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.0006792502472100061 
diff = 0.0006059238897073732 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.000546192736883661 
diff = 0.0004871143609629563 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.007233703676330078 
diff = 0.0046399958567858186 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.0026948748211455343 
diff = 0.0019417659834419132 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.0006015260537699934 
diff = 0.0005220841060280039 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00046041214620906444 
diff = 0.00041299668841516006 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00037188121299882134 
diff = 0.00033458376975959586 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00030100804272793026 
diff = 0.00027081864175841007 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00024367736784588215 
diff = 0.00021924926112555567 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00019728037284475947 
diff = 0.00017750864941509694 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.0001597256213662803 
diff = 0.0001437307542939807 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00012932922444445293 
diff = 0.00011636766340985798 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 0.00010471154730775471 
diff = 9.422150209681003e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 8.478590387726093e-5 
diff = 7.629599551060741e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 6.865651294856593e-5 
diff = 6.178229857866346e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 5.559647323883501e-5 
diff = 5.003204209437783e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 4.5024329591253244e-5 
diff = 4.052705652414428e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 3.646596593318407e-5 
diff = 3.2815597652853866e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 2.9531088089616292e-5 
diff = 2.6575142182104668e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 2.391372551218441e-5 
diff = 2.1521163903626453e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.9364420696367072e-5 
diff = 1.7417489505364e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.566921118869348e-5 
diff = 1.4098680814969773e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.2687650964018318e-5 
diff = 1.2869445340231045e-5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.064280462525206e-5 
diff = 9.31945853351965e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 8.846007151628029e-6 
diff = 7.865132410740433e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 6.818965371677752e-6 
diff = 6.14589618067375e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 5.481398774952444e-6 
diff = 4.916450595182802e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 4.423227730736937e-6 
diff = 3.979927846727221e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 3.805216092094388e-6 
diff = 3.883194450049284e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 3.4721838406313227e-6 
diff = 2.6853685882696815e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 2.9105647540297202e-6 
diff = 2.2066765627272374e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.902790347614396e-6 
diff = 1.710354794848055e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.793826284215812e-6 
diff = 2.358633677143245e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.5984121430925804e-6 
diff = 1.2886043225769233e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.5073536027287973e-6 
diff = 1.5435184146347593e-6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>diff = 1.02207964707443e-6 
diff = 8.516914565487644e-7 
</pre></div>
</div>
<img alt="../_images/opt_tax_recur_24_43.png" src="../_images/opt_tax_recur_24_43.png" />
</div>
</div>
<p>As should be expected, the recursive and sequential solutions produce almost
identical allocations.</p>
<p>Unlike outcomes with CRRA preferences, the tax rate is not perfectly smoothed.</p>
<p>Instead the government raises the tax rate when <span class="math notranslate nohighlight">\(g_t\)</span> is high.</p>
</div>
</div>
<div class="section" id="further-comments">
<h2><a class="toc-backref" href="#id10"><span class="section-number">62.5. </span>Further Comments</a><a class="headerlink" href="#further-comments" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="amss.html"><span class="doc">related lecture</span></a> describes an extension of the Lucas-Stokey model
by  Aiyagari, Marcet, Sargent, and Seppälä (2002) <span id="id4">[<a class="reference internal" href="../zreferences.html#id57">AMSS02</a>]</span>.</p>
<p>In th AMSS economy, only a risk-free bond is traded.</p>
<p>That lecture compares the recursive representation of the Lucas-Stokey model
presented in this lecture with  one for an AMSS economy.</p>
<p>By comparing these recursive formulations, we shall glean a sense in which the
dimension of the state is lower in the Lucas Stokey model.</p>
<p>Accompanying that difference in dimension will be  different dynamics of government debt.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.6"
        },
        kernelOptions: {
            kernelName: "julia-1.6",
            path: "./dynamic_programming_squared"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.6'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            
            <div class="sidebar bd-sidebar inactive" id="site-navigation">

                <div class="sidebar__header">


                    Contents

                </div>

                <nav class="sidebar__nav" id="sidebar-nav" aria-label="Main navigation">
                    <p class="caption">
 <span class="caption-text">
  Getting Started with Julia
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/getting_started.html">
   1. Setting up Your Julia Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_environment.html">
   2. Interacting with Julia
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_by_example.html">
   3. Introductory Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_essentials.html">
   4. Julia Essentials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/fundamental_types.html">
   5. Arrays, Tuples, Ranges, and Other Fundamental Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/introduction_to_types.html">
   6. Introduction to Types and Generic Programming
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Package Ecosystem
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/generic_programming.html">
   7. Generic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/general_packages.html">
   8. General Purpose Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/data_statistical_packages.html">
   9. Data and Statistics Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/optimization_solver_packages.html">
   10. Solvers, Optimizers, and Automatic Differentiation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Software Engineering
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/tools_editors.html">
   11. Julia Tools and Editors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/version_control.html">
   12. Git, GitHub, and Version Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/testing.html">
   13. Packages, Testing, and Continuous Integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/need_for_speed.html">
   14. The Need for Speed
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/linear_algebra.html">
   15. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/orth_proj.html">
   16. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/lln_clt.html">
   17. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/linear_models.html">
   18. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/finite_markov.html">
   19. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/stationary_densities.html">
   20. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/kalman.html">
   21. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/numerical_linear_algebra.html">
   22. Numerical Linear Algebra and Factorizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/iterative_methods_sparsity.html">
   23. Krylov Methods and Matrix Conditioning
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Dynamic Programming
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/short_path.html">
   24. Shortest Paths
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/mccall_model.html">
   25. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/mccall_model_with_separation.html">
   26. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/wald_friedman.html">
   27. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/odu.html">
   28. Job Search III: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/career.html">
   29. Job Search IV: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/jv.html">
   30. Job Search V: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/optgrowth.html">
   31. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/coleman_policy_iter.html">
   32. Optimal Growth II: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/egm_policy_iter.html">
   33. Optimal Growth III: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/lqcontrol.html">
   34. LQ Dynamic Programming Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/perm_income.html">
   35. Optimal Savings I: The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/perm_income_cons.html">
   36. Optimal Savings II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/smoothing.html">
   37. Consumption and Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/ifp.html">
   38. Optimal Savings III: Occasionally Binding Constraints
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/robustness.html">
   39. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/discrete_dp.html">
   40. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Modeling in Continuous Time
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../continuous_time/seir_model.html">
   41. Modeling COVID 19 with Differential Equations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../continuous_time/covid_sde.html">
   42. Modeling Shocks in COVID 19 with Stochastic Differential Equations
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/schelling.html">
   43. Schelling’s Segregation Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/lake_model.html">
   44. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/rational_expectations.html">
   45. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/markov_perf.html">
   46. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/markov_asset.html">
   47. Asset Pricing I: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/lucas_model.html">
   48. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/harrison_kreps.html">
   49. Asset Pricing III:  Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/uncertainty_traps.html">
   50. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/aiyagari.html">
   51. The Aiyagari Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/arellano.html">
   52. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/matsuyama.html">
   53. Globalization and Cycles
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/arma.html">
   54. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/estspec.html">
   55. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/additive_functionals.html">
   56. Additive Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/multiplicative_functionals.html">
   57. Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/lu_tricks.html">
   58. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/classical_filtering.html">
   59. Classical Filtering With Linear Algebra
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="dyn_stack.html">
   60. Dynamic Stackelberg Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqramsey.html">
   61. Optimal Taxation in an LQ Economy
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   62. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss.html">
   63. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about_lectures.html">
   64. About these Lectures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../troubleshooting.html">
   65. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../zreferences.html">
   66. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../status.html">
   67. Lecture Status
  </a>
 </li>
</ul>

                </nav>

                <div class="sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="toolbar">

            <div class="toolbar__inner">

                <ul class="toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="../intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="../search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="_notebooks/dynamic_programming_squared/opt_tax_recur.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li data-tippy-content="Launch Notebook" id="launchButton"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-julia.notebooks/master?urlpath=tree/dynamic_programming_squared/opt_tax_recur.ipynb" target="_blank"><i data-feather="play-circle"></i></a></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-julia.myst/tree/master/lectures/dynamic_programming_squared/opt_tax_recur.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p style="color: white;">Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title">QuantEcon Notebook Launcher</p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input" onchange="onChangeListener()">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-julia.notebooks/master?urlpath=tree/dynamic_programming_squared/opt_tax_recur.ipynb">BinderHub</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <!-- <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" onchange="onChangeListener()">
                <i class="fas fa-check-circle"></i>
            </li> -->
            </ul>
        </div>

    </div> <!-- .wrapper-->
  </body>
</html>