
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>40. Discrete State Dynamic Programming &#8212; Quantitative Economics with Julia</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/quantecon-book-theme.1ef59f8f4e91ec8319176e8479c6af4e.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">


    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script src="../_static/quantecon-book-theme.15b0c36fffe88f468997fa7b698991d3.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://julia.quantecon.org/dynamic_programming/discrete_dp.html" />
    <link rel="shortcut icon" href="../_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="41. Modeling COVID 19 with Differential Equations" href="../continuous_time/seir_model.html" />
    <link rel="prev" title="39. Robustness" href="robustness.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Jesse Perla &amp; Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Julia, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on quantitative economic modeling, designed and written by Jesse Perla, Thomas J. Sargent and John Stachurski. The language instruction is Julia. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Discrete State Dynamic Programming"/>
<meta name="twitter:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Jesse Perla, Thomas J. Sargent and John Stachurski. The language instruction is Julia.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Discrete State Dynamic Programming" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://julia.quantecon.org/dynamic_programming/discrete_dp.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on quantitative economic modeling, designed and written by Jesse Perla, Thomas J. Sargent and John Stachurski. The language instruction is Julia." />
<meta property="og:site_name" content="Quantitative Economics with Julia" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=dynamic_programming/discrete_dp>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   40.1. Overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-read-this-lecture">
     40.1.1. How to Read this Lecture
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     40.1.2. References
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discrete-dps">
   40.2. Discrete DPs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policies">
     40.2.1. Policies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#formal-definition">
     40.2.2. Formal definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-and-optimality">
     40.2.3. Value and Optimality
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-operators">
     40.2.4. Two Operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-bellman-equation-and-the-principle-of-optimality">
     40.2.5. The Bellman Equation and the Principle of Optimality
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-discrete-dps">
   40.3. Solving Discrete DPs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-function-iteration">
     40.3.1. Value Function Iteration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-function-iteration">
     40.3.2. Policy Function Iteration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modified-policy-function-iteration">
     40.3.3. Modified Policy Function Iteration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-a-growth-model">
   40.4. Example: A Growth Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discrete-dp-representation">
     40.4.1. Discrete DP Representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-a-discretedp-instance">
     40.4.2. Defining a DiscreteDP Instance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#state-action-pair-formulation">
     40.4.3. State-Action Pair Formulation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   40.5. Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solutions">
   40.6. Solutions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     40.6.1. Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solving-the-model">
     40.6.2. Solving the Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison-of-the-solution-methods">
     40.6.3. Comparison of the solution methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replication-of-the-figures">
     40.6.4. Replication of the figures
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamics-of-the-capital-stock">
     40.6.5. Dynamics of the capital stock
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-algorithms">
   40.7. Appendix: Algorithms
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#value-iteration">
     40.7.1. Value Iteration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#policy-iteration">
     40.7.2. Policy Iteration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modified-policy-iteration">
     40.7.3. Modified Policy Iteration
    </a>
   </li>
  </ul>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="../_static/qe-logo-large.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="../intro.html">Quantitative Economics with Julia</a></p>

                        <p class="qe-page__header-subheading">Discrete State Dynamic Programming</p>

                    </div>

                    <p class="qe-page__header-authors">Jesse Perla & Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><div class="tex2jax_ignore mathjax_ignore section" id="discrete-state-dynamic-programming">
<h1><a class="toc-backref" href="#id9"><span class="section-number">40. </span><span class="target" id="index-0"></span>Discrete State Dynamic Programming</a><a class="headerlink" href="#discrete-state-dynamic-programming" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#discrete-state-dynamic-programming" id="id9">Discrete State Dynamic Programming</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id10">Overview</a></p></li>
<li><p><a class="reference internal" href="#discrete-dps" id="id11">Discrete DPs</a></p></li>
<li><p><a class="reference internal" href="#solving-discrete-dps" id="id12">Solving Discrete DPs</a></p></li>
<li><p><a class="reference internal" href="#example-a-growth-model" id="id13">Example: A Growth Model</a></p></li>
<li><p><a class="reference internal" href="#exercises" id="id14">Exercises</a></p></li>
<li><p><a class="reference internal" href="#solutions" id="id15">Solutions</a></p></li>
<li><p><a class="reference internal" href="#appendix-algorithms" id="id16">Appendix: Algorithms</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id10"><span class="section-number">40.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this lecture we discuss a family of dynamic programming problems with the following features:</p>
<ol class="simple">
<li><p>a discrete state space and discrete choices (actions)</p></li>
<li><p>an infinite horizon</p></li>
<li><p>discounted rewards</p></li>
<li><p>Markov state transitions</p></li>
</ol>
<p>We call such problems discrete dynamic programs, or discrete DPs.</p>
<p>Discrete DPs are the workhorses in much of modern quantitative economics, including</p>
<ul class="simple">
<li><p>monetary economics</p></li>
<li><p>search and labor economics</p></li>
<li><p>household savings and consumption theory</p></li>
<li><p>investment theory</p></li>
<li><p>asset pricing</p></li>
<li><p>industrial organization, etc.</p></li>
</ul>
<p>When a given model is not inherently discrete, it is common to replace it with a discretized version in order to use discrete DP techniques.</p>
<p>This lecture covers</p>
<ul class="simple">
<li><p>the theory of dynamic programming in a discrete setting, plus examples and
applications</p></li>
<li><p>a powerful set of routines for solving discrete DPs from the <a class="reference external" href="http://quantecon.org/quantecon-jl">QuantEcon code libary</a></p></li>
</ul>
<div class="section" id="how-to-read-this-lecture">
<h3><span class="section-number">40.1.1. </span>How to Read this Lecture<a class="headerlink" href="#how-to-read-this-lecture" title="Permalink to this headline">¶</a></h3>
<p>We use dynamic programming many applied lectures, such as</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="short_path.html"><span class="doc">shortest path lecture</span></a></p></li>
<li><p>The <a class="reference internal" href="mccall_model.html"><span class="doc">McCall search model lecture</span></a></p></li>
<li><p>The <a class="reference internal" href="optgrowth.html"><span class="doc">optimal growth lecture</span></a></p></li>
</ul>
<p>The objective of this lecture is to provide a more systematic and theoretical treatment, including algorithms and implementation, while focusing on the discrete case.</p>
</div>
<div class="section" id="references">
<h3><span class="section-number">40.1.2. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p>For background reading on dynamic programming and additional applications, see, for example,</p>
<ul class="simple">
<li><p><span id="id1">[<a class="reference internal" href="../zreferences.html#id99">LS18</a>]</span></p></li>
<li><p><span id="id2">[<a class="reference internal" href="../zreferences.html#id86">HLL96</a>]</span>, section 3.5</p></li>
<li><p><span id="id3">[<a class="reference internal" href="../zreferences.html#id50">Put05</a>]</span></p></li>
<li><p><span id="id4">[<a class="reference internal" href="../zreferences.html#id130">SLP89</a>]</span></p></li>
<li><p><span id="id5">[<a class="reference internal" href="../zreferences.html#id58">Rus96</a>]</span></p></li>
<li><p><span id="id6">[<a class="reference internal" href="../zreferences.html#id111">MF02</a>]</span></p></li>
<li><p><a class="reference external" href="http://johnstachurski.net/edtc.html">EDTC</a>, chapter 5</p></li>
</ul>
</div>
</div>
<div class="section" id="discrete-dps">
<span id="id7"></span><h2><a class="toc-backref" href="#id11"><span class="section-number">40.2. </span>Discrete DPs</a><a class="headerlink" href="#discrete-dps" title="Permalink to this headline">¶</a></h2>
<p>Loosely speaking, a discrete DP is a maximization problem with an objective
function of the form</p>
<div class="math notranslate nohighlight" id="equation-dp-objective">
<span class="eqno">(40.1)<a class="headerlink" href="#equation-dp-objective" title="Permalink to this equation">¶</a></span>\[\mathbb{E}
\sum_{t = 0}^{\infty} \beta^t r(s_t, a_t)\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(s_t\)</span> is the state variable</p></li>
<li><p><span class="math notranslate nohighlight">\(a_t\)</span> is the action</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> is a discount factor</p></li>
<li><p><span class="math notranslate nohighlight">\(r(s_t, a_t)\)</span> is interpreted as a current reward when the state is <span class="math notranslate nohighlight">\(s_t\)</span> and the action chosen is <span class="math notranslate nohighlight">\(a_t\)</span></p></li>
</ul>
<p>Each pair <span class="math notranslate nohighlight">\((s_t, a_t)\)</span> pins down transition probabilities <span class="math notranslate nohighlight">\(Q(s_t, a_t, s_{t+1})\)</span> for the next period state <span class="math notranslate nohighlight">\(s_{t+1}\)</span>.</p>
<p>Thus, actions influence not only current rewards but also the future time path of the state.</p>
<p>The essence of dynamic programming problems is to trade off current rewards
vs favorable positioning of the future state (modulo randomness).</p>
<p>Examples:</p>
<ul class="simple">
<li><p>consuming today vs saving and accumulating assets</p></li>
<li><p>accepting a job offer today vs seeking a better one in the future</p></li>
<li><p>exercising an option now vs waiting</p></li>
</ul>
<div class="section" id="policies">
<h3><span class="section-number">40.2.1. </span>Policies<a class="headerlink" href="#policies" title="Permalink to this headline">¶</a></h3>
<p>The most fruitful way to think about solutions to discrete DP problems is to compare <em>policies</em>.</p>
<p>In general, a policy is a randomized map from past actions and states to
current action.</p>
<p>In the setting formalized below, it suffices to consider so-called <em>stationary Markov policies</em>, which consider only the current state.</p>
<p>In particular, a stationary Markov policy is a map <span class="math notranslate nohighlight">\(\sigma\)</span> from states to actions</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(a_t = \sigma(s_t)\)</span> indicates that <span class="math notranslate nohighlight">\(a_t\)</span> is the action to be taken in state <span class="math notranslate nohighlight">\(s_t\)</span></p></li>
</ul>
<p>It is known that, for any arbitrary policy, there exists a stationary Markov policy that dominates it at least weakly.</p>
<ul class="simple">
<li><p>See section 5.5 of <span id="id8">[<a class="reference internal" href="../zreferences.html#id50">Put05</a>]</span> for discussion and proofs.</p></li>
</ul>
<p>In what follows, stationary Markov policies are referred to simply as policies.</p>
<p>The aim is to find an optimal policy, in the sense of one that maximizes <a class="reference internal" href="#equation-dp-objective">(40.1)</a>.</p>
<p>Let’s now step through these ideas more carefully.</p>
</div>
<div class="section" id="formal-definition">
<h3><span class="section-number">40.2.2. </span>Formal definition<a class="headerlink" href="#formal-definition" title="Permalink to this headline">¶</a></h3>
<p>Formally, a discrete dynamic program consists of the following components:</p>
<ol>
<li><p>A finite set of <em>states</em> <span class="math notranslate nohighlight">\(S = \{0, \ldots, n-1\}\)</span></p></li>
<li><p>A finite set of <em>feasible actions</em> <span class="math notranslate nohighlight">\(A(s)\)</span> for each state <span class="math notranslate nohighlight">\(s \in S\)</span>, and a corresponding set of <em>feasible state-action pairs</em></p>
<div class="math notranslate nohighlight">
\[
   \mathit{SA} := \{(s, a) \mid s \in S, \; a \in A(s)\}
   \]</div>
</li>
<li><p>A <em>reward function</em> <span class="math notranslate nohighlight">\(r\colon \mathit{SA} \to \mathbb{R}\)</span></p></li>
<li><p>A <em>transition probability function</em> <span class="math notranslate nohighlight">\(Q\colon \mathit{SA} \to \Delta(S)\)</span>, where <span class="math notranslate nohighlight">\(\Delta(S)\)</span> is the set of probability distributions over <span class="math notranslate nohighlight">\(S\)</span></p></li>
<li><p>A <em>discount factor</em> <span class="math notranslate nohighlight">\(\beta \in [0, 1)\)</span></p></li>
</ol>
<p>We also use the notation <span class="math notranslate nohighlight">\(A := \bigcup_{s \in S} A(s) = \{0, \ldots, m-1\}\)</span> and call this set the <em>action space</em>.</p>
<p>A <em>policy</em> is a function <span class="math notranslate nohighlight">\(\sigma\colon S \to A\)</span>.</p>
<p>A policy is called <em>feasible</em> if it satisfies <span class="math notranslate nohighlight">\(\sigma(s) \in A(s)\)</span> for all <span class="math notranslate nohighlight">\(s \in S\)</span>.</p>
<p>Denote the set of all feasible policies by <span class="math notranslate nohighlight">\(\Sigma\)</span>.</p>
<p>If a decision maker uses  a policy <span class="math notranslate nohighlight">\(\sigma \in \Sigma\)</span>, then</p>
<ul class="simple">
<li><p>the current reward at time <span class="math notranslate nohighlight">\(t\)</span> is <span class="math notranslate nohighlight">\(r(s_t, \sigma(s_t))\)</span></p></li>
<li><p>the probability that <span class="math notranslate nohighlight">\(s_{t+1} = s'\)</span> is <span class="math notranslate nohighlight">\(Q(s_t, \sigma(s_t), s')\)</span></p></li>
</ul>
<p>For each <span class="math notranslate nohighlight">\(\sigma \in \Sigma\)</span>, define</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_{\sigma}\)</span> by <span class="math notranslate nohighlight">\(r_{\sigma}(s) := r(s, \sigma(s))\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(Q_{\sigma}\)</span> by <span class="math notranslate nohighlight">\(Q_{\sigma}(s, s') := Q(s, \sigma(s), s')\)</span></p></li>
</ul>
<p>Notice that <span class="math notranslate nohighlight">\(Q_\sigma\)</span> is a <a class="reference internal" href="../tools_and_techniques/finite_markov.html#finite-dp-stoch-mat"><span class="std std-ref">stochastic matrix</span></a> on <span class="math notranslate nohighlight">\(S\)</span>.</p>
<p>It gives transition probabilities of the <em>controlled chain</em> when we follow policy <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<p>If we think of <span class="math notranslate nohighlight">\(r_\sigma\)</span> as a column vector, then so is <span class="math notranslate nohighlight">\(Q_\sigma^t r_\sigma\)</span>, and the <span class="math notranslate nohighlight">\(s\)</span>-th row of the latter has the interpretation</p>
<div class="math notranslate nohighlight" id="equation-ddp-expec">
<span class="eqno">(40.2)<a class="headerlink" href="#equation-ddp-expec" title="Permalink to this equation">¶</a></span>\[(Q_\sigma^t r_\sigma)(s) = \mathbb E [ r(s_t, \sigma(s_t)) \mid s_0 = s ]
\quad \text{when } \{s_t\} \sim Q_\sigma\]</div>
<p>Comments</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\{s_t\} \sim Q_\sigma\)</span> means that the state is generated by stochastic matrix <span class="math notranslate nohighlight">\(Q_\sigma\)</span></p></li>
<li><p>See <a class="reference internal" href="../tools_and_techniques/finite_markov.html#finite-mc-expec"><span class="std std-ref">this discussion</span></a> on computing expectations of Markov chains for an explanation of the expression in <a class="reference internal" href="#equation-ddp-expec">(40.2)</a></p></li>
</ul>
<p>Notice that we’re not really distinguishing between functions from <span class="math notranslate nohighlight">\(S\)</span> to <span class="math notranslate nohighlight">\(\mathbb R\)</span> and vectors in <span class="math notranslate nohighlight">\(\mathbb R^n\)</span>.</p>
<p>This is natural because they are in one to one correspondence.</p>
</div>
<div class="section" id="value-and-optimality">
<h3><span class="section-number">40.2.3. </span>Value and Optimality<a class="headerlink" href="#value-and-optimality" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(v_{\sigma}(s)\)</span> denote the discounted sum of expected reward flows from policy <span class="math notranslate nohighlight">\(\sigma\)</span>
when the initial state is <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>To calculate this quantity we pass the expectation through the sum in
<a class="reference internal" href="#equation-dp-objective">(40.1)</a> and use <a class="reference internal" href="#equation-ddp-expec">(40.2)</a> to get</p>
<div class="math notranslate nohighlight">
\[
v_{\sigma}(s) = \sum_{t=0}^{\infty} \beta^t (Q_{\sigma}^t r_{\sigma})(s)
\qquad (s \in S)
\]</div>
<p>This function is called the <em>policy value function</em> for the policy <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<p>The <em>optimal value function</em>, or simply <em>value function</em>, is the function <span class="math notranslate nohighlight">\(v^*\colon S \to \mathbb{R}\)</span> defined by</p>
<div class="math notranslate nohighlight">
\[
v^*(s) = \max_{\sigma \in \Sigma} v_{\sigma}(s)
\qquad (s \in S)
\]</div>
<p>(We can use max rather than sup here because the domain is a finite set)</p>
<p>A policy <span class="math notranslate nohighlight">\(\sigma \in \Sigma\)</span> is called <em>optimal</em> if <span class="math notranslate nohighlight">\(v_{\sigma}(s) = v^*(s)\)</span> for all <span class="math notranslate nohighlight">\(s \in S\)</span>.</p>
<p>Given any <span class="math notranslate nohighlight">\(w \colon S \to \mathbb R\)</span>, a policy <span class="math notranslate nohighlight">\(\sigma \in \Sigma\)</span> is called <span class="math notranslate nohighlight">\(w\)</span>-greedy if</p>
<div class="math notranslate nohighlight">
\[
\sigma(s) \in \operatorname*{arg\,max}_{a \in A(s)}
\left\{
    r(s, a) +
    \beta \sum_{s' \in S} w(s') Q(s, a, s')
\right\}
\qquad (s \in S)
\]</div>
<p>As discussed in detail below, optimal policies are precisely those that are <span class="math notranslate nohighlight">\(v^*\)</span>-greedy.</p>
</div>
<div class="section" id="two-operators">
<h3><span class="section-number">40.2.4. </span>Two Operators<a class="headerlink" href="#two-operators" title="Permalink to this headline">¶</a></h3>
<p>It is useful to define the following operators:</p>
<ul class="simple">
<li><p>The <em>Bellman operator</em> <span class="math notranslate nohighlight">\(T\colon \mathbb{R}^S \to \mathbb{R}^S\)</span>
is defined by</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
(T v)(s) = \max_{a \in A(s)}
\left\{
    r(s, a) + \beta \sum_{s' \in S} v(s') Q(s, a, s')
\right\}
\qquad (s \in S)
\]</div>
<ul class="simple">
<li><p>For any policy function <span class="math notranslate nohighlight">\(\sigma \in \Sigma\)</span>, the operator <span class="math notranslate nohighlight">\(T_{\sigma}\colon \mathbb{R}^S \to \mathbb{R}^S\)</span> is defined by</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
(T_{\sigma} v)(s) = r(s, \sigma(s)) +
    \beta \sum_{s' \in S} v(s') Q(s, \sigma(s), s')
\qquad (s \in S)
\]</div>
<p>This can be written more succinctly in operator notation as</p>
<div class="math notranslate nohighlight">
\[
T_{\sigma} v = r_{\sigma} + \beta Q_{\sigma} v
\]</div>
<p>The two operators are both monotone</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(v \leq w\)</span>  implies <span class="math notranslate nohighlight">\(Tv \leq Tw\)</span> pointwise on <span class="math notranslate nohighlight">\(S\)</span>, and
similarly for <span class="math notranslate nohighlight">\(T_\sigma\)</span></p></li>
</ul>
<p>They are also contraction mappings with modulus <span class="math notranslate nohighlight">\(\beta\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\lVert Tv - Tw \rVert \leq \beta \lVert v - w \rVert\)</span> and similarly for <span class="math notranslate nohighlight">\(T_\sigma\)</span>, where <span class="math notranslate nohighlight">\(\lVert \cdot\rVert\)</span> is the max norm</p></li>
</ul>
<p>For any policy <span class="math notranslate nohighlight">\(\sigma\)</span>, its value <span class="math notranslate nohighlight">\(v_{\sigma}\)</span> is the unique fixed point of <span class="math notranslate nohighlight">\(T_{\sigma}\)</span>.</p>
<p>For proofs of these results and those in the next section, see, for example, <a class="reference external" href="http://johnstachurski.net/edtc.html">EDTC</a>, chapter 10.</p>
</div>
<div class="section" id="the-bellman-equation-and-the-principle-of-optimality">
<h3><span class="section-number">40.2.5. </span>The Bellman Equation and the Principle of Optimality<a class="headerlink" href="#the-bellman-equation-and-the-principle-of-optimality" title="Permalink to this headline">¶</a></h3>
<p>The main principle of the theory of dynamic programming is that</p>
<ul>
<li><p>the optimal value function <span class="math notranslate nohighlight">\(v^*\)</span> is a unique solution to the <em>Bellman equation</em>,</p>
<div class="math notranslate nohighlight">
\[
  v(s) = \max_{a \in A(s)} \left\{ r(s, a) + \beta \sum_{s' \in S} v(s') Q(s, a, s') \right\} \qquad (s \in S),
  \]</div>
<p>or in other words, <span class="math notranslate nohighlight">\(v^*\)</span> is the unique fixed point of <span class="math notranslate nohighlight">\(T\)</span>, and</p>
</li>
<li><p><span class="math notranslate nohighlight">\(\sigma^*\)</span> is an optimal policy function if and only if it is <span class="math notranslate nohighlight">\(v^*\)</span>-greedy</p></li>
</ul>
<p>By the definition of greedy policies given above, this means that</p>
<div class="math notranslate nohighlight">
\[
\sigma^*(s) \in \operatorname*{arg\,max}_{a \in A(s)}
    \left\{
    r(s, a) + \beta \sum_{s' \in S} v^*(s') Q(s, \sigma(s), s')
    \right\}
\qquad (s \in S)
\]</div>
</div>
</div>
<div class="section" id="solving-discrete-dps">
<h2><a class="toc-backref" href="#id12"><span class="section-number">40.3. </span>Solving Discrete DPs</a><a class="headerlink" href="#solving-discrete-dps" title="Permalink to this headline">¶</a></h2>
<p>Now that the theory has been set out, let’s turn to solution methods.</p>
<p>Code for solving discrete DPs is available in <a class="reference external" href="https://github.com/QuantEcon/QuantEcon.jl/blob/master/src/markov/ddp.jl">ddp.jl</a> from the <a class="reference external" href="http://quantecon.org/quantecon-jl">QuantEcon.jl</a> code library.</p>
<p>It implements the three most important solution methods for discrete dynamic programs, namely</p>
<ul class="simple">
<li><p>value function iteration</p></li>
<li><p>policy function iteration</p></li>
<li><p>modified policy function iteration</p></li>
</ul>
<p>Let’s briefly review these algorithms and their implementation.</p>
<div class="section" id="value-function-iteration">
<h3><span class="section-number">40.3.1. </span>Value Function Iteration<a class="headerlink" href="#value-function-iteration" title="Permalink to this headline">¶</a></h3>
<p>Perhaps the most familiar method for solving all manner of dynamic programs is value function iteration.</p>
<p>This algorithm uses the fact that the Bellman operator <span class="math notranslate nohighlight">\(T\)</span> is a contraction mapping with fixed point <span class="math notranslate nohighlight">\(v^*\)</span>.</p>
<p>Hence, iterative application of <span class="math notranslate nohighlight">\(T\)</span> to any initial function <span class="math notranslate nohighlight">\(v^0 \colon S \to \mathbb R\)</span> converges to <span class="math notranslate nohighlight">\(v^*\)</span>.</p>
<p>The details of the algorithm can be found in <a class="reference internal" href="#ddp-algorithms"><span class="std std-ref">the appendix</span></a>.</p>
</div>
<div class="section" id="policy-function-iteration">
<h3><span class="section-number">40.3.2. </span>Policy Function Iteration<a class="headerlink" href="#policy-function-iteration" title="Permalink to this headline">¶</a></h3>
<p>This routine, also known as Howard’s policy improvement algorithm, exploits more closely the particular structure of a discrete DP problem.</p>
<p>Each iteration consists of</p>
<ol class="simple">
<li><p>A policy evaluation step that computes the value <span class="math notranslate nohighlight">\(v_{\sigma}\)</span> of a policy <span class="math notranslate nohighlight">\(\sigma\)</span> by solving the linear equation <span class="math notranslate nohighlight">\(v = T_{\sigma} v\)</span>.</p></li>
<li><p>A policy improvement step that computes a <span class="math notranslate nohighlight">\(v_{\sigma}\)</span>-greedy policy.</p></li>
</ol>
<p>In the current setting policy iteration computes an exact optimal policy in finitely many iterations.</p>
<ul class="simple">
<li><p>See theorem 10.2.6 of <a class="reference external" href="http://johnstachurski.net/edtc.html">EDTC</a> for a proof</p></li>
</ul>
<p>The details of the algorithm can be found in <a class="reference internal" href="#ddp-algorithms"><span class="std std-ref">the appendix</span></a>.</p>
</div>
<div class="section" id="modified-policy-function-iteration">
<h3><span class="section-number">40.3.3. </span>Modified Policy Function Iteration<a class="headerlink" href="#modified-policy-function-iteration" title="Permalink to this headline">¶</a></h3>
<p>Modified policy iteration replaces the policy evaluation step in policy iteration with “partial policy evaluation”.</p>
<p>The latter computes an approximation to the value of a policy <span class="math notranslate nohighlight">\(\sigma\)</span> by iterating <span class="math notranslate nohighlight">\(T_{\sigma}\)</span> for a specified number of times.</p>
<p>This approach can be useful when the state space is very large and the linear system in the policy evaluation step of policy iteration is correspondingly difficult to solve.</p>
<p>The details of the algorithm can be found in <a class="reference internal" href="#ddp-algorithms"><span class="std std-ref">the appendix</span></a>.</p>
</div>
</div>
<div class="section" id="example-a-growth-model">
<span id="ddp-eg-gm"></span><h2><a class="toc-backref" href="#id13"><span class="section-number">40.4. </span>Example: A Growth Model</a><a class="headerlink" href="#example-a-growth-model" title="Permalink to this headline">¶</a></h2>
<p>Let’s consider a simple consumption-saving model.</p>
<p>A single household either consumes or stores its own output of a single consumption good.</p>
<p>The household starts each period with current stock <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>Next, the household chooses a quantity <span class="math notranslate nohighlight">\(a\)</span> to store and consumes <span class="math notranslate nohighlight">\(c = s - a\)</span></p>
<ul class="simple">
<li><p>Storage is limited by a global upper bound <span class="math notranslate nohighlight">\(M\)</span></p></li>
<li><p>Flow utility is <span class="math notranslate nohighlight">\(u(c) = c^{\alpha}\)</span></p></li>
</ul>
<p>Output is drawn from a discrete uniform distribution on <span class="math notranslate nohighlight">\(\{0, \ldots, B\}\)</span>.</p>
<p>The next period stock is therefore</p>
<div class="math notranslate nohighlight">
\[
s' = a + U
\quad \text{where} \quad
U \sim U[0, \ldots, B]
\]</div>
<p>The discount factor is <span class="math notranslate nohighlight">\(\beta \in [0, 1)\)</span>.</p>
<div class="section" id="discrete-dp-representation">
<h3><span class="section-number">40.4.1. </span>Discrete DP Representation<a class="headerlink" href="#discrete-dp-representation" title="Permalink to this headline">¶</a></h3>
<p>We want to represent this model in the format of a discrete dynamic program.</p>
<p>To this end, we take</p>
<ul class="simple">
<li><p>the state variable to be the stock <span class="math notranslate nohighlight">\(s\)</span></p></li>
<li><p>the state space to be <span class="math notranslate nohighlight">\(S = \{0, \ldots, M + B\}\)</span></p>
<ul>
<li><p>hence <span class="math notranslate nohighlight">\(n = M + B + 1\)</span></p></li>
</ul>
</li>
<li><p>the action to be the storage quantity <span class="math notranslate nohighlight">\(a\)</span></p></li>
<li><p>the set of feasible actions at <span class="math notranslate nohighlight">\(s\)</span> to be <span class="math notranslate nohighlight">\(A(s) = \{0, \ldots, \min\{s, M\}\}\)</span></p>
<ul>
<li><p>hence <span class="math notranslate nohighlight">\(A = \{0, \ldots, M\}\)</span> and <span class="math notranslate nohighlight">\(m = M + 1\)</span></p></li>
</ul>
</li>
<li><p>the reward function to be <span class="math notranslate nohighlight">\(r(s, a) = u(s - a)\)</span></p></li>
<li><p>the transition probabilities to be</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-ddp-def-ogq">
<span class="eqno">(40.3)<a class="headerlink" href="#equation-ddp-def-ogq" title="Permalink to this equation">¶</a></span>\[\begin{split}Q(s, a, s')
:=
\begin{cases}
    \frac{1}{B + 1} &amp; \text{if } a \leq s' \leq a + B
    \\
     0 &amp; \text{ otherwise}
\end{cases}\end{split}\]</div>
</div>
<div class="section" id="defining-a-discretedp-instance">
<h3><span class="section-number">40.4.2. </span>Defining a DiscreteDP Instance<a class="headerlink" href="#defining-a-discretedp-instance" title="Permalink to this headline">¶</a></h3>
<p>This information will be used to create an instance of DiscreteDP by passing
the following information</p>
<ol class="simple">
<li><p>An <span class="math notranslate nohighlight">\(n \times m\)</span> reward array <span class="math notranslate nohighlight">\(R\)</span></p></li>
<li><p>An <span class="math notranslate nohighlight">\(n \times m \times n\)</span> transition probability array <span class="math notranslate nohighlight">\(Q\)</span></p></li>
<li><p>A discount factor <span class="math notranslate nohighlight">\(\beta\)</span></p></li>
</ol>
<p>For <span class="math notranslate nohighlight">\(R\)</span> we set <span class="math notranslate nohighlight">\(R[s, a] = u(s - a)\)</span> if <span class="math notranslate nohighlight">\(a \leq s\)</span> and <span class="math notranslate nohighlight">\(-\infty\)</span> otherwise.</p>
<p>For <span class="math notranslate nohighlight">\(Q\)</span> we follow the rule in <a class="reference internal" href="#equation-ddp-def-ogq">(40.3)</a>.</p>
<p>Note:</p>
<ul class="simple">
<li><p>The feasibility constraint is embedded into <span class="math notranslate nohighlight">\(R\)</span> by setting <span class="math notranslate nohighlight">\(R[s, a] = -\infty\)</span> for <span class="math notranslate nohighlight">\(a \notin A(s)\)</span>.</p></li>
<li><p>Probability distributions for <span class="math notranslate nohighlight">\((s, a)\)</span> with <span class="math notranslate nohighlight">\(a \notin A(s)\)</span> can be arbitrary.</p></li>
</ul>
<p>The following code sets up these objects for us.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">BenchmarkTools</span><span class="p">,</span> <span class="n">LaTeXStrings</span><span class="p">,</span> <span class="n">LinearAlgebra</span><span class="p">,</span> <span class="n">Plots</span><span class="p">,</span> <span class="n">QuantEcon</span><span class="p">,</span> <span class="n">Statistics</span>
<span class="k">using</span> <span class="n">SparseArrays</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">BenchmarkTools</span><span class="p">,</span> <span class="n">Plots</span><span class="p">,</span> <span class="n">QuantEcon</span><span class="p">,</span> <span class="n">Parameters</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">SimpleOG</span> <span class="o">=</span> <span class="nd">@with_kw</span> <span class="p">(</span><span class="n">B</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">α</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>

<span class="k">function</span> <span class="n">transition_matrices</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="nd">@unpack</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="n">g</span>
    <span class="n">u</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span><span class="o">^</span><span class="n">α</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">M</span>
        <span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="o">:</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">B</span><span class="p">))</span> <span class="o">.+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">.=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">M</span><span class="p">)</span>
            <span class="n">R</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a≤s</span> <span class="o">?</span> <span class="n">u</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">:</span> <span class="o">-</span><span class="nb">Inf</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>transition_matrices (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Let’s run this code and create an instance of <code class="docutils literal notranslate"><span class="pre">SimpleOG</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">SimpleOG</span><span class="p">();</span>
<span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">transition_matrices</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>In case the preceding code was too concise, we can see a more verbose form</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">verbose_matrices</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="nd">@unpack</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="n">g</span>
    <span class="n">u</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span><span class="o">^</span><span class="n">α</span>

    <span class="c">#Matrix dimensions. The +1 is due to the 0 state.</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">fill</span><span class="p">(</span><span class="o">-</span><span class="nb">Inf</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="c">#Start assuming nothing is feasible</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="c">#Assume 0 by default</span>

    <span class="c">#Create the R matrix</span>
    <span class="c">#Note: indexing into matrix complicated since Julia starts indexing at 1 instead of 0</span>
    <span class="c">#but the state s and choice a can be 0</span>
    <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">M</span>
         <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">M</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">s</span> <span class="c">#i.e. if feasible</span>
                <span class="n">R</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>

    <span class="c">#Create the Q multi-array</span>
    <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">M</span><span class="p">)</span> <span class="c">#For each state</span>
        <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">M</span> <span class="c">#For each action</span>
            <span class="k">for</span> <span class="n">sp</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">M</span><span class="p">)</span> <span class="c">#For each state next period</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">sp</span> <span class="o">&gt;=</span> <span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">sp</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span> <span class="c"># The support of all realizations</span>
                    <span class="n">Q</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Same prob of all</span>
                <span class="k">end</span>
            <span class="k">end</span>
            <span class="nd">@assert</span> <span class="n">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span> <span class="o">≈</span> <span class="mi">1</span> <span class="c">#Optional check that matrix is stochastic</span>
         <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>verbose_matrices (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Instances of <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code> are created using the signature <code class="docutils literal notranslate"><span class="pre">DiscreteDP(R,</span> <span class="pre">Q,</span> <span class="pre">β)</span></code>.</p>
<p>Let’s create an instance using the objects stored in <code class="docutils literal notranslate"><span class="pre">g</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ddp</span> <span class="o">=</span> <span class="n">DiscreteDP</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">β</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have an instance <code class="docutils literal notranslate"><span class="pre">ddp</span></code> of <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code> we can solve it as follows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">PFI</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>QuantEcon.DPSolveResult{PFI, Float64}([19.01740221695992, 20.017402216959916, 20.431615779333015, 20.749453024528794, 21.040780991093488, 21.30873018352461, 21.544798161024403, 21.76928181079986, 21.982703576083246, 22.1882432282385, 22.384504796519916, 22.578077363861723, 22.761091269771118, 22.943767083452716, 23.115339958706524, 23.277617618874903], [19.01740221695992, 20.01740221695992, 20.431615779333015, 20.749453024528798, 21.04078099109349, 21.308730183524613, 21.544798161024403, 21.769281810799864, 21.982703576083253, 22.188243228238502, 22.384504796519913, 22.578077363861727, 22.761091269771114, 22.943767083452716, 23.115339958706524, 23.277617618874903], 3, [1, 1, 1, 1, 2, 2, 2, 3, 3, 4, 4, 5, 6, 6, 6, 6], Discrete Markov Chain
stochastic matrix of type Adjoint{Float64, Matrix{Float64}}:
[0.09090909090909091 0.09090909090909091 … 0.0 0.0; 0.09090909090909091 0.09090909090909091 … 0.0 0.0; … ; 0.0 0.0 … 0.09090909090909091 0.09090909090909091; 0.0 0.0 … 0.09090909090909091 0.09090909090909091])
</pre></div>
</div>
</div>
</div>
<p>Let’s see what we’ve got here</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fieldnames</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(:v, :Tv, :num_iter, :sigma, :mc)
</pre></div>
</div>
</div>
</div>
<p>The most important attributes are <code class="docutils literal notranslate"><span class="pre">v</span></code>, the value function, and <code class="docutils literal notranslate"><span class="pre">σ</span></code>, the optimal policy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16-element Vector{Float64}:
 19.01740221695992
 20.017402216959916
 20.431615779333015
 20.749453024528794
 21.040780991093488
 21.30873018352461
 21.544798161024403
 21.76928181079986
 21.982703576083246
 22.1882432282385
 22.384504796519916
 22.578077363861723
 22.761091269771118
 22.943767083452716
 23.115339958706524
 23.277617618874903
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">sigma</span> <span class="o">.-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16-element Vector{Int64}:
 0
 0
 0
 0
 1
 1
 1
 2
 2
 3
 3
 4
 5
 5
 5
 5
</pre></div>
</div>
</div>
</div>
<p>Here 1 is subtracted from results.sigma because we added 1 to each state and action to create valid indices.</p>
<p>Since we’ve used policy iteration, these results will be exact unless we hit the iteration bound <code class="docutils literal notranslate"><span class="pre">max_iter</span></code>.</p>
<p>Let’s make sure this didn’t happen</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">num_iter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<p>In this case we converged in only 3 iterations.</p>
<p>Another interesting object is <code class="docutils literal notranslate"><span class="pre">results.mc</span></code>, which is the controlled chain defined by <span class="math notranslate nohighlight">\(Q_{\sigma^*}\)</span>, where <span class="math notranslate nohighlight">\(\sigma^*\)</span> is the optimal policy.</p>
<p>In other words, it gives the dynamics of the state when the agent follows the optimal policy.</p>
<p>Since this object is an instance of MarkovChain from  <a class="reference external" href="http://quantecon.org/quantecon-jl">QuantEcon.jl</a> (see <a class="reference internal" href="../tools_and_techniques/finite_markov.html"><span class="doc">this lecture</span></a> for more discussion), we
can easily simulate it, compute its stationary distribution and so on</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">stationary_distributions</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">mc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16-element Vector{Float64}:
 0.01732186732186732
 0.041210632119723034
 0.05773955773955773
 0.07426848335939244
 0.08095823095823096
 0.09090909090909091
 0.0909090909090909
 0.0909090909090909
 0.09090909090909093
 0.09090909090909091
 0.09090909090909091
 0.0735872235872236
 0.049698458789367884
 0.033169533169533166
 0.016640607549698462
 0.009950859950859951
</pre></div>
</div>
</div>
</div>
<p>Here’s the same information in a bar graph</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/finite_dp_simple_og.png"><img alt="../_images/finite_dp_simple_og.png" src="../_images/finite_dp_simple_og.png" style="width: 80%;" /></a>
</div>
<p>What happens if the agent is more patient?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">g_2</span> <span class="o">=</span> <span class="n">SimpleOG</span><span class="p">(</span><span class="n">β</span><span class="o">=</span><span class="mf">0.99</span><span class="p">);</span>
<span class="n">Q_2</span><span class="p">,</span> <span class="n">R_2</span> <span class="o">=</span> <span class="n">transition_matrices</span><span class="p">(</span><span class="n">g_2</span><span class="p">);</span>

<span class="n">ddp_2</span> <span class="o">=</span> <span class="n">DiscreteDP</span><span class="p">(</span><span class="n">R_2</span><span class="p">,</span> <span class="n">Q_2</span><span class="p">,</span> <span class="n">g_2</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>

<span class="n">results_2</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp_2</span><span class="p">,</span> <span class="n">PFI</span><span class="p">)</span>

<span class="n">std_2</span> <span class="o">=</span> <span class="n">stationary_distributions</span><span class="p">(</span><span class="n">results_2</span><span class="o">.</span><span class="n">mc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16-element Vector{Float64}:
 0.005469129800680602
 0.023213417598444343
 0.03147788040836169
 0.04800680602819641
 0.056271268838113765
 0.09090909090909091
 0.09090909090909093
 0.09090909090909093
 0.09090909090909094
 0.09090909090909093
 0.09090909090909094
 0.0854399611084103
 0.06769567331064659
 0.059431210500729234
 0.042902284880894495
 0.03463782207097716
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">bar</span><span class="p">(</span><span class="n">std_2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;stationary dist&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/discrete_dp_29_0.svg" src="../_images/discrete_dp_29_0.svg" /></div>
</div>
<p>We can see the rightward shift in probability mass.</p>
</div>
<div class="section" id="state-action-pair-formulation">
<h3><span class="section-number">40.4.3. </span>State-Action Pair Formulation<a class="headerlink" href="#state-action-pair-formulation" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code> type in fact provides a second interface to setting up an instance.</p>
<p>One of the advantages of this alternative set up is that it permits use of a sparse matrix for <code class="docutils literal notranslate"><span class="pre">Q</span></code>.</p>
<p>(An example of using sparse matrices is given in the exercises below)</p>
<p>The call signature of the second formulation is <code class="docutils literal notranslate"><span class="pre">DiscreteDP(R,</span> <span class="pre">Q,</span> <span class="pre">β,</span> <span class="pre">s_indices,</span> <span class="pre">a_indices)</span></code> where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">s_indices</span></code> and <code class="docutils literal notranslate"><span class="pre">a_indices</span></code> are arrays of equal length <code class="docutils literal notranslate"><span class="pre">L</span></code> enumerating all feasible state-action pairs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">R</span></code> is an array of length <code class="docutils literal notranslate"><span class="pre">L</span></code> giving corresponding rewards</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Q</span></code> is an <code class="docutils literal notranslate"><span class="pre">L</span> <span class="pre">x</span> <span class="pre">n</span></code> transition probability array</p></li>
</ul>
<p>Here’s how we could set up these objects for the preceding example</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">α</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">β</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">u</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span><span class="o">^</span><span class="n">α</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">s_indices</span> <span class="o">=</span> <span class="kt">Int64</span><span class="p">[]</span>
<span class="n">a_indices</span> <span class="o">=</span> <span class="kt">Int64</span><span class="p">[]</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">min</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">s_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">s_indices</span><span class="p">;</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">a_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_indices</span><span class="p">;</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">q</span><span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">:</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">.=</span> <span class="n">b</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="n">Q</span><span class="p">;</span> <span class="n">q</span><span class="p">]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="p">;</span> <span class="n">u</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">a</span><span class="p">)]</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">ddp</span> <span class="o">=</span> <span class="n">DiscreteDP</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">s_indices</span><span class="p">,</span> <span class="n">a_indices</span><span class="p">);</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">PFI</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>QuantEcon.DPSolveResult{PFI, Float64}([19.01740221695992, 20.017402216959916, 20.431615779333015, 20.749453024528794, 21.040780991093488, 21.30873018352461, 21.544798161024403, 21.76928181079986, 21.982703576083246, 22.1882432282385, 22.384504796519916, 22.578077363861723, 22.761091269771118, 22.943767083452716, 23.115339958706524, 23.277617618874903], [19.01740221695992, 20.01740221695992, 20.431615779333015, 20.749453024528798, 21.04078099109349, 21.308730183524613, 21.544798161024403, 21.769281810799864, 21.982703576083253, 22.188243228238502, 22.384504796519913, 22.578077363861727, 22.761091269771114, 22.943767083452716, 23.115339958706524, 23.277617618874903], 3, [1, 1, 1, 1, 2, 2, 2, 3, 3, 4, 4, 5, 6, 6, 6, 6], Discrete Markov Chain
stochastic matrix of type Matrix{Float64}:
[0.09090909090909091 0.09090909090909091 … 0.0 0.0; 0.09090909090909091 0.09090909090909091 … 0.0 0.0; … ; 0.0 0.0 … 0.09090909090909091 0.09090909090909091; 0.0 0.0 … 0.09090909090909091 0.09090909090909091])
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="exercises">
<h2><a class="toc-backref" href="#id14"><span class="section-number">40.5. </span>Exercises</a><a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>In the stochastic optimal growth lecture <a class="reference internal" href="optgrowth.html"><span class="doc">dynamic programming lecture</span></a>, we solve a
<a class="reference internal" href="optgrowth.html#benchmark-growth-mod"><span class="std std-ref">benchmark model</span></a> that has an analytical solution to check we could replicate it numerically.</p>
<p>The exercise is to replicate this solution using <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code>.</p>
</div>
<div class="section" id="solutions">
<h2><a class="toc-backref" href="#id15"><span class="section-number">40.6. </span>Solutions</a><a class="headerlink" href="#solutions" title="Permalink to this headline">¶</a></h2>
<p>These were written jointly by Max Huber and Daisuke Oyama.</p>
<div class="section" id="setup">
<h3><span class="section-number">40.6.1. </span>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>Details of the model can be found in <a class="reference external" href="https://julia.quantecon.org/dynamic_programming/optgrowth.html">the
lecture</a>. As in the lecture,
we let <span class="math notranslate nohighlight">\(f(k) = k^{\alpha}\)</span> with <span class="math notranslate nohighlight">\(\alpha = 0.65\)</span>,
<span class="math notranslate nohighlight">\(u(c) = \log c\)</span>, and <span class="math notranslate nohighlight">\(\beta = 0.95\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="mf">0.65</span>
<span class="n">f</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">k</span><span class="o">.^</span><span class="n">α</span>
<span class="n">u_log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">β</span> <span class="o">=</span> <span class="mf">0.95</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.95
</pre></div>
</div>
</div>
</div>
<p>Here we want to solve a finite state version of the continuous state
model above. We discretize the state space into a grid of size
<code class="docutils literal notranslate"><span class="pre">grid_size</span> <span class="pre">=</span> <span class="pre">500</span></code>, from <span class="math notranslate nohighlight">\(10^{-6}\)</span> to <code class="docutils literal notranslate"><span class="pre">grid_max=2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">grid_max</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">grid_size</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">range</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">grid_max</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">grid_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0e-6:0.004008014028056112:2.0
</pre></div>
</div>
</div>
</div>
<p>We choose the action to be the amount of capital to save for the next
period (the state is the capital stock at the beginning of the period).
Thus the state indices and the action indices are both <code class="docutils literal notranslate"><span class="pre">1</span></code>, …,
<code class="docutils literal notranslate"><span class="pre">grid_size</span></code>. Action (indexed by) <code class="docutils literal notranslate"><span class="pre">a</span></code> is feasible at state (indexed
by) <code class="docutils literal notranslate"><span class="pre">s</span></code> if and only if <code class="docutils literal notranslate"><span class="pre">grid[a]</span> <span class="pre">&lt;</span> <span class="pre">f([grid[s])</span></code> (zero consumption is
not allowed because of the log utility).</p>
<p>Thus the Bellman equation is:</p>
<div class="math notranslate nohighlight">
\[
v(k) = \max_{0 &lt; k' &lt; f(k)} u(f(k) - k') + \beta v(k'),
\]</div>
<p>where <span class="math notranslate nohighlight">\(k^{\prime}\)</span> is the capital stock in the next period.</p>
<p>The transition probability array <code class="docutils literal notranslate"><span class="pre">Q</span></code> will be highly sparse (in fact it
is degenerate as the model is deterministic), so we formulate the
problem with state-action pairs, to represent <code class="docutils literal notranslate"><span class="pre">Q</span></code> in sparse matrix
format.</p>
<p>We first construct indices for state-action pairs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">.-</span> <span class="n">grid</span><span class="o">&#39;</span>
<span class="n">coord</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">grid_size</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span> <span class="c">#coordinate matrix</span>
<span class="n">s_indices</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">C</span> <span class="o">.&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">a_indices</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">(</span><span class="n">coord</span><span class="p">)[</span><span class="n">C</span> <span class="o">.&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">a_indices</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>118841
</pre></div>
</div>
</div>
</div>
<p>Now let’s set up <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(Q\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">u_log</span><span class="o">.</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">C</span><span class="o">.&gt;</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">SparseArrays</span>

<span class="n">Q</span> <span class="o">=</span> <span class="n">spzeros</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span> <span class="c"># Formerly spzeros</span>

<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">L</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">a_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<p>We’re now in a position to create an instance of <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code>
corresponding to the growth model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ddp</span> <span class="o">=</span> <span class="n">DiscreteDP</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">s_indices</span><span class="p">,</span> <span class="n">a_indices</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="solving-the-model">
<h3><span class="section-number">40.6.2. </span>Solving the Model<a class="headerlink" href="#solving-the-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">PFI</span><span class="p">)</span>
<span class="n">v</span><span class="p">,</span> <span class="n">σ</span><span class="p">,</span> <span class="n">num_iter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">num_iter</span>
<span class="n">num_iter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p>Let us compare the solution of the discrete model with the exact
solution of the original continuous model. Here’s the exact solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid</span><span class="p">[</span><span class="n">σ</span><span class="p">]</span>

<span class="n">ab</span> <span class="o">=</span> <span class="n">α</span> <span class="o">*</span> <span class="n">β</span>
<span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span> <span class="o">*</span> <span class="n">β</span><span class="p">)</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">α</span> <span class="o">*</span> <span class="n">β</span><span class="p">)</span> <span class="o">*</span> <span class="n">α</span> <span class="o">*</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span> <span class="o">*</span> <span class="n">β</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">α</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span> <span class="o">*</span> <span class="n">β</span><span class="p">)</span>

<span class="n">v_star</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="n">c_star</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span> <span class="o">*</span> <span class="n">β</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="o">.^</span><span class="n">α</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c_star (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the value functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span> <span class="n">v_star</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">)],</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">),</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;discrete&quot;</span> <span class="s">&quot;continuous&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/discrete_dp_53_0.svg" src="../_images/discrete_dp_53_0.svg" /></div>
</div>
<p>They are barely distinguishable (although you can see the difference if
you zoom).</p>
<p>Now let’s look at the discrete and exact policy functions for
consumption.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span> <span class="n">c_star</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">)],</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;discrete&quot;</span> <span class="s">&quot;continuous&quot;</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="ss">:topleft</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/discrete_dp_55_0.svg" src="../_images/discrete_dp_55_0.svg" /></div>
</div>
<p>These functions are again close, although some difference is visible and
becomes more obvious as you zoom. Here are some statistics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">maximum</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">v_star</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">grid</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>121.49819147053378
</pre></div>
</div>
</div>
</div>
<p>This is a big error, but most of the error occurs at the lowest
gridpoint. Otherwise the fit is reasonable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">maximum</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_star</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span> <span class="k">for</span> <span class="n">idx</span> <span class="k">in</span> <span class="mi">2</span><span class="o">:</span><span class="n">lastindex</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.012681735127500815
</pre></div>
</div>
</div>
</div>
<p>The value function is monotone, as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">≥</span> <span class="mi">0</span><span class="p">,</span> <span class="n">diff</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparison-of-the-solution-methods">
<h3><span class="section-number">40.6.3. </span>Comparison of the solution methods<a class="headerlink" href="#comparison-of-the-solution-methods" title="Permalink to this headline">¶</a></h3>
<p>Let’s try different solution methods. The results below show that policy
function iteration and modified policy function iteration are much
faster that value function iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@benchmark</span> <span class="n">results</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">PFI</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">PFI</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@benchmark</span> <span class="n">res1</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">VFI</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">)</span>
<span class="n">res1</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">VFI</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">res1</span><span class="o">.</span><span class="n">num_iter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>294
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">σ</span> <span class="o">==</span> <span class="n">res1</span><span class="o">.</span><span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@benchmark</span> <span class="n">res2</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">MPFI</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">)</span>
<span class="n">res2</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">MPFI</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">res2</span><span class="o">.</span><span class="n">num_iter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">σ</span> <span class="o">==</span> <span class="n">res2</span><span class="o">.</span><span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="replication-of-the-figures">
<h3><span class="section-number">40.6.4. </span>Replication of the figures<a class="headerlink" href="#replication-of-the-figures" title="Permalink to this headline">¶</a></h3>
<p>Let’s visualize convergence of value function iteration, as in the
lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">w_init</span> <span class="o">=</span> <span class="mi">5</span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">.-</span> <span class="mi">25</span>  <span class="c"># Initial condition</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">ws</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">w_init</span>
<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">bellman_operator</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">push!</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">push!</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">RGBA</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="n">n</span><span class="p">))</span>
<span class="k">end</span>

<span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span>
     <span class="n">w_init</span><span class="p">,</span>
     <span class="n">ylims</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
     <span class="n">xlims</span> <span class="o">=</span> <span class="n">extrema</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span>
     <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;initial condition&quot;</span><span class="p">)</span>

<span class="n">plot!</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span>  <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">colors</span><span class="p">)),</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">v_star</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;true value function&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="ss">:red</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/discrete_dp_76_0.svg" src="../_images/discrete_dp_76_0.svg" /></div>
</div>
<p>We next plot the consumption policies along the value iteration. First
we write a function to generate the and record the policies at given
stages of iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">compute_policies</span><span class="p">(</span><span class="n">n_vals</span><span class="o">...</span><span class="p">)</span>
    <span class="n">c_policies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">w_init</span>
    <span class="k">for</span> <span class="n">n</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">maximum</span><span class="p">(</span><span class="n">n_vals</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">bellman_operator</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="k">in</span> <span class="n">n_vals</span>
            <span class="n">σ</span> <span class="o">=</span> <span class="n">compute_greedy</span><span class="p">(</span><span class="n">ddp</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
            <span class="n">c_policy</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid</span><span class="p">[</span><span class="n">σ</span><span class="p">]</span>
            <span class="n">push!</span><span class="p">(</span><span class="n">c_policies</span><span class="p">,</span> <span class="n">c_policy</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">c_policies</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>compute_policies (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Now let’s generate the plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">true_c</span> <span class="o">=</span> <span class="n">c_star</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="n">c_policies</span> <span class="o">=</span> <span class="n">compute_policies</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plot_vecs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_policies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">c_policies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">c_policies</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">true_c</span> <span class="n">true_c</span> <span class="n">true_c</span><span class="p">]</span>
<span class="n">l1</span> <span class="o">=</span> <span class="s">&quot;approximate optimal policy&quot;</span>
<span class="n">l2</span> <span class="o">=</span> <span class="s">&quot;optimal consumption policy&quot;</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l1</span> <span class="n">l1</span> <span class="n">l1</span> <span class="n">l2</span> <span class="n">l2</span> <span class="n">l2</span><span class="p">]</span>
<span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span>
     <span class="n">plot_vecs</span><span class="p">,</span>
     <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
     <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
     <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
     <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
     <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span>
     <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span>
     <span class="n">title</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;2 iterations&quot;</span> <span class="s">&quot;4 iterations&quot;</span> <span class="s">&quot;6 iterations&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/discrete_dp_81_0.svg" src="../_images/discrete_dp_81_0.svg" /></div>
</div>
</div>
<div class="section" id="dynamics-of-the-capital-stock">
<h3><span class="section-number">40.6.5. </span>Dynamics of the capital stock<a class="headerlink" href="#dynamics-of-the-capital-stock" title="Permalink to this headline">¶</a></h3>
<p>Finally, let us work on <a class="reference external" href="https://julia.quantecon.org/dynamic_programming/optgrowth.html#Exercise-1">Exercise
2</a>, where we plot
the trajectories of the capital stock for three different discount
factors, <span class="math notranslate nohighlight">\(0.9\)</span>, <span class="math notranslate nohighlight">\(0.94\)</span>, and <span class="math notranslate nohighlight">\(0.98\)</span>, with initial
condition <span class="math notranslate nohighlight">\(k_0 = 0.1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">discount_factors</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">)</span>
<span class="n">k_init</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">k_init_ind</span> <span class="o">=</span> <span class="n">findfirst</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">.≥</span> <span class="n">k_init</span><span class="p">)</span>

<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">ddp0</span> <span class="o">=</span> <span class="n">DiscreteDP</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">s_indices</span><span class="p">,</span> <span class="n">a_indices</span><span class="p">)</span>
<span class="n">k_paths</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">β</span> <span class="k">in</span> <span class="n">discount_factors</span>
    <span class="n">ddp0</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">β</span>
    <span class="n">res0</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">ddp0</span><span class="p">,</span> <span class="n">PFI</span><span class="p">)</span>
    <span class="n">k_path_ind</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">res0</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">k_init_ind</span><span class="p">)</span>
    <span class="n">k_path</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">k_path_ind</span><span class="o">.+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">push!</span><span class="p">(</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">k_path</span><span class="p">)</span>
    <span class="n">push!</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;</span><span class="se">\b</span><span class="s">eta = %</span><span class="si">$β</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">plot</span><span class="p">(</span><span class="n">k_paths</span><span class="p">,</span>
     <span class="n">xlabel</span> <span class="o">=</span> <span class="s">&quot;time&quot;</span><span class="p">,</span>
     <span class="n">ylabel</span> <span class="o">=</span> <span class="s">&quot;capital&quot;</span><span class="p">,</span>
     <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
     <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
     <span class="n">markershape</span> <span class="o">=</span> <span class="ss">:circle</span><span class="p">,</span>
     <span class="n">label</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/discrete_dp_84_0.svg" src="../_images/discrete_dp_84_0.svg" /></div>
</div>
</div>
</div>
<div class="section" id="appendix-algorithms">
<span id="ddp-algorithms"></span><h2><a class="toc-backref" href="#id16"><span class="section-number">40.7. </span>Appendix: Algorithms</a><a class="headerlink" href="#appendix-algorithms" title="Permalink to this headline">¶</a></h2>
<p>This appendix covers the details of the solution algorithms implemented for <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code>.</p>
<p>We will make use of the following notions of approximate optimality:</p>
<ul class="simple">
<li><p>For <span class="math notranslate nohighlight">\(\varepsilon &gt; 0\)</span>, <span class="math notranslate nohighlight">\(v\)</span> is called an  <span class="math notranslate nohighlight">\(\varepsilon\)</span>-approximation of <span class="math notranslate nohighlight">\(v^*\)</span> if <span class="math notranslate nohighlight">\(\lVert v - v^*\rVert &lt; \varepsilon\)</span></p></li>
<li><p>A policy <span class="math notranslate nohighlight">\(\sigma \in \Sigma\)</span> is called <span class="math notranslate nohighlight">\(\varepsilon\)</span>-optimal if <span class="math notranslate nohighlight">\(v_{\sigma}\)</span> is an <span class="math notranslate nohighlight">\(\varepsilon\)</span>-approximation of <span class="math notranslate nohighlight">\(v^*\)</span></p></li>
</ul>
<div class="section" id="value-iteration">
<h3><span class="section-number">40.7.1. </span>Value Iteration<a class="headerlink" href="#value-iteration" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code> value iteration method implements value function iteration as
follows</p>
<ol class="simple">
<li><p>Choose any <span class="math notranslate nohighlight">\(v^0 \in \mathbb{R}^n\)</span>, and specify <span class="math notranslate nohighlight">\(\varepsilon &gt; 0\)</span>; set <span class="math notranslate nohighlight">\(i = 0\)</span>.</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(v^{i+1} = T v^i\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\lVert v^{i+1} - v^i\rVert &lt;  [(1 - \beta) / (2\beta)] \varepsilon\)</span>,
then go to step 4; otherwise, set <span class="math notranslate nohighlight">\(i = i + 1\)</span> and go to step 2.</p></li>
<li><p>Compute a <span class="math notranslate nohighlight">\(v^{i+1}\)</span>-greedy policy <span class="math notranslate nohighlight">\(\sigma\)</span>, and return <span class="math notranslate nohighlight">\(v^{i+1}\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span>.</p></li>
</ol>
<p>Given <span class="math notranslate nohighlight">\(\varepsilon &gt; 0\)</span>, the value iteration algorithm</p>
<ul class="simple">
<li><p>terminates in a finite number of iterations</p></li>
<li><p>returns an <span class="math notranslate nohighlight">\(\varepsilon/2\)</span>-approximation of the optimal value function and an <span class="math notranslate nohighlight">\(\varepsilon\)</span>-optimal policy function (unless <code class="docutils literal notranslate"><span class="pre">iter_max</span></code> is reached)</p></li>
</ul>
<p>(While not explicit, in the actual implementation each algorithm is
terminated if the number of iterations reaches <code class="docutils literal notranslate"><span class="pre">iter_max</span></code>)</p>
</div>
<div class="section" id="policy-iteration">
<h3><span class="section-number">40.7.2. </span>Policy Iteration<a class="headerlink" href="#policy-iteration" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code> policy iteration method runs as follows</p>
<ol class="simple">
<li><p>Choose any <span class="math notranslate nohighlight">\(v^0 \in \mathbb{R}^n\)</span> and compute a <span class="math notranslate nohighlight">\(v^0\)</span>-greedy policy <span class="math notranslate nohighlight">\(\sigma^0\)</span>; set <span class="math notranslate nohighlight">\(i = 0\)</span>.</p></li>
<li><p>Compute the value <span class="math notranslate nohighlight">\(v_{\sigma^i}\)</span> by solving
the equation <span class="math notranslate nohighlight">\(v = T_{\sigma^i} v\)</span>.</p></li>
<li><p>Compute a <span class="math notranslate nohighlight">\(v_{\sigma^i}\)</span>-greedy policy
<span class="math notranslate nohighlight">\(\sigma^{i+1}\)</span>; let <span class="math notranslate nohighlight">\(\sigma^{i+1} = \sigma^i\)</span> if
possible.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\sigma^{i+1} = \sigma^i\)</span>, then return <span class="math notranslate nohighlight">\(v_{\sigma^i}\)</span>
and <span class="math notranslate nohighlight">\(\sigma^{i+1}\)</span>; otherwise, set <span class="math notranslate nohighlight">\(i = i + 1\)</span> and go to
step 2.</p></li>
</ol>
<p>The policy iteration algorithm terminates in a finite number of
iterations.</p>
<p>It returns an optimal value function and an optimal policy function (unless <code class="docutils literal notranslate"><span class="pre">iter_max</span></code> is reached).</p>
</div>
<div class="section" id="modified-policy-iteration">
<h3><span class="section-number">40.7.3. </span>Modified Policy Iteration<a class="headerlink" href="#modified-policy-iteration" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code> modified policy iteration method runs as follows:</p>
<ol class="simple">
<li><p>Choose any <span class="math notranslate nohighlight">\(v^0 \in \mathbb{R}^n\)</span>, and specify <span class="math notranslate nohighlight">\(\varepsilon &gt; 0\)</span> and <span class="math notranslate nohighlight">\(k \geq 0\)</span>; set <span class="math notranslate nohighlight">\(i = 0\)</span>.</p></li>
<li><p>Compute a <span class="math notranslate nohighlight">\(v^i\)</span>-greedy policy <span class="math notranslate nohighlight">\(\sigma^{i+1}\)</span>; let <span class="math notranslate nohighlight">\(\sigma^{i+1} = \sigma^i\)</span> if possible (for <span class="math notranslate nohighlight">\(i \geq 1\)</span>).</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(u = T v^i\)</span> (<span class="math notranslate nohighlight">\(= T_{\sigma^{i+1}} v^i\)</span>). If <span class="math notranslate nohighlight">\(\mathrm{span}(u - v^i) &lt; [(1 - \beta) / \beta] \varepsilon\)</span>, then go to step 5; otherwise go to step 4.</p>
<ul class="simple">
<li><p>Span is defined by <span class="math notranslate nohighlight">\(\mathrm{span}(z) = \max(z) - \min(z)\)</span></p></li>
</ul>
</li>
<li><p>Compute <span class="math notranslate nohighlight">\(v^{i+1} = (T_{\sigma^{i+1}})^k u\)</span> (<span class="math notranslate nohighlight">\(= (T_{\sigma^{i+1}})^{k+1} v^i\)</span>); set <span class="math notranslate nohighlight">\(i = i + 1\)</span> and go to step 2.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(v = u + [\beta / (1 - \beta)] [(\min(u - v^i) + \max(u - v^i)) / 2] \mathbf{1}\)</span> and <span class="math notranslate nohighlight">\(\sigma_{i+1}\)</span>.</p></li>
</ol>
<p>Given <span class="math notranslate nohighlight">\(\varepsilon &gt; 0\)</span>, provided that <span class="math notranslate nohighlight">\(v^0\)</span> is such that
<span class="math notranslate nohighlight">\(T v^0 \geq v^0\)</span>, the modified policy iteration algorithm
terminates in a finite number of iterations.</p>
<p>It returns an <span class="math notranslate nohighlight">\(\varepsilon/2\)</span>-approximation of the optimal value function and an <span class="math notranslate nohighlight">\(\varepsilon\)</span>-optimal policy function (unless <code class="docutils literal notranslate"><span class="pre">iter_max</span></code> is reached).</p>
<p>See also the documentation for <code class="docutils literal notranslate"><span class="pre">DiscreteDP</span></code>.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.7"
        },
        kernelOptions: {
            kernelName: "julia-1.7",
            path: "./dynamic_programming"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.7'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started with Julia
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/getting_started.html">
   1. Setting up Your Julia Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_by_example.html">
   2. Introductory Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_essentials.html">
   3. Julia Essentials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/fundamental_types.html">
   4. Arrays, Tuples, Ranges, and Other Fundamental Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/introduction_to_types.html">
   5. Introduction to Types and Generic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Package Ecosystem
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/generic_programming.html">
   6. Generic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/general_packages.html">
   7. General Purpose Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/data_statistical_packages.html">
   8. Data and Statistics Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/optimization_solver_packages.html">
   9. Solvers, Optimizers, and Automatic Differentiation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Software Engineering
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../software_engineering/tools_editors.html">
   10. Visual Studio Code and Other Tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../software_engineering/version_control.html">
   11. GitHub, Version Control and Collaboration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../software_engineering/testing.html">
   12. Packages, Testing, and Continuous Integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../software_engineering/need_for_speed.html">
   13. The Need for Speed
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/geom_series.html">
   14. Geometric Series for Elementary Economics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/linear_algebra.html">
   15. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/orth_proj.html">
   16. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/lln_clt.html">
   17. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/linear_models.html">
   18. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/finite_markov.html">
   19. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/stationary_densities.html">
   20. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/kalman.html">
   21. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/numerical_linear_algebra.html">
   22. Numerical Linear Algebra and Factorizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/iterative_methods_sparsity.html">
   23. Krylov Methods and Matrix Conditioning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="short_path.html">
   24. Shortest Paths
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   25. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   26. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   27. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   28. Job Search III: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   29. Job Search IV: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   30. Job Search V: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   31. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   32. Optimal Growth II: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   33. Optimal Growth III: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   34. LQ Dynamic Programming Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   35. Optimal Savings I: The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   36. Optimal Savings II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing.html">
   37. Consumption and Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   38. Optimal Savings III: Occasionally Binding Constraints
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="robustness.html">
   39. Robustness
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   40. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Modeling in Continuous Time
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../continuous_time/seir_model.html">
   41. Modeling COVID 19 with Differential Equations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../continuous_time/covid_sde.html">
   42. Modeling Shocks in COVID 19 with Stochastic Differential Equations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/schelling.html">
   43. Schelling’s Segregation Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/lake_model.html">
   44. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/rational_expectations.html">
   45. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/markov_perf.html">
   46. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/markov_asset.html">
   47. Asset Pricing I: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/lucas_model.html">
   48. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/harrison_kreps.html">
   49. Asset Pricing III:  Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/uncertainty_traps.html">
   50. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/aiyagari.html">
   51. The Aiyagari Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/arellano.html">
   52. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/matsuyama.html">
   53. Globalization and Cycles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/arma.html">
   54. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/estspec.html">
   55. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/additive_functionals.html">
   56. Additive Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/multiplicative_functionals.html">
   57. Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/lu_tricks.html">
   58. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/classical_filtering.html">
   59. Classical Filtering With Linear Algebra
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/dyn_stack.html">
   60. Dynamic Stackelberg Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/lqramsey.html">
   61. Optimal Taxation in an LQ Economy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/opt_tax_recur.html">
   62. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/amss.html">
   63. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about_lectures.html">
   64. About these Lectures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../troubleshooting.html">
   65. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../zreferences.html">
   66. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../status.html">
   67. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="../intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="../search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="qe-toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/dynamic_programming/discrete_dp.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-julia.myst/tree/main/lectures/dynamic_programming/discrete_dp.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-julia.notebooks/main?urlpath=tree/dynamic_programming/discrete_dp.ipynb">BinderHub</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-julia.notebooks" data-urlpath="tree/lecture-julia.notebooks/dynamic_programming/discrete_dp.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-julia.notebooks/main?urlpath=tree/dynamic_programming/discrete_dp.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "dynamic_programming/discrete_dp";
                const repoURL = "https://github.com/QuantEcon/lecture-julia.notebooks";
                const urlPath = "tree/lecture-julia.notebooks/dynamic_programming/discrete_dp.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-54984338-8', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>