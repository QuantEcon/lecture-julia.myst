
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12. Packages, Testing, and Continuous Integration &#8212; Quantitative Economics with Julia</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <link rel="canonical" href="https://julia.quantecon.org/software_engineering/testing.html" />
    <link rel="shortcut icon" href="../_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="13. The Need for Speed" href="need_for_speed.html" />
    <link rel="prev" title="11. GitHub, Version Control and Collaboration" href="version_control.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-54984338-8', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/qe-logo-large.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Quantitative Economics with Julia</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started with Julia
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/getting_started.html">
   1. Setting up Your Julia Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_by_example.html">
   2. Introductory Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/julia_essentials.html">
   3. Julia Essentials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/fundamental_types.html">
   4. Arrays, Tuples, Ranges, and Other Fundamental Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started_julia/introduction_to_types.html">
   5. Introduction to Types and Generic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Package Ecosystem
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/generic_programming.html">
   6. Generic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/general_packages.html">
   7. General Purpose Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/data_statistical_packages.html">
   8. Data and Statistics Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../more_julia/optimization_solver_packages.html">
   9. Solvers, Optimizers, and Automatic Differentiation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Software Engineering
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tools_editors.html">
   10. Visual Studio Code and Other Tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="version_control.html">
   11. GitHub, Version Control and Collaboration
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   12. Packages, Testing, and Continuous Integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="need_for_speed.html">
   13. The Need for Speed
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/geom_series.html">
   14. Geometric Series for Elementary Economics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/linear_algebra.html">
   15. Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/orth_proj.html">
   16. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/lln_clt.html">
   17. LLN and CLT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/stationary_densities.html">
   18. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/numerical_linear_algebra.html">
   19. Numerical Linear Algebra and Factorizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tools_and_techniques/iterative_methods_sparsity.html">
   20. Krylov Methods and Matrix Conditioning
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Dynamics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/scalar_dynam.html">
   21. Dynamics in One Dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/ar1_processes.html">
   22. AR1 Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/finite_markov.html">
   23. Finite Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/linear_models.html">
   24. Linear State Space Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/wealth_dynamics.html">
   25. Wealth Distribution Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/kalman.html">
   26. A First Look at the Kalman Filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_dynamics/short_path.html">
   27. Shortest Paths
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/mccall_model.html">
   28. Job Search I: The McCall Search Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/mccall_model_with_separation.html">
   29. Job Search II: Search and Separation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/wald_friedman.html">
   30. A Problem that Stumped Milton Friedman
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/odu.html">
   31. Job Search III: Search with Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/career.html">
   32. Job Search IV: Modeling Career Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/jv.html">
   33. Job Search V: On-the-Job Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/optgrowth.html">
   34. Optimal Growth I: The Stochastic Optimal Growth Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/coleman_policy_iter.html">
   35. Optimal Growth II: Time Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/egm_policy_iter.html">
   36. Optimal Growth III: The Endogenous Grid Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/lqcontrol.html">
   37. LQ Dynamic Programming Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/perm_income.html">
   38. Optimal Savings I: The Permanent Income Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/perm_income_cons.html">
   39. Optimal Savings II: LQ Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/smoothing.html">
   40. Consumption and Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/ifp.html">
   41. Optimal Savings III: Occasionally Binding Constraints
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/robustness.html">
   42. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming/discrete_dp.html">
   43. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Modeling in Continuous Time
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../continuous_time/seir_model.html">
   44. Modeling COVID 19 with Differential Equations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../continuous_time/covid_sde.html">
   45. Modeling Shocks in COVID 19 with Stochastic Differential Equations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/schelling.html">
   46. Schelling’s Segregation Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/lake_model.html">
   47. A Lake Model of Employment and Unemployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/rational_expectations.html">
   48. Rational Expectations Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/markov_perf.html">
   49. Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/markov_asset.html">
   50. Asset Pricing I: Finite State Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/lucas_model.html">
   51. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/harrison_kreps.html">
   52. Asset Pricing III:  Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/uncertainty_traps.html">
   53. Uncertainty Traps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/aiyagari.html">
   54. The Aiyagari Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/arellano.html">
   55. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../multi_agent_models/matsuyama.html">
   56. Globalization and Cycles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/arma.html">
   57. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/estspec.html">
   58. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/additive_functionals.html">
   59. Additive Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/multiplicative_functionals.html">
   60. Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/lu_tricks.html">
   61. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_series_models/classical_filtering.html">
   62. Classical Filtering With Linear Algebra
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/dyn_stack.html">
   63. Dynamic Stackelberg Problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/lqramsey.html">
   64. Optimal Taxation in an LQ Economy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/opt_tax_recur.html">
   65. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dynamic_programming_squared/amss.html">
   66. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../about_lectures.html">
   67. About these Lectures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../troubleshooting.html">
   68. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../zreferences.html">
   69. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../status.html">
   70. Execution Statistics
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/software_engineering/testing.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-and-setup">
   12.1. Introduction and Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#github-and-codecov-account-setup">
     12.1.1. GitHub and Codecov Account Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pkgtemplates-jl-and-revise-jl">
     12.1.2. PkgTemplates.jl and Revise.jl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-setup">
   12.2. Project Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-a-project-to-github">
     12.2.1. Adding a Project to GitHub
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optionally-adding-the-package-to-the-global-environment">
     12.2.2. (Optionally) Adding the Package to the Global Environment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-structure">
   12.3. Project Structure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#github-actions-and-ci">
     12.3.1. GitHub Actions and CI
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-workflow">
   12.4. Project Workflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dependency-management">
     12.4.1. Dependency Management
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#environments">
       12.4.1.1. Environments
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pkg-operations">
       12.4.1.2. Pkg Operations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-driven-development">
     12.4.2. Test-driven Development
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-code-in-the-package">
     12.4.3. Writing Code in the Package
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-test-code">
     12.4.4. Writing Test Code
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#executing-tests-locally-and-on-ci">
     12.4.5. Executing Tests Locally and on CI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-branches-and-continuous-integration">
     12.4.6. “Feature” Branches and Continuous Integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code-coverage">
     12.4.7. Code Coverage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jupyter-workflow">
     12.4.8. Jupyter Workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-writing-tests">
   12.5. More on Writing Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-test-module">
     12.5.1. The
     <code class="docutils literal notranslate">
      <span class="pre">
       Test
      </span>
     </code>
     Module
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-sets">
     12.5.2. Test Sets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   12.6. Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-1">
     12.6.1. Exercise 1
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Packages, Testing, and Continuous Integration</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-and-setup">
   12.1. Introduction and Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#github-and-codecov-account-setup">
     12.1.1. GitHub and Codecov Account Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pkgtemplates-jl-and-revise-jl">
     12.1.2. PkgTemplates.jl and Revise.jl
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-setup">
   12.2. Project Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-a-project-to-github">
     12.2.1. Adding a Project to GitHub
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optionally-adding-the-package-to-the-global-environment">
     12.2.2. (Optionally) Adding the Package to the Global Environment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-structure">
   12.3. Project Structure
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#github-actions-and-ci">
     12.3.1. GitHub Actions and CI
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-workflow">
   12.4. Project Workflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dependency-management">
     12.4.1. Dependency Management
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#environments">
       12.4.1.1. Environments
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pkg-operations">
       12.4.1.2. Pkg Operations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-driven-development">
     12.4.2. Test-driven Development
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-code-in-the-package">
     12.4.3. Writing Code in the Package
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#writing-test-code">
     12.4.4. Writing Test Code
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#executing-tests-locally-and-on-ci">
     12.4.5. Executing Tests Locally and on CI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-branches-and-continuous-integration">
     12.4.6. “Feature” Branches and Continuous Integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code-coverage">
     12.4.7. Code Coverage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jupyter-workflow">
     12.4.8. Jupyter Workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-writing-tests">
   12.5. More on Writing Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-test-module">
     12.5.1. The
     <code class="docutils literal notranslate">
      <span class="pre">
       Test
      </span>
     </code>
     Module
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-sets">
     12.5.2. Test Sets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   12.6. Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-1">
     12.6.1. Exercise 1
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div id="qe-notebook-header" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><div class="tex2jax_ignore mathjax_ignore section" id="packages-testing-and-continuous-integration">
<h1><a class="toc-backref" href="#id2"><span class="section-number">12. </span>Packages, Testing, and Continuous Integration</a><a class="headerlink" href="#packages-testing-and-continuous-integration" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#packages-testing-and-continuous-integration" id="id2">Packages, Testing, and Continuous Integration</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction-and-setup" id="id3">Introduction and Setup</a></p></li>
<li><p><a class="reference internal" href="#project-setup" id="id4">Project Setup</a></p></li>
<li><p><a class="reference internal" href="#project-structure" id="id5">Project Structure</a></p></li>
<li><p><a class="reference internal" href="#project-workflow" id="id6">Project Workflow</a></p></li>
<li><p><a class="reference internal" href="#more-on-writing-tests" id="id7">More on Writing Tests</a></p></li>
<li><p><a class="reference internal" href="#exercises" id="id8">Exercises</a></p></li>
</ul>
</li>
</ul>
</div>
<blockquote class="epigraph">
<div><p>A complex system that works is invariably found to have evolved from a simple system that worked. The inverse proposition also appears to be true: A complex system designed from scratch never works and cannot be made to work. You have to start over, beginning with a working simple system – <a class="reference external" href="https://en.wikipedia.org/wiki/John_Gall_%28author%29#Gall%27s_law">Gall’s Law</a>.</p>
</div></blockquote>
<p>This lecture discusses structuring a project as a Julia module, and testing it with tools from GitHub.</p>
<p>Benefits include:</p>
<ul class="simple">
<li><p>Specifying dependencies (and their versions) so that your project works across Julia setups and over time.</p></li>
<li><p>Being able to load your project’s functions from outside without copy/pasting.</p></li>
<li><p>Writing tests that run locally, <em>and automatically on the GitHub server</em>.</p></li>
<li><p>Having GitHub test your project across operating systems, Julia versions, etc.</p></li>
</ul>
<p><strong>Note:</strong> Throughout this lecture, important points and sequential workflow steps are listed as bullets.</p>
<p>The goal of this style of coding is to ensure that <a class="reference internal" href="#test-driven"><span class="std std-ref">test driven development</span></a> is possible, which will help ensure that your research is reproducible by yourself, your future self, and others - while avoiding accidental mistakes that can silently break old code and change results.</p>
<p>Furthermore, it makes collaboration on code much more feasible - allowing individuals to work on different parts of the code without fear of breaking others’ work.</p>
<p>Finally, since many economics projects occur over multiple years - this will help your future self to reproduce your results and make changes without remembering all of the subtle tricks required to get things operational.</p>
<div class="section" id="introduction-and-setup">
<h2><a class="toc-backref" href="#id3"><span class="section-number">12.1. </span>Introduction and Setup</a><a class="headerlink" href="#introduction-and-setup" title="Permalink to this headline">¶</a></h2>
<p>Much of the software engineering and continuous integration (CI) will be done through <a class="reference external" href="https://github.com/features/actions">GitHub Actions</a>.</p>
<p>The GitHub actions execute as isolated and fully reproducible environments on the cloud (using containers), and are initiated through various actions on the GitHub repo.  In particular, these are typically initiated through:</p>
<ul class="simple">
<li><p>Making commits on the main branch of a repository.</p></li>
<li><p>Creating a PR on a repository, or pushing commits to it.</p></li>
<li><p><a class="reference external" href="https://docs.github.com/en/github/administering-a-repository/releasing-projects-on-github/managing-releases-in-a-repository">Tagging a release</a> of a repository, which provides a snapshot at a particular commit.</p></li>
</ul>
<p>For publicly available repositories, GitHub provides free minutes for executing these actions, whereas there are limits on the execution time for private repositories - though signing up for the GitHub academic plans previously discussed (i.e, the <a class="reference external" href="https://education.github.com/pack/">Student Developer Pack</a> or <a class="reference external" href="https://help.github.com/articles/about-github-education-for-educators-and-researchers/">Academic/Researcher plans</a>) provides additional free minutes.</p>
<p>While you may think of a ‘’Package’’ as a shared and maintained set of reusable code, with Julia it will turn out to be the most useful way to organize personal and private projects or the code associated with a particular paper.  The primary benefit of using a package workflow is <strong>reproducibility</strong> for yourself, your future self, and collaborators.</p>
<p>In addition, you will find the testing workflow as an essential element of working on even individual projects, since it will prevent you from making accidental breaking changes at points in the future - or when you come back to the code after several years.</p>
<div class="section" id="github-and-codecov-account-setup">
<span id="testing-account-setup"></span><h3><span class="section-number">12.1.1. </span>GitHub and Codecov Account Setup<a class="headerlink" href="#github-and-codecov-account-setup" title="Permalink to this headline">¶</a></h3>
<p>This lecture assumes you have completed the setup of VS Code and Git in the  <a class="reference internal" href="version_control.html"><span class="doc">version control</span></a> and  <a class="reference internal" href="tools_editors.html"><span class="doc">tools</span></a>  lectures.  In particular,</p>
<ul class="simple">
<li><p>Ensure you have setup a GitHub account, and connected it to VS Code.</p></li>
<li><p>Installed and setup VS Code’s Julia extension.</p></li>
<li><p>Set <code class="docutils literal notranslate"> <span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">user.email</span> <span class="pre">&quot;you&#64;example.com&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">user.name</span> <span class="pre">&quot;Your</span> <span class="pre">Name&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">github.user</span> <span class="pre">&quot;YOURGITHUBNAME&quot;</span></code> in your terminal.</p></li>
</ul>
<p>The only other service that is necessary for the complete software engineering stack is a code coverage provider.</p>
<p>For these lectures, visit <a class="reference external" href="https://about.codecov.io/sign-up/">Codecov website</a>.</p>
<p>Installation instructions are <a class="reference external" href="https://docs.codecov.com/docs/quick-start#getting-started">here</a>.</p>
<p>To summarize: sign up, and sign into it with <code class="docutils literal notranslate"><span class="pre">GitHub</span></code>.  You may need to provide permissions for Codecov to access GitHub, follow the provided authorization instructions.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/codecov-1.png"><img alt="../_images/codecov-1.png" src="../_images/codecov-1.png" style="width: 100%;" /></a>
</div>
<!-- 
TODO: I think this has changed and we should do it later in the workflow?

Next, for any private repositories you can click "add a repository" and *enable private scope* (this allows Codecov to service your private projects).

The result should be

```{figure} /_static/figures/codecov-2.png
:width: 50%
``` 
-->
</div>
<div class="section" id="pkgtemplates-jl-and-revise-jl">
<span id="testing-pkg-installation"></span><h3><span class="section-number">12.1.2. </span>PkgTemplates.jl and Revise.jl<a class="headerlink" href="#pkgtemplates-jl-and-revise-jl" title="Permalink to this headline">¶</a></h3>
<p>While you can create your Julia package manually, using a template will ensure that you have everything in the standard format.</p>
<p>If you have activated the notebook repositories, then <code class="docutils literal notranslate"><span class="pre">PkgTemplates.jl</span></code> will already be installed.</p>
<p>Otherwise, start a <code class="docutils literal notranslate"><span class="pre">julia</span></code> REPL outside of a particular project (or do an <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">activate</span></code> to deactivate the existing project, and use the global environment) and</p>
<ul class="simple">
<li><p>Install <a class="reference external" href="https://juliaci.github.io/PkgTemplates.jl/stable/">PkgTemplates</a> and <a class="reference external" href="https://github.com/timholy/Revise.jl">Revise</a> with</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="p">]</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">PkgTemplates</span><span class="w"> </span><span class="n">Revise</span>
</pre></div>
</div>
<p>While we typically insist on having very few packages in the global environment, and always working with a <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> file, <code class="docutils literal notranslate"><span class="pre">PkgTemplates</span></code> is primarily used without an existing project.</p>
<p>While the <a class="reference external" href="https://github.com/timholy/Revise.jl">Revise.jl</a> package is optional, it is strongly encouraged since it automatically compiling functions in your package as they are changed.  See <a class="reference internal" href="#editing-package-code"><span class="std std-ref">below</span></a> for more.</p>
</div>
</div>
<div class="section" id="project-setup">
<span id="id1"></span><h2><a class="toc-backref" href="#id4"><span class="section-number">12.2. </span>Project Setup</a><a class="headerlink" href="#project-setup" title="Permalink to this headline">¶</a></h2>
<p>To create a project, first choose the parent directory where you wish to create the project</p>
<ul class="simple">
<li><p>In an external terminal, navigate to this parent directory.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On Windows, given that you have installed Git you could right click on the folder in explorer and choose <code class="docutils literal notranslate"><span class="pre">Git</span> <span class="pre">Bash</span> <span class="pre">Here</span></code>.  Even better, install the <a class="reference external" href="https://docs.microsoft.com/en-us/windows/terminal/get-started">Windows Terminal</a> and choose <code class="docutils literal notranslate"><span class="pre">Open</span> <span class="pre">in</span> <span class="pre">Windows</span> <span class="pre">Terminal</span></code>.</p>
</div>
<ul class="simple">
<li><p>Start a julia terminal with <code class="docutils literal notranslate"><span class="pre">julia</span></code></p></li>
<li><p>Then run</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">PkgTemplates</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Create a <em>template</em> for your project.</p></li>
</ul>
<p>This specifies metadata like the license we’ll be using (MIT by default), the location, etc.</p>
<p>We will create this with a number of useful options, but see <a class="reference external" href="https://juliaci.github.io/PkgTemplates.jl/stable/user/#A-More-Complicated-Example-1">the documentation</a> for more.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Template</span><span class="p">(;</span><span class="n">dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">julia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">v</span><span class="s">&quot;1.9&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="n">Git</span><span class="p">(;</span><span class="w"> </span><span class="n">manifest</span><span class="o">=</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">Codecov</span><span class="p">(),</span>
<span class="w">                </span><span class="n">GitHubActions</span><span class="p">(),</span>
<span class="w">                </span><span class="o">!</span><span class="n">CompatHelper</span><span class="p">,</span>
<span class="w">                </span><span class="o">!</span><span class="n">TagBot</span>
<span class="w">              </span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you did not set the <code class="docutils literal notranslate"><span class="pre">github.user</span></code> in the setup, you may need to pass in <code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">=</span> <span class="pre">&quot;YOURUSERNAME&quot;</span></code> as an additional argument in the first line.  In addition, this turns off some important features (e.g. <code class="docutils literal notranslate"><span class="pre">CompatHelper</span></code> and <code class="docutils literal notranslate"><span class="pre">TagBot</span></code>) and leaves out others (e.g. <code class="docutils literal notranslate"><span class="pre">Documenter{GitHubActions}</span></code>) which you would want for a more formal package.</p>
<p>Alternatively, <code class="docutils literal notranslate"><span class="pre">PkgTemplates</span></code> has an interactive mode, which you can prompt with <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">Template(;interactive</span> <span class="pre">=</span> <span class="pre">true)</span></code> to choose all of your selections within the terminal.</p>
</div>
<ul class="simple">
<li><p>Create a specific project based off this template</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="p">(</span><span class="s">&quot;MyProject&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Open the project in VS Code by right-clicking in the explorer for the new <code class="docutils literal notranslate"><span class="pre">MyProject</span></code> folder, or exiting the Julia REPL (via <code class="docutils literal notranslate"><span class="pre">exit()</span></code>) and then</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>MyProject
code<span class="w"> </span>.
</pre></div>
</div>
<p>The project should open in VS Code, and look something like</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/new_package_vscode.png"><img alt="../_images/new_package_vscode.png" src="../_images/new_package_vscode.png" style="width: 100%;" /></a>
</div>
<div class="section" id="adding-a-project-to-github">
<h3><span class="section-number">12.2.1. </span>Adding a Project to GitHub<a class="headerlink" href="#adding-a-project-to-github" title="Permalink to this headline">¶</a></h3>
<p>The next step is to add this project to Git version control.</p>
<ul class="simple">
<li><p>First, we will need to create an empty GitHub Repository of the same name (but with a <code class="docutils literal notranslate"><span class="pre">.jl</span></code> extension).   Choose the <code class="docutils literal notranslate"><span class="pre">+</span></code> button to “Create a new repository”</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/new_package_vscode_2.png"><img alt="../_images/new_package_vscode_2.png" src="../_images/new_package_vscode_2.png" style="width: 100%;" /></a>
</div>
<p>In particular, ensure that</p>
<ul class="simple">
<li><p>The repo you create should have the same name as the project we added (except with a <code class="docutils literal notranslate"><span class="pre">.jl</span></code> extension).</p></li>
<li><p>We should leave the boxes unchecked for the <code class="docutils literal notranslate"><span class="pre">README.md</span></code>, <code class="docutils literal notranslate"><span class="pre">LICENSE</span></code>, and <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>, since these are handled by <code class="docutils literal notranslate"><span class="pre">PkgTemplates</span></code>.</p></li>
<li><p>If available, Grant access to <code class="docutils literal notranslate"><span class="pre">CodeCov</span></code> for this new repository.</p></li>
</ul>
<p>Then, we can now publish the generated package in VS Code to this empty repository.</p>
<p>Choose the icon to publish the branch as we did in previous lectures</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/new_package_vscode_3.png"><img alt="../_images/new_package_vscode_3.png" src="../_images/new_package_vscode_3.png" style="width: 100%;" /></a>
</div>
<p>Do not accept the request to create a <code class="docutils literal notranslate"><span class="pre">Pull</span> <span class="pre">Request</span></code> when you push the branch.</p>
<p>At which point, if you refresh the webpage, it should be filled with the generated files</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/new_package_vscode_4.png"><img alt="../_images/new_package_vscode_4.png" src="../_images/new_package_vscode_4.png" style="width: 100%;" /></a>
</div>
<p>Furthermore, you will see a badge either saying <code class="docutils literal notranslate"><span class="pre">CI</span> <span class="pre">|</span> <span class="pre">passing</span></code> or <code class="docutils literal notranslate"><span class="pre">CI</span> <span class="pre">|</span> <span class="pre">unknown</span></code> next to another for <code class="docutils literal notranslate"><span class="pre">codecov</span> <span class="pre">|</span> <span class="pre">unknown</span></code>.</p>
<p>These badges provide a summary of the current state of the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch relative to the GitHub Actions, as we will see below.  If a repository has broken any tests on the main branch, it will show <code class="docutils literal notranslate"><span class="pre">CI</span> <span class="pre">|</span> <span class="pre">failed</span></code> in red.</p>
</div>
<div class="section" id="optionally-adding-the-package-to-the-global-environment">
<span id="add-to-global"></span><h3><span class="section-number">12.2.2. </span>(Optionally) Adding the Package to the Global Environment<a class="headerlink" href="#optionally-adding-the-package-to-the-global-environment" title="Permalink to this headline">¶</a></h3>
<p>Optionally, you may wish to be able to use your package within other projects on your computer.</p>
<p>To do this, you can add it to the main environment by starting Julia in the <code class="docutils literal notranslate"><span class="pre">MyProject</span></code> folder, and without activating the project (i.e. just <code class="docutils literal notranslate"><span class="pre">julia</span></code>).</p>
<p>Then</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="p">]</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">.</span>
</pre></div>
</div>
<p>Given this, other julia code can use <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">MyProject</span></code> and, because the global environment stacks on any project files, it will be available.</p>
<p>You can see the change reflected in our default package list by running <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">st</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">      </span>Status<span class="w"> </span><span class="sb">`</span>C:<span class="se">\U</span>sers<span class="se">\j</span>esse<span class="se">\.</span>julia<span class="se">\e</span>nvironments<span class="se">\v</span><span class="m">1</span>.9<span class="se">\P</span>roject.toml<span class="sb">`</span>
<span class="w">  </span><span class="o">[</span>7073ff75<span class="o">]</span><span class="w"> </span>IJulia<span class="w"> </span>v1.23.2
<span class="w">  </span><span class="o">[</span>a361046e<span class="o">]</span><span class="w"> </span>MyProject<span class="w"> </span>v0.1.0<span class="w"> </span><span class="sb">`</span>..<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\D</span>ocuments<span class="se">\G</span>itHub<span class="se">\M</span>yProject<span class="sb">`</span>
<span class="w">  </span><span class="o">[</span>14b8a8f1<span class="o">]</span><span class="w"> </span>PkgTemplates<span class="w"> </span>v0.7.18
<span class="w">  </span><span class="o">[</span>295af30f<span class="o">]</span><span class="w"> </span>Revise<span class="w"> </span>v3.1.19<span class="w">  </span>
</pre></div>
</div>
<p>For more on the package mode, see the <a class="reference internal" href="tools_editors.html"><span class="doc">tools and editors</span></a> lecture.</p>
<p>However, this step not required if you wish to use this package as a self-contained project.</p>
</div>
</div>
<div class="section" id="project-structure">
<h2><a class="toc-backref" href="#id5"><span class="section-number">12.3. </span>Project Structure</a><a class="headerlink" href="#project-structure" title="Permalink to this headline">¶</a></h2>
<p>Let’s unpack the structure of the generated project</p>
<ul>
<li><p>A hidden directory, <code class="docutils literal notranslate"><span class="pre">.git</span></code>, holds the version control information.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">src</span></code> directory contains the project’s source code – it should contain only one file (<code class="docutils literal notranslate"><span class="pre">MyProject.jl</span></code>), which reads</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">module</span><span class="w"> </span><span class="n">MyProject</span>

<span class="n">greet</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>

<span class="k">end</span><span class="w"> </span><span class="c"># module</span>
</pre></div>
</div>
</li>
<li><p>Likewise, the <code class="docutils literal notranslate"><span class="pre">test</span></code> directory should have only one file (<code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code>), which reads</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">MyProject</span>
<span class="k">using</span><span class="w"> </span><span class="n">Test</span>

<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;MyProject.jl&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="c"># Write your own tests here.</span>
<span class="k">end</span>
</pre></div>
</div>
</li>
</ul>
<p>In particular, the workflow is to export objects we want to test (<code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">MyProject</span></code>), and test them using Julia’s <code class="docutils literal notranslate"><span class="pre">Test</span></code> module.</p>
<p>The other important text files for now are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> and <code class="docutils literal notranslate"><span class="pre">Manifest.toml</span></code>, which contain dependency information.</p></li>
</ul>
<p>In particular, the <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> contains a list of dependencies, and the <code class="docutils literal notranslate"><span class="pre">Manifest.toml</span></code> specifies their exact versions and sub-dependencies.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file (which may display as an untitled file), which contains files and paths for <code class="docutils literal notranslate"><span class="pre">git</span></code> to ignore.</p></li>
</ul>
<div class="section" id="github-actions-and-ci">
<h3><span class="section-number">12.3.1. </span>GitHub Actions and CI<a class="headerlink" href="#github-actions-and-ci" title="Permalink to this headline">¶</a></h3>
<p>The final file is a GitHub Actions file in the <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> folder, called <code class="docutils literal notranslate"><span class="pre">CI.yml</span></code> with the text similar to</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CI</span>
<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">push</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pull_request</span>
<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Julia ${{ matrix.version }} - ${{ matrix.os }} - ${{ matrix.arch }} - ${{ github.event_name }}</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.os }}</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;1.9&#39;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;nightly&#39;</span>
<span class="w">        </span><span class="nt">os</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">        </span><span class="nt">arch</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x64</span><span class="w">          </span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">julia-actions/setup-julia@v1</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.version }}</span>
<span class="w">          </span><span class="nt">arch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.arch }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/cache@v1</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">cache-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache-artifacts</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.julia/artifacts</span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ runner.os }}-test-${{ env.cache-name }}-${{ hashFiles(&#39;**/Project.toml&#39;) }}</span>
<span class="w">          </span><span class="nt">restore-keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">${{ runner.os }}-test-${{ env.cache-name }}-</span>
<span class="w">            </span><span class="no">${{ runner.os }}-test-</span>
<span class="w">            </span><span class="no">${{ runner.os }}-</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">julia-actions/julia-buildpkg@v1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">julia-actions/julia-runtest@v1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">julia-actions/julia-processcoverage@v1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v1</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lcov.info</span>
</pre></div>
</div>
<p>This file provides the rules for continuous integration running on changes to this repository.  You will not need to modify it.</p>
<p>To summarize some of the features, the</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">push</span></code> and <code class="docutils literal notranslate"><span class="pre">pull_request</span></code> at the top says that any push to the repository or creation of a pull request will trigger this workflow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matrix</span></code> establishes the set of operating systems, architectures, and Julia versions to test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actions/cache</span></code> speeds up execution by storing dependent packages and artifacts</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">julia-runtest</span></code> will execute the <code class="docutils literal notranslate"><span class="pre">test/runtests.jl</span></code> automatically and determine whether it is successful</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">codecov/codecov-action</span></code> analyzes which lines of code were executed by <code class="docutils literal notranslate"><span class="pre">test/runtests.jl</span></code> and uploads to Codecov</p></li>
</ul>
</div>
</div>
<div class="section" id="project-workflow">
<h2><a class="toc-backref" href="#id6"><span class="section-number">12.4. </span>Project Workflow</a><a class="headerlink" href="#project-workflow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependency-management">
<h3><span class="section-number">12.4.1. </span>Dependency Management<a class="headerlink" href="#dependency-management" title="Permalink to this headline">¶</a></h3>
<div class="section" id="environments">
<h4><span class="section-number">12.4.1.1. </span>Environments<a class="headerlink" href="#environments" title="Permalink to this headline">¶</a></h4>
<p>As <a class="reference internal" href="tools_editors.html#jl-packages"><span class="std std-ref">before</span></a>, the <code class="docutils literal notranslate"><span class="pre">.toml</span></code> files define an <em>environment</em> for our project, or a set of files which represent the dependency information.</p>
<p>The actual files are written in the <a class="reference external" href="https://github.com/toml-lang/toml">TOML language</a>, which is a lightweight format to specify configuration options.</p>
<p>This information is the name of every package we depend on, along with the exact versions of those packages.</p>
<p>This information (in practice, the result of package operations we execute) will
be reflected in our <code class="docutils literal notranslate"><span class="pre">MyProject.jl</span></code> directory’s TOML, once that environment is activated (selected).</p>
<p>This allows us to share the project with others, who can exactly reproduce the state used to build and test it.</p>
<p>See the <a class="reference external" href="https://docs.julialang.org/en/v1/stdlib/Pkg/">Pkg docs</a> for more information.</p>
</div>
<div class="section" id="pkg-operations">
<h4><span class="section-number">12.4.1.2. </span>Pkg Operations<a class="headerlink" href="#pkg-operations" title="Permalink to this headline">¶</a></h4>
<p>For now, let’s just try adding a dependency.  Recall the package operations described in the <a class="reference internal" href="tools_editors.html"><span class="doc">tools and editors</span></a> lecture.</p>
<ul class="simple">
<li><p>Within VS Code, start a REPL (e.g. <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">Julia:</span> <span class="pre">Start</span> <span class="pre">REPL</span></code>), type <code class="docutils literal notranslate"><span class="pre">]</span></code> to enter the Pkg mode.  Verify that the cursor says <code class="docutils literal notranslate"><span class="pre">(My</span> <span class="pre">Project)</span> <span class="pre">pkg&gt;</span></code> to ensure that it has activated your particular project.  Otherwise, if it says <code class="docutils literal notranslate"><span class="pre">(&#64;1.9)</span> <span class="pre">pkg&gt;</span></code>, then you have launched Julia outside of VSCode or through a different mechanism, and you might need to ensure you are in the correct directory and then <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">activate</span> <span class="pre">.</span></code> to activate the project file in it.</p></li>
<li><p>Then, add in the <code class="docutils literal notranslate"><span class="pre">Expectations.jl</span></code> package</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_add_package.png"><img alt="../_images/vscode_add_package.png" src="../_images/vscode_add_package.png" style="width: 100%;" /></a>
</div>
<p>After installing a large web of dependencies, this tells Julia to write the results of package operations to the activated <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> file, which should now include text such as</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[deps]</span>
<span class="n">Expectations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2fe49d83-0758-5602-8f54-1f90ad0d522b&quot;</span>
</pre></div>
</div>
<p>From this point, anytime the project is activated, the <a class="reference external" href="https://github.com/QuantEcon/Expectations.jl">Expectations.jl</a> package will be available with <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">Expectations</span></code>.</p>
<p>Furthermore, different projects could use different versions of this package.   We could add additional instructions on <a class="reference external" href="https://pkgdocs.julialang.org/dev/compatibility/">compatability</a> within the file if we choose.</p>
<p>But almost more importantly, the <code class="docutils literal notranslate"><span class="pre">Manifest.toml</span></code> file now contains a complete snapshot of the particular <code class="docutils literal notranslate"><span class="pre">Expectations</span></code> package and every other dependency used in your project.</p>
<p>For example, the following is an example snippet of one manifest here:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[Expectations]]</span>
<span class="n">deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Compat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Distributions&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FastGaussQuadrature&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LinearAlgebra&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SpecialFunctions&quot;</span><span class="p">]</span>
<span class="n">git-tree-sha1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0f906c5edffe266acbf471734ac942d4aa9b7235&quot;</span>
<span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2fe49d83-0758-5602-8f54-1f90ad0d522b&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.7.1&quot;</span>

<span class="k">[[FastGaussQuadrature]]</span>
<span class="n">deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;LinearAlgebra&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SpecialFunctions&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;StaticArrays&quot;</span><span class="p">]</span>
<span class="n">git-tree-sha1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;5829b25887e53fb6730a9df2ff89ed24baa6abf6&quot;</span>
<span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;442a2c76-b920-505d-bb47-c5924d526838&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.4.7&quot;</span>
</pre></div>
</div>
<p>This shows that that the current manifest has:</p>
<ul class="simple">
<li><p>version 1.7.1 of the <code class="docutils literal notranslate"><span class="pre">Expectations</span></code> packages</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">Expectations</span></code> package at this version has a variety of dependencies (i.e. <code class="docutils literal notranslate"><span class="pre">deps</span> <span class="pre">=</span> </code>) such as the <code class="docutils literal notranslate"><span class="pre">FastGaussQuadrature</span></code>.</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">FastGaussQuadrature</span></code> package at version <code class="docutils literal notranslate"><span class="pre">0.4.7</span></code> which itself has <code class="docutils literal notranslate"><span class="pre">StaticArrays</span></code> as a dependency, etc.</p></li>
</ul>
<p>The manifest file then provides a fully reproducible environment with which someone can install not only the specific version of this package, but also a feasible network of all dependencies which all fulfill the compatability requirements of each.</p>
<p>We have used this feature before in our setup process, where we activated a <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> and used <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">instantiate</span></code>.  If there is a manifest file in the same directory as the package, then that command will install the exact set of versions listed in the manifest for all packages.  If a manifest file does not exist, then it will attempt to find a compatible set of packages that fulfill your <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> file, and generate one.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a typical project intended to be for reproducible research, you should always keep the <code class="docutils literal notranslate"><span class="pre">Manifest.toml</span></code> in source control so that you can reproduce every stage of the project.  This can save you when you need to roll back to an older version to track down changes.  However, when creating reusable packages largely intended for others to have as dependencies, you will typically not include the <code class="docutils literal notranslate"><span class="pre">Manifest.toml</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="test-driven-development">
<span id="test-driven"></span><h3><span class="section-number">12.4.2. </span>Test-driven Development<a class="headerlink" href="#test-driven-development" title="Permalink to this headline">¶</a></h3>
<p>The basic idea of test-driven development is to create a set of tests of individual functions in <code class="docutils literal notranslate"><span class="pre">test/runtests.jl</span></code> (and files it includes), while keeping the core functionality in  <code class="docutils literal notranslate"><span class="pre">src/MyProject.jl</span></code> (and files it includes).</p>
<p>This will be part of a coherent set of strategies to ensure everything is reproducible since:</p>
<ul class="simple">
<li><p>Writing all of the checks on your underlying functions to be called from  <code class="docutils literal notranslate"><span class="pre">test/runtests.jl</span></code> lets you can avoid accidentally breaking old functionality.  Breaking of old code is called a <a class="reference external" href="https://en.wikipedia.org/wiki/Regression_testing">test regression</a> and is especially problematic with research code.</p></li>
<li><p>With the full snapshot of all of the packages associated with a particular version of the project (i.e. a commmit) in a <code class="docutils literal notranslate"><span class="pre">Manifest.toml</span></code>, anyone can reproduce the exact environment simply from that point in the source code tree.</p></li>
<li><p>Any changes to the code automatically run in the CI (i.e. the GitHub Action) after every modification, so you and any collaborators will be able to automatically track changes.</p></li>
<li><p>The code coverage will give you a sense of how much of the code you have actually executed in your tests, which can give you a sense of how much faith should be given to the automatic tracking of changes.</p></li>
<li><p>The visual badges and displays on GitHub (e.g. the CI badge and the display of checks on each PR) provides an easy way to track when problems occur.</p></li>
</ul>
</div>
<div class="section" id="writing-code-in-the-package">
<span id="editing-package-code"></span><h3><span class="section-number">12.4.3. </span>Writing Code in the Package<a class="headerlink" href="#writing-code-in-the-package" title="Permalink to this headline">¶</a></h3>
<p>First, in the REPL add support for the <code class="docutils literal notranslate"><span class="pre">Distributions.jl</span></code> package and Julia unit testing</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="p">]</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">Distributions</span><span class="w"> </span><span class="n">Test</span>
</pre></div>
</div>
<p>Which should provide output such as</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_add_package_2.png"><img alt="../_images/vscode_add_package_2.png" src="../_images/vscode_add_package_2.png" style="width: 100%;" /></a>
</div>
<p>While it will add the package to the <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code>, unlike the previous package operation, this will not install any new packages.  The reason is that <code class="docutils literal notranslate"><span class="pre">Distributions.jl</span></code> was already in the manifest as a dependency of <code class="docutils literal notranslate"><span class="pre">Expectations.jl</span></code> - and hence the network of packages already supports it.</p>
<p>Next, modify the <code class="docutils literal notranslate"><span class="pre">src/MyProject.jl</span></code> to include</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">module</span><span class="w"> </span><span class="n">MyProject</span>

<span class="k">using</span><span class="w"> </span><span class="n">Expectations</span><span class="p">,</span><span class="w"> </span><span class="n">Distributions</span>

<span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="p">)</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expectation</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">E</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">export</span><span class="w"> </span><span class="n">foo</span>

<span class="k">end</span><span class="w"> </span><span class="c"># module</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This defines a function, <code class="docutils literal notranslate"><span class="pre">foo</span></code> in the package, and exports it so that it is available to be called directly with <code class="docutils literal notranslate"><span class="pre">foo()</span></code> after <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">MyProject</span></code>.  Alternatively, you can leave off the <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">foo</span></code> and instead call the function with the package name as a prefix <code class="docutils literal notranslate"><span class="pre">MyProject.foo()</span></code>.</p>
</div>
<p>Then, we can call this function within a REPL by first including our package</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">MyProject</span>
</pre></div>
</div>
<p>Then calling <code class="docutils literal notranslate"><span class="pre">foo()</span></code> with the default arguments in the REPL.  This should lead to something like</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_run_package_1.png"><img alt="../_images/vscode_run_package_1.png" src="../_images/vscode_run_package_1.png" style="width: 100%;" /></a>
</div>
<p>Next, we will change the function in the package and call it again in the REPL:</p>
<ul class="simple">
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">foo</span></code> function definition to add <code class="docutils literal notranslate"><span class="pre">println(&quot;Modified</span> <span class="pre">foo</span> <span class="pre">definition&quot;)</span></code> inside the function</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="p">)</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Modified foo definition&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expectation</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">E</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And then call the <code class="docutils literal notranslate"><span class="pre">foo()</span></code> function again in the REPL, which shows that it is now using the modified function.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_run_package_2.png"><img alt="../_images/vscode_run_package_2.png" src="../_images/vscode_run_package_2.png" style="width: 100%;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This behavior, where modifying code within the package is detected and immediately compiled, relies on the <a class="reference internal" href="#testing-pkg-installation"><span class="std std-ref">installation of Revise.jl</span></a>.  An alternative workflow without <code class="docutils literal notranslate"><span class="pre">Revise.jl</span></code> is to make modifications to the underlying package files, and then simply use <code class="docutils literal notranslate"><span class="pre">&lt;Shift+Enter&gt;</span></code> in the editor to recompile them.  Both approaches are fully defensible and tastes are idiosyncratic.</p>
<p>Regardless, if you modify functions <strong>outside of</strong> the package (e.g. a function in the <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code>) you will need to use the <code class="docutils literal notranslate"><span class="pre">&lt;Shift+Enter&gt;</span></code> to compile it, as Revise only tracks code within loaded packages.</p>
</div>
<p>Consider that when writing this function, we may be checking its behavior in the REPL.  For example, we know from theory that the symmetry of the <code class="docutils literal notranslate"><span class="pre">sin</span></code> function means the expectation of the <code class="docutils literal notranslate"><span class="pre">sin</span></code> of a mean-zero normal (i.e. <code class="docutils literal notranslate"><span class="pre">foo(0)</span></code>) should be close to zero.</p>
<p>To check this, we can use the <code class="docutils literal notranslate"><span class="pre">Test</span></code> package built-into julia, and added to our project file above.  The <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code> macro within it verifies a condition, and fails if it is incorrect.</p>
<p>In the REPL, use the <code class="docutils literal notranslate"><span class="pre">Test</span></code> package and then check that <code class="docutils literal notranslate"><span class="pre">foo(0)</span></code> is close to 0.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">MyProject</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1E-16</span>
</pre></div>
</div>
<p>Which should show that the “Test Passed”.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_run_package_3.png"><img alt="../_images/vscode_run_package_3.png" src="../_images/vscode_run_package_3.png" style="width: 100%;" /></a>
</div>
</div>
<div class="section" id="writing-test-code">
<span id="editing-test-code"></span><h3><span class="section-number">12.4.4. </span>Writing Test Code<a class="headerlink" href="#writing-test-code" title="Permalink to this headline">¶</a></h3>
<p>The core of test driven development is that if a value was worth checking once, then it is probably worth checking every time the code changes.</p>
<p>For this reason, the change to this workflow means moving much of the code you would use to explore in a Jupyter notebook into the <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code> (or files they <code class="docutils literal notranslate"><span class="pre">include</span></code>) themselves.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;testset</span></code> are just optional ways to group the tests, and are not required for organization.</p>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">test/runtests.jl</span></code>, move the <code class="docutils literal notranslate"><span class="pre">&#64;test</span> <span class="pre">foo(0)</span> <span class="pre">&lt;</span> <span class="pre">1E-16</span></code>  inside of the <code class="docutils literal notranslate"><span class="pre">&#64;testset</span></code>, which you can rename.  The testsets are optional, but can provide easy ways to group tests and execute many at once within VS Code.</p></li>
<li><p>Then <code class="docutils literal notranslate"><span class="pre">&lt;Shift-Enter&gt;</span></code> through each line of the <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code> file.  As you execute each line of code, it will provide the result or a checkmark to indicate success</p></li>
</ul>
<p>At the end, you should have output within the REPL that the test you added passed.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_run_package_4.png"><img alt="../_images/vscode_run_package_4.png" src="../_images/vscode_run_package_4.png" style="width: 100%;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that for the <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code> file, we need to manually execute lines of code as we wish to explore the results, in contrast to the changes in the package where Revise automatically compiled them.  This includes function definitions inside of these files.</p>
</div>
<p>Checks on individual functions in your test suite are called <a class="reference external" href="https://en.wikipedia.org/wiki/Unit_testing">unit tests</a>.</p>
</div>
<div class="section" id="executing-tests-locally-and-on-ci">
<span id="executing-tests"></span><h3><span class="section-number">12.4.5. </span>Executing Tests Locally and on CI<a class="headerlink" href="#executing-tests-locally-and-on-ci" title="Permalink to this headline">¶</a></h3>
<p>As you develop your project, you may find yourself adding in many small checks and organizing them into files included from runtests.  After modifying a large amount of code, you may want to run through the entire set of unit tests to ensure you didn’t break anything.</p>
<p>To do this, the package mode in Julia has a convenient function which will create a separate environment using your Project/Manifest and execute the entire <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code> function.</p>
<p>If you have already activated the project, then <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">test</span></code> is sufficient.  Otherwise, if you added it to the <a class="reference internal" href="#add-to-global"><span class="std std-ref">global environment</span></a>, you could type <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">test</span> <span class="pre">MyProject</span></code>.</p>
<p>Run this test to see the output.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_run_package_5.png"><img alt="../_images/vscode_run_package_5.png" src="../_images/vscode_run_package_5.png" style="width: 100%;" /></a>
</div>
<p>This shows that the individual test passed, but also that the entire test suite was without errors.</p>
<p>Now that we have a functional test suite, it is a good time to upload our code to the server.  Create a commit, and push all changes to the server.</p>
<p>If you reload the webpage, you will notice that the commit is now on the server, but also that a small orange circle is next to the commit.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_1.png"><img alt="../_images/ci_1.png" src="../_images/ci_1.png" style="width: 100%;" /></a>
</div>
<p>This indicates that a GitHub Action is executing based on that push to the main branch.</p>
<p>You can see these actions in progress on the Actions tab, where the action may be complete by the time you open it.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_2.png"><img alt="../_images/ci_2.png" src="../_images/ci_2.png" style="width: 100%;" /></a>
</div>
<p>If you further click on one of the jobs and select the <code class="docutils literal notranslate"><span class="pre">julia-runtest</span></code> you can see the output on the server.  It ran your test suite on its isolated environment and is showing a check mark because the tests passed.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_3.png"><img alt="../_images/ci_3.png" src="../_images/ci_3.png" style="width: 100%;" /></a>
</div>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_4.png"><img alt="../_images/ci_4.png" src="../_images/ci_4.png" style="width: 100%;" /></a>
</div>
<p>By this point, if you navigate back to the web page you will see that the commit has a checkmark (rather than an orange circle) and the badge at the bottom says “CI | passing” to indicate that the last action was successful.</p>
</div>
<div class="section" id="feature-branches-and-continuous-integration">
<span id="branches-tests"></span><h3><span class="section-number">12.4.6. </span>“Feature” Branches and Continuous Integration<a class="headerlink" href="#feature-branches-and-continuous-integration" title="Permalink to this headline">¶</a></h3>
<p>The previous example showed how the CI will automatically execution an action when you push it to the main branch.</p>
<p>These actions will also apply, separately, to any branches and Pull Requests (PRs) that you create, as discussed in the <a class="reference internal" href="version_control.html"><span class="doc">previous lecture</span></a>.</p>
<p>Separate testing and CI is one of the primary motivations for creating a branch when collaborating on a project.</p>
<p>To demonstrate this</p>
<ul class="simple">
<li><p>Create a new branch on VS Code called <code class="docutils literal notranslate"><span class="pre">my-feature</span></code> (i.e., click on the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch at the bottom of the screen to enter the branch selection, then choose to make a new one).</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">MyProject.jl</span></code>, change the function in <code class="docutils literal notranslate"><span class="pre">foo</span></code> from <code class="docutils literal notranslate"><span class="pre">sin(x)</span></code> to <code class="docutils literal notranslate"><span class="pre">cos(x)</span></code>.  Note that this will change the result of <code class="docutils literal notranslate"><span class="pre">foo(0)</span></code>.</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_5.png"><img alt="../_images/ci_5.png" src="../_images/ci_5.png" style="width: 100%;" /></a>
</div>
<ul class="simple">
<li><p>Commit this change to your local branch with the commit message.</p></li>
<li><p>Then, imagine that rather than running <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">test</span></code> - which would have shown this error given our previous unit test, you pushed it to the server.  As always, do this by selecting the publish arrow next to <code class="docutils literal notranslate"><span class="pre">my-feature</span></code> at the bottom of the screen.  You can create a Pull Request in that GUI, or just go back to the webpage where it asked you if you wish to “Compare and Pull Request”.</p></li>
</ul>
<p>After you create the pull request, you will see it in available on the web.  After a few minutes, the unit test will execute and you will see an output such as</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_6.png"><img alt="../_images/ci_6.png" src="../_images/ci_6.png" style="width: 100%;" /></a>
</div>
<p>Unlike in the previous example, the pull request will have a red X indicating that one of the actions failed.</p>
<p>If this were done by a collaborator, you could go to the “Files Changed” tab, see the code modifications for commits in this PR, and then add a comment on these inline for discussion (using the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> to tag an individual so they are emailed)</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_7.png"><img alt="../_images/ci_7.png" src="../_images/ci_7.png" style="width: 100%;" /></a>
</div>
<p>At that point, you or your collaborators can easily switch to the branch associated with the PR (i.e. <code class="docutils literal notranslate"><span class="pre">my-feature</span></code> in the above screenshot), make changes, and test them.</p>
<p>If you go back to VS Code and change the <code class="docutils literal notranslate"><span class="pre">cos</span></code> back to <code class="docutils literal notranslate"><span class="pre">sin</span></code> and commit with a message (e.g. <code class="docutils literal notranslate"><span class="pre">Fixed</span> <span class="pre">bug</span></code>) then the PR will rerun the CI.</p>
<p>In this case, you will see that while the <code class="docutils literal notranslate"><span class="pre">Modified</span> <span class="pre">foo</span></code> broke the CI, the <code class="docutils literal notranslate"><span class="pre">Fixed</span> <span class="pre">bug</span></code> commit passed, and has a green checkmark after it completes its run.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/ci_8.png"><img alt="../_images/ci_8.png" src="../_images/ci_8.png" style="width: 100%;" /></a>
</div>
<p>Furthermore, since the previous comment was made on a line of code that was changed after the comment was made, it says the comment is “Outdated”.  When collaborating, the “Resolve conversation” option would let you close these sorts of issues as they are found.</p>
<p>Reselect your <code class="docutils literal notranslate"><span class="pre">main</span></code> branch in VS Code to make further changes there rather than on the <code class="docutils literal notranslate"><span class="pre">my-feature</span></code> branch.</p>
</div>
<div class="section" id="code-coverage">
<h3><span class="section-number">12.4.7. </span>Code Coverage<a class="headerlink" href="#code-coverage" title="Permalink to this headline">¶</a></h3>
<p>At this point, the <code class="docutils literal notranslate"><span class="pre">Codecov</span></code> badge in the README likely says <code class="docutils literal notranslate"><span class="pre">codecov</span> <span class="pre">|</span> <span class="pre">unknown</span></code> since the repository has not been added there.</p>
<p>Click on that badge, which should take you to the <code class="docutils literal notranslate"><span class="pre">Codecov</span></code> website where you can login if required, and select particular commits or PRs.</p>
<p>For example, on our previous PR we can see that it detected the change from the <code class="docutils literal notranslate"><span class="pre">cos</span></code> back to <code class="docutils literal notranslate"><span class="pre">sin</span></code> and that the coverage is 100% (i.e., every line of code in the package is executed by a test)</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/codecov_1.png"><img alt="../_images/codecov_1.png" src="../_images/codecov_1.png" style="width: 100%;" /></a>
</div>
<p>To see the impact of additional code in the package, go back to your <code class="docutils literal notranslate"><span class="pre">main</span></code> branch, add in a new function such as</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">bar</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">10</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then commit and push to the server.</p>
<p>After the CI executes, you will notice that the unit tests still pass despite the additional function.</p>
<p>However, if you click on the code coverage badge again and look at the main branch (or that particular commit) you will see that the code coverage has decreased substantially.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/codecov_2.png"><img alt="../_images/codecov_2.png" src="../_images/codecov_2.png" style="width: 100%;" /></a>
</div>
<p>Furthermore, it highlights in red the new code in this commit which led to the lowered code coverage.  In this case, the <code class="docutils literal notranslate"><span class="pre">bar</span></code> function had nothing in <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code> that was calling it.  This can help you ensure that all of the code paths (not just entire functions) are called in one test or another in your unit tests.</p>
</div>
<div class="section" id="jupyter-workflow">
<h3><span class="section-number">12.4.8. </span>Jupyter Workflow<a class="headerlink" href="#jupyter-workflow" title="Permalink to this headline">¶</a></h3>
<p>We can also work with the package, and activated project file, from a Jupyter notebook for analysis and exploration.</p>
<p>In general, Jupyter should be used sparingly as it does not support a tight workflow for collaboration since it does not have an equivalent for the CI, and changes to the Jupyter notebook cannot be discussed inline and analyzed using the workflow above.</p>
<p>However, if source code is fairly stable and you are working on just the analysis and visualization of results (where introducing bugs is unlikely), it is a very useful tool.</p>
<p>Assuming that we have the <code class="docutils literal notranslate"><span class="pre">IJulia</span></code> package and conda installed, as in the basic lecture note setup, if we start a terminal in VS Code we will be able to start Jupyter in the right directory.</p>
<ul class="simple">
<li><p>Create a new terminal for your operating system by choosing the <code class="docutils literal notranslate"><span class="pre">+</span></code> button on the terminals pane, then type <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">lab</span></code> to start Jupyter, then open the webpage</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_jupyter_1.png"><img alt="../_images/vscode_jupyter_1.png" src="../_images/vscode_jupyter_1.png" style="width: 100%;" /></a>
</div>
<ul class="simple">
<li><p>Create a new notebook in Jupyter in the main folder (or a subfolder) and add code to use <code class="docutils literal notranslate"><span class="pre">MyProject</span></code> and call <code class="docutils literal notranslate"><span class="pre">foo</span></code>.</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_jupyter_2.png"><img alt="../_images/vscode_jupyter_2.png" src="../_images/vscode_jupyter_2.png" style="width: 100%;" /></a>
</div>
<p>Crucially, note that the <code class="docutils literal notranslate"><span class="pre">MyProject</span></code> package and anything else in the <code class="docutils literal notranslate"><span class="pre">Project.toml</span></code> file is available since Jupyter automatically activates the project file local to jupyter notebooks.</p>
<p>Be sure to add <code class="docutils literal notranslate"><span class="pre">.ipynb_checkpoints/*</span></code> to your <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file, so that’s not checked in.</p>
<p>While you would typically modify the Jupyter notebooks after the core code is stable, with <code class="docutils literal notranslate"><span class="pre">Revise.jl</span></code> it is possible to have it automatically load changes to the package itself.</p>
<p>To do this</p>
<ul class="simple">
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">Revise</span></code> prior to the <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">MyProject</span></code> (note that VS Code’s REPL does the <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">Revise</span></code> automatically, if it is available).</p></li>
<li><p>Then run <code class="docutils literal notranslate"><span class="pre">foo(0)</span></code> to see the old code</p></li>
<li><p>Then modify the text of the package itself, such as changing the string in the <code class="docutils literal notranslate"><span class="pre">foo</span></code> function</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">foo(0)</span></code> again to see the change.</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/vscode_jupyter_3.png"><img alt="../_images/vscode_jupyter_3.png" src="../_images/vscode_jupyter_3.png" style="width: 100%;" /></a>
</div>
</div>
</div>
<div class="section" id="more-on-writing-tests">
<h2><a class="toc-backref" href="#id7"><span class="section-number">12.5. </span>More on Writing Tests</a><a class="headerlink" href="#more-on-writing-tests" title="Permalink to this headline">¶</a></h2>
<p>As discussed, there are a few different kinds of test, each with different purposes</p>
<ul class="simple">
<li><p><em>Unit testing</em> makes sure that individual pieces of a project work as expected.</p></li>
<li><p><em>Integration testing</em> makes sure that they fit together as expected.</p></li>
<li><p><em>Regression testing</em> makes sure that behavior is unchanged over time.</p></li>
</ul>
<p>In general, well-written unit tests (which also guard against regression, for example by comparing function output to hardcoded values) are sufficient for most small projects.</p>
<div class="section" id="the-test-module">
<h3><span class="section-number">12.5.1. </span>The <code class="docutils literal notranslate"><span class="pre">Test</span></code> Module<a class="headerlink" href="#the-test-module" title="Permalink to this headline">¶</a></h3>
<p>Julia provides testing features through a built-in package called <code class="docutils literal notranslate"><span class="pre">Test</span></code>, which we get by <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">Test</span></code>.</p>
<p>The basic object is the macro <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Test</span>
<span class="nd">@test</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Test Passed</span>
</pre></div>
</div>
</div>
</div>
<p>Since floating points can often only be compared within machine precision, you can typically only compare these approximately with either <code class="docutils literal notranslate"><span class="pre">isapprox</span></code> or <code class="docutils literal notranslate"><span class="pre">≈</span></code> (which can auto-completed in VS Code with <code class="docutils literal notranslate"><span class="pre">\approx&lt;TAB&gt;</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@test</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">isapprox</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="mf">2.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Test Passed</span>
</pre></div>
</div>
</div>
</div>
<p>The default comparison for <code class="docutils literal notranslate"><span class="pre">isapprox</span></code> is that the relative tolerance (i.e. <span class="math notranslate nohighlight">\(\|x - y\| \leq rtol \max(\|x\|, \|y\|)\)</span>) depends on the particular type, but defaults to the sqrt rate of the machine epsilon.
For example,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@show</span><span class="w"> </span><span class="o">√</span><span class="n">eps</span><span class="p">(</span><span class="kt">Float64</span><span class="p">)</span>
<span class="nd">@show</span><span class="w"> </span><span class="o">√</span><span class="n">eps</span><span class="p">(</span><span class="kt">BigFloat</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>√(eps(Float64)) = 1.4901161193847656e-8
√(eps(BigFloat)) = 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.156000133564589919546802616566101790707151631732974255008686036787230203508115e-39
</pre></div>
</div>
</div>
</div>
<p>For cases where you want to change the relative tolerance or add in an absolute tolerance (i.e. <span class="math notranslate nohighlight">\(\|x - y\| \leq atol\)</span>) use the appropriate keywords</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1E-6</span><span class="w">  </span><span class="c"># within the tolerance</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">x≈100</span><span class="mf">.0</span><span class="w"> </span><span class="n">rtol</span><span class="o">=</span><span class="mf">1E-7</span><span class="w">  </span><span class="c"># note &lt; the 1E-6 difference passes due to relative scaling</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1E-7</span>
<span class="nd">@test</span><span class="w"> </span><span class="mf">0.0</span><span class="o">≈</span><span class="n">y</span><span class="w"> </span><span class="n">atol</span><span class="o">=</span><span class="mf">1E-6</span><span class="w">  </span><span class="c"># absolute tolerance!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Test Passed</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The relative tolerance is always preferred for comparisons since it is dimensionless, whereas the absolute tolerance is related to the norm of the objects themselves.  As the documentation for <code class="docutils literal notranslate"><span class="pre">isapprox</span></code> says: <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">-</span> <span class="pre">y</span> <span class="pre">≈</span> <span class="pre">0,</span> <span class="pre">atol=1e-9</span></code>is an absurdly small tolerance if <code class="docutils literal notranslate"><span class="pre">x</span></code> is the radius of the Earthin meters, but an absurdly large tolerance if <code class="docutils literal notranslate"><span class="pre">x</span></code> is the radius of a Hydrogen atom.</p>
<p>Because of this, there is no default <code class="docutils literal notranslate"><span class="pre">atol</span></code> if the norms of the values are zero.  And <code class="docutils literal notranslate"><span class="pre">rtol</span></code> is undefined, so you will need to use judgement on the specific problem to form a threshold.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">isapprox</span></code> comparison works for any datatypes that implement a <code class="docutils literal notranslate"><span class="pre">norm</span></code>, for example</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">]</span>
<span class="nd">@test</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">Test Passed</span>
</pre></div>
</div>
</div>
</div>
<p>Tests will pass if the condition is <code class="docutils literal notranslate"><span class="pre">true</span></code>, or fail otherwise.  Failing tests will be highlighted in both the CI and output within the terminal,</p>
<div class="cell tag_raises-exception tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@test</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, sometimes you will have broken tests which are known to fail, but you do not want to remove.</p>
<p>This is good practice for code in progress that you intend to fix, but do not want to forget about, as commented out tests are easily forgotten.</p>
<p>To do this, flag it with <code class="docutils literal notranslate"><span class="pre">&#64;test_broken</span></code> as below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@test_broken</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Yellow">Test Broken</span>
  Expression: 1 == 2
</pre></div>
</div>
</div>
</div>
<p>This way, we still have access to information about the test, instead of just deleting it or commenting it out, but the CI will not fail.</p>
<p>There are other test macros, that check for things like error handling and type-stability.  Advanced users can check the <a class="reference external" href="https://docs.julialang.org/en/v1/stdlib/Test/">Julia docs</a>.</p>
</div>
<div class="section" id="test-sets">
<h3><span class="section-number">12.5.2. </span>Test Sets<a class="headerlink" href="#test-sets" title="Permalink to this headline">¶</a></h3>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">runtests.jl</span></code> folder starts off with a <code class="docutils literal notranslate"><span class="pre">&#64;testset</span></code>.</p>
<p>This is useful for organizing different batches of tests, and executing them all at once.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;my tests&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nd">@test_broken</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test Summary: | </span><span class=" -Color -Color-Bold -Color-Bold-Green">Pass  </span><span class=" -Color -Color-Bold -Color-Bold-Yellow">Broken  </span><span class=" -Color -Color-Bold -Color-Bold-Cyan">Total  </span><span class=" -Color -Color-Bold">Time</span>
my tests      | <span class=" -Color -Color-Green">   2  </span><span class=" -Color -Color-Yellow">     1  </span><span class=" -Color -Color-Cyan">    3  </span>0.2s
</pre></div>
</div>
</div>
</div>
<p>By using <code class="docutils literal notranslate"><span class="pre">&lt;Shift+Enter&gt;</span></code> in VS Code or Jupyter on the testset, you will execute them all.  You may want to execute only parts of them during development by commenting out the <code class="docutils literal notranslate"><span class="pre">&#64;testset</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code> and execute sequentially until the suite passes.</p>
<p>To learn more about test sets, see <a class="reference external" href="https://docs.julialang.org/en/v1/stdlib/Test/index.html#Working-with-Test-Sets-1/">the docs</a>.</p>
</div>
</div>
<div class="section" id="exercises">
<h2><a class="toc-backref" href="#id8"><span class="section-number">12.6. </span>Exercises</a><a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exercise-1">
<h3><span class="section-number">12.6.1. </span>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>Following the <a class="reference internal" href="#project-setup"><span class="std std-ref">instructions for a new project</span></a>, create a new package on your github account called <code class="docutils literal notranslate"><span class="pre">NewtonsMethod.jl</span></code>.</p>
<p>In this package, you should create a simple package to do Newton’s Method using the code you did in the
<a class="reference internal" href="../getting_started_julia/julia_by_example.html#jbe-ex8a"><span class="std std-ref">Newton’s method</span></a> exercise in <a class="reference internal" href="../getting_started_julia/julia_by_example.html"><span class="doc">Introductory Examples</span></a>.</p>
<p>In particular, within your package you should have two functions</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newtonroot(f,</span> <span class="pre">f′;</span> <span class="pre">x₀,</span> <span class="pre">tol</span> <span class="pre">=</span> <span class="pre">1E-7,</span> <span class="pre">maxiter</span> <span class="pre">=</span> <span class="pre">1000)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">newtonroot(f;</span> <span class="pre">x₀,</span> <span class="pre">tol</span> <span class="pre">=</span> <span class="pre">1E-7,</span> <span class="pre">maxiter</span> <span class="pre">=</span> <span class="pre">1000)</span></code></p></li>
</ul>
<p>Where the second function uses Automatic Differentiation to call the first.</p>
<p>The package should include</p>
<ul class="simple">
<li><p>implementations of those functions in the <code class="docutils literal notranslate"><span class="pre">/src</span></code> directory</p></li>
<li><p>comprehensive set of tests</p></li>
<li><p>project and manifest files to replicate your development environment</p></li>
<li><p>automated running of the tests with GitHub Actions</p></li>
</ul>
<p>For the tests, you should have at the very minimum</p>
<ul class="simple">
<li><p>a way to handle non-convergence (e.g. return back <code class="docutils literal notranslate"><span class="pre">nothing</span></code> as discussed in <a class="reference internal" href="../getting_started_julia/fundamental_types.html#error-handling"><span class="std std-ref">error handling</span></a>)</p></li>
<li><p>several <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code> for the root of a known function, given the <code class="docutils literal notranslate"><span class="pre">f</span></code> and analytical <code class="docutils literal notranslate"><span class="pre">f'</span></code> derivatives</p></li>
<li><p>tests of those roots using the automatic differentiation version of the function</p></li>
<li><p>a test of finding those roots with a <code class="docutils literal notranslate"><span class="pre">BigFloat</span></code> and not just a <code class="docutils literal notranslate"><span class="pre">Float64</span></code></p></li>
<li><p>a test of non-convergence for a function without a root (e.g. <span class="math notranslate nohighlight">\(f(x) = 2 + x^2\)</span> )</p></li>
<li><p>a test to ensure that the <code class="docutils literal notranslate"><span class="pre">maxiter</span></code> is working (e.g. what happens if you call <code class="docutils literal notranslate"><span class="pre">maxiter</span> <span class="pre">=</span> <span class="pre">5</span></code>)</p></li>
<li><p>a test to ensure that <code class="docutils literal notranslate"><span class="pre">tol</span></code> is working</p></li>
</ul>
<p>And anything else you can think of.  You should be able to run <code class="docutils literal notranslate"><span class="pre">]</span> <span class="pre">test</span></code> for the project to check that the test-suite is running, and then ensure that it is running automatically on GitHub Actions CI.</p>
<p>Push a commit to the repository which breaks one of the tests and see what the GitHub Actions CI reports after running the build.</p>
<!-- 
# TODO: I think this is out of date, but mabye there aer better ones now?

### Exercise 2

Watch the youtube video [Developing Julia Packages](https://www.youtube.com/watch?v=QVmU29rCjaA) from Chris Rackauckas.  The demonstration goes through many of the same concepts as this lecture, but with more background in test-driven development and providing more details for open-source projects.. 
--></div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.9"
        },
        kernelOptions: {
            kernelName: "julia-1.9",
            path: "./software_engineering"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.9'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="version_control.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">11. </span>GitHub, Version Control and Collaboration</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="need_for_speed.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">13. </span>The Need for Speed</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jesse Perla & Thomas J. Sargent & John Stachurski<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>